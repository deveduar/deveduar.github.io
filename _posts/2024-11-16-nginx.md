---
date: 2024-11-16 17:03
title: nginx
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
public_note: "true"
category: nginx
tags:
  - nginx
  - backend
  - devops
  - Backend
---
# nginx
`$= dv.current().file.tags.join(" ")`

- [devops](/uncategorized/devops/)
- [proxy](/backend/proxy/)
- [Backend](/uncategorized/backend/)
- [Redes](/uncategorized/redes/)
- [apache](/backend/apache/)
- nginx-features
- NGINX- ¬øqu√© es y en qu√© se distingue de Apache-
- Beginner‚Äôs Guide
- [int-nginx.code-workspace](file:///D:%5CDocs%20Hp%5CCode-projects%5Cint-nginx.code-workspace) üíª

---

## üìò Conceptos Fundamentales

- Virtual Hosts
- Sites available / JSON objects
- Reverse Proxy
- SSL / TLS
- Buffer y caching
- [nginx.org](https://nginx.org/en/)
- Arquitectura basada en eventos: asincron√≠a y alta concurrencia
- Worker Processes y Master Process
- [proxy](/backend/proxy/)
- [microservicios](/backend/microservicios/)

---

## ‚öôÔ∏è Instalaci√≥n y Configuraci√≥n

- [Docker](/software%20engineering/docker/)
- [hub.docker.com/\_/nginx](https://hub.docker.com/_/nginx)
- [Linux](/sistemas/linux/)
	- `sudo apt install nginx`
	- `systemctl enable nginx`
	- `systemctl status nginx`
- Docker Compose
	- Mapear carpetas locales con `-v`
	- Vol√∫menes para logs y conf
	- Templates para configuraci√≥n con variables de entorno
	- Copy vs Template para `.conf` y `.env`

---

## üß≠ Enrutamiento y Balanceo de Carga

- [Enrutamiento y Balanceo de carga con NGINX para tus aplicaciones de Microservicios - YouTube](https://youtu.be/o7DSHPji1m0)
- Criterios de peticiones
- Balanceo de carga: cookies, hash, sticky sessions
- Router, URL y expresiones regulares
- Service Workers y API Gateway
- [proxy](/backend/proxy/) vs load balancing
- Round Robin, Least Connections, IP Hash
- Mapeo de archivos y rutas din√°micas
- Integraci√≥n con [microservicios](/backend/microservicios/)
- Estrategias de enrutamiento inteligente con [Kubernetes](/virtualizacion/kubernetes/)

---

## üß© Nginx Proxy Manager (NPM)

- [Nginx Proxy Manager](https://nginxproxymanager.com/)
- [C√≥mo crear un Servidor Web Compartido con Docker y Nginx Proxy Manager (NPM) üöÄ - YouTube](https://youtu.be/WCSdh37Z6Wk)
- pabperezadocs at main ¬∑ pabperezapabpereza-113.Docker_swarm
- [proxy](/backend/proxy/)
- Traefik
- [Docker](/software%20engineering/docker/)
- [Kubernetes](/virtualizacion/kubernetes/)
- Funcionalidades:
	- **Reverse Proxy** por IP o nombre de host
	- Redirecci√≥n de tr√°fico entre contenedores (DNS)
	- **Whitelist de IPs**
	- Certificados SSL autom√°ticos con Let‚Äôs Encrypt
	- Redirecci√≥n HTTP ‚Üí HTTPS
	- Eliminaci√≥n de puertos en docker-compose (puertos manejados por el proxy)
	- Gesti√≥n de redes: `network create`, `network list`
	- Registros DNS tipo A (para entornos de prueba, usar dominio falso)
	- Orquestaci√≥n con Docker Swarm o [Kubernetes](/virtualizacion/kubernetes/)

---

## üåê DNS y Subdominios

- [Duck DNS](https://www.duckdns.org/)
- Configurar subdominios en routers con loopback
- Integraci√≥n con VPN o t√∫neles inversos
- Configuraci√≥n de registros A / CNAME
- Redirecci√≥n din√°mica de IP p√∫blica a local
- Uso de DNS din√°mico para entornos dom√©sticos o peque√±os despliegues

---

## üöÄ Nginx con Node.js

- [Full NGINX Tutorial - Demo Project with Node.js, Docker - YouTube](https://youtu.be/q8OleYuqntY)
- Conceptos clave:
	- Single entry point (gateway)
	- Cach√© y buffer
	- Compresi√≥n, segmentaci√≥n y chunks
	- Seguridad: headers, rate limit, protecci√≥n DDOS
	- Redirect HTTP ‚Üí HTTPS
	- Load balancing entre instancias Node.js
	- Control de carga en cl√∫ster [Kubernetes](/virtualizacion/kubernetes/)
- Replicas en Docker Compose:
	- Definici√≥n de `services`, `ports`, `scale`
	- Proxy a grupos de servidores (upstreams)
	- Comparaci√≥n con [apache](/backend/apache/)

### üß† Configuraci√≥n base (`nginx.conf`)
{% raw %}
```nginx
worker_processes auto;
events {
	worker_connections 1024;
}

http {
	include mime.types;
	sendfile on;
	server {
		listen 80;
		server_name localhost;
		location / {
			proxy_pass http://app_backend;
			proxy_set_header Host $host;
			proxy_set_header X-Real-IP $remote_addr;
		}
	}
	upstream app_backend {
		server app1:3000;
		server app2:3000;
	}
}
```
{% endraw %}`

### üîí SSL / TLS

{% raw %}
```nginx
server {
	listen 443 ssl;
	server_name example.com;

	ssl_certificate /etc/ssl/certs/example.crt;
	ssl_certificate_key /etc/ssl/private/example.key;

	location / {
		proxy_pass http://localhost:3000;
	}
}

server {
	listen 80;
	server_name example.com;
	return 301 https://$host$request_uri;
}
```
{% endraw %}

### üîê SSL y TLS: Configuraci√≥n y Certificados

- **SSL vs TLS**: TLS es la evoluci√≥n segura y moderna del protocolo SSL.
- Certificados gestionados con `openssl` o con Nginx Proxy Manager / Let's Encrypt.
- Ejemplo de generaci√≥n de certificados autofirmados:
{% raw %}
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/ssl/private/example.key \
-out /etc/ssl/certs/example.crt 
```
{% endraw %}

### üîÅ Comandos √∫tiles

{% raw %}
```bash
nginx -t                # Verifica la configuraci√≥n
nginx -V            # Ver versi√≥n, m√≥dulos y par√°metros de compilaci√≥n
nginx -s reload         # Recarga sin reiniciar
nginx -s stop           # Detiene el servicio
ps aux | grep nginx     # Ver procesos activos
nginx -V                # Ver versi√≥n y m√≥dulos compilados
```
{% endraw %}

---

## üß± Configuraci√≥n y Contextos

* **Directivas**: par√°metros que controlan comportamiento
* **Contextos**:
	* `main` ‚Üí configuraci√≥n global
	* `events` ‚Üí conexiones
	* `http` ‚Üí servidores web
	* `server` ‚Üí sitios virtuales
	* `location` ‚Üí rutas espec√≠ficas
* [apache](/backend/apache/) vs [nginx](/nginx/nginx/):
	* Apache procesa por hilo ‚Üí m√°s pesado
	* Nginx usa modelo as√≠ncrono ‚Üí mejor rendimiento con alta concurrencia
* nginx-features:
	* Reverse Proxy, Load Balancer, API Gateway, Cache Layer
	* Static File Server
	* WebSocket y gRPC proxy
	* Integraci√≥n con Grafana / Prometheus para m√©tricas

### üóÇÔ∏è Archivos de Configuraci√≥n y Virtual Hosts

- `/etc/nginx/nginx.conf` ‚Üí archivo principal.
- `/etc/nginx/conf.d/*.conf` ‚Üí configuraciones por servicio.
- `/etc/nginx/sites-available` y `/etc/nginx/sites-enabled` ‚Üí gesti√≥n de virtual hosts.
- Definir dominios, subdominios y redirecciones.
---

## üê≥ Docker y Nginx

* [GitHub - nginxinc/docker-nginx: Official NGINX Dockerfiles](https://github.com/nginxinc/docker-nginx/tree/master)
* Uso de im√°genes base ligeras (`alpine`)
* Custom `.conf` en `/etc/nginx/conf.d`
* Vol√∫menes para persistencia
* Ejemplo `docker-compose.yml`:

{% raw %}
```yaml
version: "3.9"
services:
	nginx:
		image: nginx:latest
		ports:
			- "80:80"
			- "443:443"
		volumes:
			- ./nginx.conf:/etc/nginx/nginx.conf
			- ./ssl:/etc/ssl
		depends_on:
			- app
	app:
		build: ./app
		expose:
			- "3000"
```
{% endraw %}

---

## üì° Integraciones Modernas (2025)

* API Gateway en arquitecturas de [microservicios](/backend/microservicios/)
	* Nginx como capa de entrada unificada
	* Control de tr√°fico, seguridad, logging y m√©tricas
* Edge Computing e IoT:
	* Nginx como proxy de borde
	* Filtrado y agregaci√≥n de datos
	* Traefik y Nginx h√≠bridos en entornos multi-cloud
* Observabilidad:
	* Integraci√≥n con Grafana, Prometheus, ELK Stack
* Algoritmos de balanceo modernos:
	* Round Robin
	* Least Connections
	* IP Hash
	* Random with two choices
	* Weight-based balancing (priorizaci√≥n)
* Seguridad avanzada:
	* WAF (Web Application Firewall)
	* Rate Limiting y DDoS Protection
	* CSP, HSTS, y headers seguros
## üß∞ Servidor Web como Servicio
- Concepto de Nginx como servicio gestionado (PaaS)
- Despliegues automatizados con herramientas como [Kubernetes](/virtualizacion/kubernetes/) o Docker Swarm
- Integraci√≥n con pipelines CI/CD (e.g., DevOps)

---

## üìö Recursos

* [Nginx Mastery | Getting Started with Nginx | Docker | Docker Compose - YouTube](https://www.youtube.com/watch?v=7tGhir27ZJo&list=PLOLrQ9Pn6cawvMA5JjhzoQrnKbYGYQqx1)
* [GitHub - veryacademy/yt-nginx-mastery-series](https://github.com/veryacademy/yt-nginx-mastery-series)
* [Alphabetical index of directives](https://nginx.org/en/docs/dirindex.html)
* Beginner‚Äôs Guide
* NGINX- ¬øqu√© es y en qu√© se distingue de Apache-
* nginx-features

---

# nginx (expansi√≥n avanzada 2025)
`$= dv.current().file.tags.join(" ")`

- [devops](/uncategorized/devops/)
- [Backend](/uncategorized/backend/)
- [Redes](/uncategorized/redes/)
- [nginx](/nginx/nginx/)
- [proxy](/backend/proxy/)
- [microservicios](/backend/microservicios/)
- docker
- kubernetes

---

## üîå M√≥dulos y Extensibilidad
- **Arquitectura modular**
	- NGINX permite cargar m√≥dulos est√°ticos o din√°micos (desde v1.9.11)
	- `load_module modules/ngx_http_js_module.so;`
- **M√≥dulos populares**
	- `ngx_http_geoip_module`: geolocalizaci√≥n
	- `ngx_http_realip_module`: IP real del cliente detr√°s de proxy
	- `ngx_stream_module`: soporte TCP/UDP
	- `ngx_http_js_module` (ex njs): ejecutar JS dentro de NGINX
	- `ngx_http_lua_module` (OpenResty): scripting avanzado en Lua
- **OpenResty**
	- Framework sobre NGINX que permite l√≥gica compleja (autenticaci√≥n, rate limiting, APIs)
	- Usado para sistemas de alto rendimiento o edge computing

---

## üåê Protocolos Modernos y Comunicaci√≥n
- **HTTP/2 y HTTP/3 (QUIC)**
	- Soporte nativo desde versiones recientes
	- Configuraci√≥n:  
		{% raw %}
```nginx
		listen 443 ssl http2;
		```
{% endraw %}
		{% raw %}
```nginx
		listen 443 ssl http3;
		add_header Alt-Svc 'h3=":443"';
		```
{% endraw %}
	- Multiplexaci√≥n, compresi√≥n de cabeceras y menor latencia
- **WebSockets**
	- Proxy transparente con soporte full-duplex  
		{% raw %}
```nginx
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection "upgrade";
		```
{% endraw %}
- **gRPC**
	- `grpc_pass` para backend de microservicios
	- Integraci√≥n con API Gateway modernos y entornos [Kubernetes](/virtualizacion/kubernetes/)

---

## üß† Cach√© y Optimizaci√≥n
- **Proxy Cache**
	- `proxy_cache_path /data/nginx/cache keys_zone=my_cache:10m;`
	- Control de caducidad: `proxy_cache_valid 200 302 10m;`
- **FastCGI Cache**
	- Para backends PHP o Python
	- `fastcgi_cache_path /var/cache/nginx levels=1:2 keys_zone=phpcache:10m inactive=60m;`
- **Compresi√≥n y transporte**
	- `gzip on; gzip_types text/plain text/css application/json;`
	- `sendfile on; tcp_nopush on;`
- **Cach√© avanzada**
	- `proxy_cache_use_stale` para servir contenido viejo si el backend falla
	- Purga con herramientas externas (`nginx cache_purge` module)

---

## üõ°Ô∏è Seguridad Avanzada
- **Cabeceras de Seguridad**
	- `add_header X-Frame-Options "SAMEORIGIN";`
	- `add_header X-Content-Type-Options "nosniff";`
	- `add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";`
- **Rate Limiting**
	- `limit_req_zone $binary_remote_addr zone=limite:10m rate=10r/s;`
	- `limit_req zone=limite burst=20 nodelay;`
- **Autenticaci√≥n**
	- HTTP Basic: `auth_basic "Restricted";`
	- Integraci√≥n con OAuth2 / JWT mediante m√≥dulos externos
- **WAF (Web Application Firewall)**
	- Integraci√≥n con **ModSecurity** o **NAXSI**
	- Inspecci√≥n de patrones, SQLi/XSS, control por IP
- **SSL/TLS avanzado**
	- Curvas el√≠pticas y protocolos seguros:
		{% raw %}
```nginx
		ssl_protocols TLSv1.2 TLSv1.3;
		ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM';
		ssl_prefer_server_ciphers on;
		ssl_session_cache shared:SSL:10m;
		```
{% endraw %}
	- Certificados autom√°ticos con **Let's Encrypt** o **Certbot**
	- Soporte de OCSP Stapling y HSTS

---

## ‚öôÔ∏è Rendimiento y Tuning de Sistema
- **Par√°metros clave**
	- `worker_processes auto;`
	- `worker_connections 4096;`
	- `multi_accept on;`
	- `keepalive_timeout 65;`
- **Tuning SO**
	- Ajustar `ulimit -n` (l√≠mite de archivos abiertos)
	- `net.core.somaxconn` para backlog de conexiones
	- Uso de `epoll` y CPU affinity:
{% raw %}
```nginx
worker_cpu_affinity auto;
```
{% endraw %}
- **Observabilidad**
	- Logs JSON o extendidos para an√°lisis con Grafana / Prometheus
	- M√©tricas expuestas con `stub_status` o `ngx_http_status_module`
	- Integraci√≥n con herramientas APM (Elastic APM, Datadog)

---

## üß© Despliegue, CI/CD y Alta Disponibilidad
- **Zero-Downtime Reload**
	- `nginx -t && nginx -s reload`
	- Mantiene conexiones sin cortar sesiones
- **Blue-Green / Canary Deployments**
	- Definir pools de upstream alternativos
	- `split_clients` para enrutar tr√°fico por porcentaje
- **Rollback**
	- Versionar archivos de configuraci√≥n
	- Validar sintaxis en pipelines de GitHub Actions o Jenkins
- **Alta Disponibilidad**
	- Keepalived o HAProxy para failover
	- Replicaci√≥n de configuraciones con etcd o consul

---

## ‚òÅÔ∏è Edge, IoT y Serverless
- **NGINX en el Edge**
	- Integrado con Cloudflare Workers y AWS Lambda@Edge
	- Procesamiento local en gateways IoT (menor latencia)
- **NGINX + Serverless**
	- Front proxy hacia funciones (FaaS) como OpenFaaS o Knative
- **Multi-cloud**
	- Balanceo global con DNS din√°mico y health checks distribuidos

---

## üíº NGINX Plus vs Open Source
- **NGINX Open Source**
	- C√≥digo abierto, gran comunidad, extensible
- **NGINX Plus (comercial)**
	- Dashboard con m√©tricas en tiempo real
	- API REST de configuraci√≥n din√°mica
	- Health checks activos, session persistence, JWT nativo
	- Soporte profesional y actualizaciones priorizadas
- NGINX Controller: interfaz para gestionar m√∫ltiples instancias NGINX Plus

---

## üîç Buenas Pr√°cticas de Producci√≥n
- Validar configuraci√≥n antes de desplegar: `nginx -t`
- Usar `include` modular para sitios y entornos
- Versionar todos los `.conf` en Git
- Separar logs por entorno (`access_dev.log`, `access_prod.log`)
- Probar redirecciones y headers con:
	- `curl -I -L https://tusitio.com`
- Automatizar con Ansible / [Terraform](/devops/terraform/)

---

## üìö Referencias y Recursos
- [NGINX Docs](https://nginx.org/en/docs/)
- [Alphabetical Index of Directives](https://nginx.org/en/docs/dirindex.html)
- [OpenResty Official Site](https://openresty.org/)
- [NAXSI WAF](https://github.com/nbs-system/naxsi)
	- [CVE-2023-45132 \| INCIBE-CERT \| INCIBE](https://www.incibe.es/incibe-cert/alerta-temprana/vulnerabilidades/cve-2023-45132)
- [HTTP/3 in NGINX](https://www.nginx.com/blog/introducing-technology-preview-nginx-support-for-quic-http-3/)
- [Performance Tuning Guide](https://docs.nginx.com/nginx/admin-guide/web-server/tuning/)

# üìå Temas Adicionales Avanzados

### üß¨ Desarrollo de M√≥dulos Personalizados
- Escritura de m√≥dulos en C para NGINX (handler, filter, load-balancer) usando `ngx_command_t`, `ngx_module_t`, etc. :contentReference[oaicite:1]{index=1}  
- Uso de memoria compartida (`ngx_shared_memory_add`, `ngx_slab_alloc`) para almacenamiento entre procesos worker. :contentReference[oaicite:2]{index=2}  
- Sub-requests internos: emitir varias peticiones desde un m√≥dulo a backends internos y combinar los resultados. :contentReference[oaicite:3]{index=3}  
- Carga din√°mica de m√≥dulos (`.so`) con la directiva `load_module modules/‚Ä¶;` (soportado en NGINX Plus y Open Source con configuraci√≥n adecuada). :contentReference[oaicite:4]{index=4}  

### üîÑ Streaming y Protocolos de Nivel Bajo
- Proxy de TCP/UDP usando el contexto `stream { ‚Ä¶ }`, habilitando NGINX como proxy de nivel 4.  
- Soporte para streaming de medios (HLS, DASH) mediante `chunked_transfer_encoding`, configuraci√≥n `proxy_buffering`, `proxy_max_temp_file_size`. :contentReference[oaicite:5]{index=5}  
- T√©cnicas para reescritura compleja de URLs, variables de NGINX (`$http_user_agent`, `$scheme`, etc.), y reglas `rewrite`/`return` avanzadas. :contentReference[oaicite:6]{index=6}  

### üõ†Ô∏è Control de Acceso y Autenticaci√≥n Avanzada
- Validaci√≥n de tokens JWT, integraci√≥n con SSO, uso de m√≥dulos externos para autenticaci√≥n mediante OAuth2/OpenID Connect. :contentReference[oaicite:7]{index=7}  
- Listas de control de acceso por IP, geo-IP, cabeceras espec√≠ficas del cliente, bloqueos din√°micos (fail2ban, etc).  
- Cobertura de reglas WAF (Web Application Firewall) integradas o externas (por ejemplo ModSecurity). :contentReference[oaicite:9]{index=9}  

### üì¶ Cl√∫ster, Estado y Persistencia
- Persistencia de sesi√≥n (session stickiness) en balanceo de carga, replicaci√≥n de estado entre nodos, sincronizaci√≥n de configuraci√≥n. :contentReference[oaicite:10]{index=10}  
- Uso de etcd/consul para compartir configuraci√≥n entre m√∫ltiples instancias NGINX en un entorno de producci√≥n distribuido.  
- Monitoreo de estado de nodos upstream, health checks activas vs pasivas, con failover autom√°tico.

### üéØ T√©cnicas de Observabilidad y Telemetr√≠a
- Exposici√≥n de m√©tricas internas mediante `stub_status`, `ngx_http_status_module`, integraci√≥n con Prometheus/Grafana.  
- Logs estructurados (JSON) para ingesti√≥n en sistemas de logging centralizados, trazabilidad de peticiones y an√°lisis de latencia.  
- Uso de APM (Application Performance Monitoring) para identificar cuellos de botella en el stack proxy ‚Üí backend.

### üß™ Investigaci√≥n y Futuro
- Investigaciones recientes muestran pol√≠ticas de limpieza de cach√© mejoradas mediante aprendizaje por refuerzo integradas en NGINX. :contentReference[oaicite:13]{index=13}  
- Ataques emergentes como request smuggling y discrepancias de procesamiento entre proxies ‚Äî importante para arquitecturas compuestas. :contentReference[oaicite:14]{index=14}  

### ‚úÖ Resumen Final
Estos temas complementan lo que ya tienes: desarrollo a nivel de m√≥dulo, protocolos de bajo nivel, autenticaci√≥n avanzada, cl√∫steres distribuidos, observabilidad y las tendencias m√°s recientes de investigaci√≥n.  

# üß© Plantillas y Configuraci√≥n Avanzada de [nginx](/nginx/nginx/)

## üß¨ Desarrollo de M√≥dulos Personalizados

### Ejemplo: M√≥dulo C b√°sico
{% raw %}
```c
#include <ngx_config.h>
#include <ngx_core.h>
#include <ngx_http.h>

static ngx_int_t ngx_http_hello_handler(ngx_http_request_t *r) {
	r->headers_out.status = NGX_HTTP_OK;
	r->headers_out.content_type.len = sizeof("text/plain") - 1;
	r->headers_out.content_type.data = (u_char *)"text/plain";
	ngx_http_send_header(r);
	ngx_buf_t *b = ngx_create_temp_buf(r->pool, sizeof("Hello NGINX\n"));
	ngx_memcpy(b->pos, "Hello NGINX\n", sizeof("Hello NGINX\n"));
	b->last = b->pos + sizeof("Hello NGINX\n");
	b->last_buf = 1;
	ngx_chain_t out = { b, NULL };
	return ngx_http_output_filter(r, &out);
}

static ngx_http_module_t ngx_http_hello_module_ctx = {
	NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL
};

ngx_module_t ngx_http_hello_module = {
	NGX_MODULE_V1,
	&ngx_http_hello_module_ctx,
	NULL,
	NGX_HTTP_MODULE,
	NULL, NULL, NULL, NULL, NULL, NULL, NULL,
	NGX_MODULE_V1_PADDING
};
```
{% endraw %}`

### Compilaci√≥n y carga

{% raw %}
```bash
./configure --add-module=/path/to/hello_module
make && sudo make install
```
{% endraw %}

O din√°micamente:

{% raw %}
```nginx
load_module modules/ngx_http_hello_module.so;
```
{% endraw %}

---

## üîÑ Proxy TCP/UDP y Streaming (`stream {}`)

Permite a NGINX actuar como proxy de nivel 4 (TCP/UDP).

{% raw %}
```nginx
stream {
	upstream backend_tcp {
		server db1.example.com:3306;
		server db2.example.com:3306;
	}

	server {
		listen 3306;
		proxy_pass backend_tcp;
		proxy_timeout 10s;
		proxy_connect_timeout 3s;
	}
}
```
{% endraw %}

---

## üîê Autenticaci√≥n JWT / OAuth2

### Validaci√≥n JWT (con m√≥dulo `ngx_http_auth_jwt_module`)

{% raw %}
```nginx
http {
	server {
		listen 443 ssl;
		ssl_certificate /etc/ssl/certs/server.crt;
		ssl_certificate_key /etc/ssl/private/server.key;

		location /api/ {
			auth_jwt "API Restricted";
			auth_jwt_key_file /etc/nginx/keys/jwt_public.pem;
			proxy_pass http://backend_api;
		}
	}
}
```
{% endraw %}

### Autenticaci√≥n b√°sica con archivo de usuarios

{% raw %}
```bash
sudo apt install apache2-utils
htpasswd -c /etc/nginx/.htpasswd admin
```
{% endraw %}

{% raw %}
```nginx
location /secure/ {
	auth_basic "Restricted Zone";
	auth_basic_user_file /etc/nginx/.htpasswd;
	proxy_pass http://backend_secure;
}
```
{% endraw %}

---

## üìä Observabilidad y M√©tricas

### M√≥dulo `stub_status`

{% raw %}
```nginx
server {
	listen 8080;
	location /status {
		stub_status;
		allow 127.0.0.1;
		deny all;
	}
}
```
{% endraw %}

Salidas t√≠picas:

{% raw %}
```
Active connections: 15
accepts handled requests
 1024 1024 2048
Reading: 1 Writing: 2 Waiting: 12
```
{% endraw %}

### Exportaci√≥n Prometheus (m√≥dulo `nginx-prometheus-exporter`)

{% raw %}
```bash
docker run -d -p 9113:9113 \
	nginx/nginx-prometheus-exporter:latest \
	--nginx.scrape-uri http://localhost:8080/status
```
{% endraw %}

---

## üß† Reescrituras y Variables Avanzadas

### Reescritura condicional y regex

{% raw %}
```nginx
server {
	listen 80;
	server_name example.com;

	if ($http_user_agent ~* "(curl|wget)") {
		return 403;
	}

	location ~ ^/v([0-9]+)/api/(.*)$ {
		rewrite ^/v([0-9]+)/api/(.*)$ /api/v$1/$2 break;
		proxy_pass http://backend_api;
	}
}
```
{% endraw %}

### Headers y seguridad

{% raw %}
```nginx
add_header X-Frame-Options SAMEORIGIN;
add_header X-Content-Type-Options nosniff;
add_header Content-Security-Policy "default-src 'self'";
```
{% endraw %}

---

## ‚öôÔ∏è SSL / TLS Configuraci√≥n Completa

### Generar certificado autofirmado

{% raw %}
```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/ssl/private/nginx-selfsigned.key \
-out /etc/ssl/certs/nginx-selfsigned.crt
```
{% endraw %}

### Configuraci√≥n HTTPS

{% raw %}
```nginx
server {
	listen 443 ssl http2;
	server_name mydomain.com;

	ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
	ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;
	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_ciphers HIGH:!aNULL:!MD5;
	ssl_prefer_server_ciphers on;

	location / {
		proxy_pass http://127.0.0.1:8080;
	}
}
```
{% endraw %}

### Redirecci√≥n HTTP ‚Üí HTTPS

{% raw %}
```nginx
server {
	listen 80;
	server_name mydomain.com;
	return 301 https://$host$request_uri;
}
```
{% endraw %}

---

## ‚ö° Balanceo de carga con ‚Äúhealth checks‚Äù

{% raw %}
```nginx
upstream backend_cluster {
	server app1.example.com weight=3 max_fails=2 fail_timeout=10s;
	server app2.example.com;
	server app3.example.com backup;
}

server {
	listen 80;
	location / {
		proxy_pass http://backend_cluster;
		proxy_next_upstream error timeout invalid_header http_500;
	}
}
```
{% endraw %}

---

## üß™ Integraci√≥n con [Kubernetes](/virtualizacion/kubernetes/) / Docker Swarm

{% raw %}
```nginx
upstream app_cluster {
	server app1:3000;
	server app2:3000;
}

server {
	listen 80;
	location / {
		proxy_pass http://app_cluster;
	}
}
```
{% endraw %}

* Montar configmap:

{% raw %}
```bash
kubectl create configmap nginx-config --from-file=nginx.conf
kubectl apply -f nginx-deployment.yaml
```
{% endraw %}

---

## üî≠ Logs y formato JSON

{% raw %}
```nginx
log_format json_combined escape=json
	'{'
	'"time":"$time_iso8601",'
	'"remote_addr":"$remote_addr",'
	'"method":"$request_method",'
	'"uri":"$request_uri",'
	'"status":$status,'
	'"bytes_sent":$body_bytes_sent,'
	'"request_time":$request_time'
	'}';

access_log /var/log/nginx/access.log json_combined;
```
{% endraw %}

---

## üöÄ Optimizaci√≥n y Buenas Pr√°cticas 2025

* HTTP/3 (QUIC): habilitar con `listen 443 quic;` y `ssl_reuse`.
* Brotli compression (`ngx_brotli`): mejora ~20‚Äì30% frente a gzip.
* OCSP stapling: reduce handshake SSL.
* Caching adaptativo: integrar con Redis o Varnish para grandes cargas.
* Reverse proxy inteligente: detecci√≥n de latencia din√°mica para elegir upstream.
* Edge Computing con NGINX Unit: ejecuci√≥n de c√≥digo (Python, Go, Node.js) embebido.

---

## üìò Referencias

* [NGINX Docs](https://nginx.org/en/docs/)
* [NGINX Config Examples](https://github.com/nginxinc/examples)
* [NGINX Prometheus Exporter](https://github.com/nginxinc/nginx-prometheus-exporter)
* [OpenResty (NGINX + Lua)](https://openresty.org/en/)

# NGINX (actualizado 2025)
`$= dv.current().file.tags.join(" ")`

- [devops](/uncategorized/devops/)
- [Backend](/uncategorized/backend/)
- [Redes](/uncategorized/redes/)
- nginx-features
- [proxy](/backend/proxy/)
- [microservicios](/backend/microservicios/)
- security
- [Docker](/software%20engineering/docker/)
- [Kubernetes](/virtualizacion/kubernetes/)
- Load Balancing
- Observabilidad
- ssl-tls

---

## üß© Arquitectura moderna de NGINX
- **NGINX OSS vs NGINX Plus**
	- *OSS:* libre, ideal para proxy reverso, balanceo b√°sico y cacheo.
	- *Plus:* m√©tricas avanzadas, dashboards, health checks activos, JWT auth, API REST.
- **Procesamiento as√≠ncrono y basado en eventos** ‚Üí cada worker puede manejar miles de conexiones concurrentes.
- **Pipeline de peticiones**
	- Connection ‚Üí Request ‚Üí Phase Handlers ‚Üí Response.
	- Contextos: `main`, `events`, `http`, `server`, `location`.

---

## üîê SSL/TLS y seguridad avanzada

### Configuraci√≥n b√°sica SSL
{% raw %}
```nginx
server {
	listen 443 ssl http2;
	server_name example.com;

	ssl_certificate /etc/nginx/ssl/example.crt;
	ssl_certificate_key /etc/nginx/ssl/example.key;

	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_ciphers 'TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256';
	ssl_prefer_server_ciphers on;
	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
}
```
{% endraw %}`

### Comandos √∫tiles

{% raw %}
```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/nginx/ssl/self.key -out /etc/nginx/ssl/self.crt
nginx -t   # validar configuraci√≥n
nginx -s reload   # recargar configuraci√≥n sin reiniciar
```
{% endraw %}

### Seguridad moderna

* **TLS 1.3** habilitado por defecto (mejor handshake y menos latencia).
* **OCSP Stapling** y **Session Tickets** para acelerar validaciones.
* **Let's Encrypt** + `certbot` o **nginx-proxy-manager** para certificados autom√°ticos.
* **CSP, HSTS y seguridad de cabeceras**

  {% raw %}
```nginx
  add_header X-Frame-Options "SAMEORIGIN";
  add_header X-Content-Type-Options "nosniff";
  add_header Content-Security-Policy "default-src 'self';";
  ```
{% endraw %}
* **Protecci√≥n DDoS b√°sica**

  {% raw %}
```nginx
  limit_req_zone $binary_remote_addr zone=req_limit:10m rate=10r/s;
  location / {
  	limit_req zone=req_limit burst=20;
  }
  ```
{% endraw %}

---

## ‚öôÔ∏è Rendimiento y optimizaci√≥n

* **HTTP/3 + QUIC** (requiere `listen 443 quic reuseport;`)

  * mejora latencia en m√≥viles y redes inestables.
* **Compresi√≥n y cacheo**

  {% raw %}
```nginx
  gzip on;
  gzip_types text/plain text/css application/json;
  proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m;
  proxy_cache my_cache;
  ```
{% endraw %}
* **Conexiones persistentes y multiplexaci√≥n HTTP/2**

  * `keepalive_timeout 65;`
  * `http2_push_preload on;`

---

## üß† Balanceo y alta disponibilidad

* **Upstreams din√°micos**

  {% raw %}
```nginx
  upstream backend {
  	least_conn;
  	server app1:3000;
  	server app2:3000;
  }
  server {
  	location /api/ {
  		proxy_pass http://backend;
  	}
  }
  ```
{% endraw %}
* M√©todos: `round_robin`, `least_conn`, `ip_hash`, `hash key consistent;`
* **Health checks activos (NGINX Plus)** y pasivos (`max_fails`, `fail_timeout`).
* Integraci√≥n con **Consul, etcd, o Kubernetes Service Discovery**.
* **Zero downtime reload** ‚Üí `nginx -s reload`.

---

## üìä Observabilidad y m√©tricas

* **Logs estructurados JSON**

  {% raw %}
```nginx
  log_format json_combined escape=json '{ "time": "$time_iso8601", "remote_addr": "$remote_addr", "status": "$status", "request": "$request" }';
  access_log /var/log/nginx/access.log json_combined;
  ```
{% endraw %}
* **Exporters Prometheus/Grafana**

  * [nginx-prometheus-exporter](https://github.com/nginxinc/nginx-prometheus-exporter)
  * m√©tricas: requests, latency, workers, SSL stats.
* **Tracing distribuido**

  * `opentracing` module ‚Üí Jaeger o OpenTelemetry.

---

## üê≥ NGINX en entornos Docker y Kubernetes

* Usar `COPY nginx.conf /etc/nginx/nginx.conf` o templates con variables de entorno (`envsubst`).
* Configuraci√≥n din√°mica con `configMap` en K8s:

  {% raw %}
```yaml
  kind: ConfigMap
  apiVersion: v1
  metadata:
    name: nginx-config
  data:
    default.conf: |
      server {
        listen 80;
        location / {
          proxy_pass http://app-svc:8080;
        }
      }
  ```
{% endraw %}
* **NGINX Ingress Controller**

  * Controla el tr√°fico de entrada en cl√∫steres Kubernetes.
  * A√±ade reglas TLS, rutas por dominio y rate limiting global.
* Integraci√≥n con Traefik o Istio como gateway alternativos.

---

## üîÅ Automatizaci√≥n y CI/CD

* Despliegues con Ansible o [Terraform](/devops/terraform/).
* Integraci√≥n con pipelines CI/CD:

  * validaci√≥n `nginx -t` antes del deploy.
  * reload automatizado v√≠a webhook.
* Versionado de configuraciones (GitOps con ArgoCD o Flux).

---

## üß∞ Utilidades CLI

{% raw %}
```bash
nginx -v           # versi√≥n
nginx -V           # m√≥dulos compilados
ps aux | grep nginx  # procesos activos
sudo systemctl restart nginx
sudo nginx -T      # mostrar toda la config efectiva
```
{% endraw %}

---

## üåê Extensiones y m√≥dulos destacados

* **ModSecurity WAF** (Web Application Firewall)
* **ngx_brotli** ‚Üí compresi√≥n m√°s eficiente que gzip
* **ngx_stream_core_module** ‚Üí balanceo TCP/UDP
* **ngx_http_stub_status_module** ‚Üí endpoint `/status`
* **ngx_cache_purge** ‚Üí invalidaci√≥n manual de cach√©

---

## üì¶ Casos de uso modernos (2025)

* Proxy inverso para APIs, gRPC y WebSockets.
* Edge caching para contenido est√°tico global.
* Gateway de microservicios h√≠brido (con JWT y rate limits).
* Servir modelos IA o APIs de inferencia via HTTP/3.
* Frontend edge delivery (React/Vue/Svelte) en CDNs autoservidos.

---

## üîó Recursos

* [nginx.org/en/docs/](https://nginx.org/en/docs/)
* [Certbot](https://certbot.eff.org/)
* [NGINX Ingress Controller Docs](https://kubernetes.github.io/ingress-nginx/)
* [VeryAcademy - Nginx Mastery Series](https://github.com/veryacademy/yt-nginx-mastery-series)
* ssl-tls
* [proxy](/backend/proxy/)
* security


# üîê Configuraciones avanzadas SSL/TLS en NGINX (2025)

> Seguridad de capa de transporte moderna, automatizaci√≥n de certificados, y despliegues productivos.

---

### üßæ 1. Configuraci√≥n multi-dominio (SAN / SNI)

Permite servir varios dominios desde el mismo servidor o IP mediante **Server Name Indication (SNI)**.

{% raw %}
```nginx
# default_server como fallback
server {
	listen 443 ssl http2 default_server;
	server_name example.com www.example.com;

	ssl_certificate     /etc/ssl/example.crt;
	ssl_certificate_key /etc/ssl/example.key;
}

server {
	listen 443 ssl http2;
	server_name api.example.net;

	ssl_certificate     /etc/ssl/api.crt;
	ssl_certificate_key /etc/ssl/api.key;
}
```
{% endraw %}`

**Notas:**

* Cada `server_name` puede usar un certificado distinto.
* Let's Encrypt (Certbot o acme.sh) puede automatizar certificados SNI m√∫ltiples.

---

### üßÆ 2. OCSP Stapling (validaci√≥n optimizada)

Evita que el cliente contacte a la CA en cada conexi√≥n, mejorando la latencia SSL.

{% raw %}
```nginx
ssl_stapling on;
ssl_stapling_verify on;
ssl_trusted_certificate /etc/ssl/ca-chain.pem;
resolver 1.1.1.1 8.8.8.8 valid=300s;
resolver_timeout 5s;
```
{% endraw %}

**Ventaja:** reduce el tiempo del handshake TLS y evita bloqueos por CA lentas.

---

### üß© 3. Certificados Let's Encrypt autom√°ticos

Automatizaci√≥n de certificados gratis con **Certbot** o **nginx-proxy-manager**.

{% raw %}
```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d example.com -d www.example.com
```
{% endraw %}

Renovaci√≥n autom√°tica:

{% raw %}
```bash
sudo systemctl enable certbot.timer
sudo certbot renew --dry-run
```
{% endraw %}

**En Docker Compose**

{% raw %}
```yaml
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./certs:/etc/letsencrypt
```
{% endraw %}

---

### üß± 4. Redirecci√≥n HTTPS + HSTS

Redirige autom√°ticamente tr√°fico HTTP a HTTPS y aplica seguridad de transporte estricta.

{% raw %}
```nginx
server {
	listen 80;
	server_name example.com www.example.com;
	return 301 https://$host$request_uri;
}

server {
	listen 443 ssl http2;
	server_name example.com www.example.com;

	ssl_certificate /etc/ssl/example.crt;
	ssl_certificate_key /etc/ssl/example.key;
	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
}
```
{% endraw %}

---

### üßç‚Äç‚ôÇÔ∏è 5. Autenticaci√≥n mutua (mTLS)

Para APIs internas, IoT o servicios sensibles. El cliente tambi√©n presenta su certificado.

{% raw %}
```nginx
server {
	listen 443 ssl;
	server_name internal.example.com;

	ssl_certificate     /etc/ssl/server.crt;
	ssl_certificate_key /etc/ssl/server.key;
	ssl_client_certificate /etc/ssl/ca-clients.pem;
	ssl_verify_client on;

	location / {
		if ($ssl_client_verify != SUCCESS) {
			return 403;
		}
		proxy_pass http://backend_internal;
	}
}
```
{% endraw %}

**Flujo mTLS:**

1. El cliente se autentica con su propio certificado firmado.
2. NGINX valida con `ssl_client_certificate`.
3. Se puede inspeccionar `$ssl_client_s_dn` para logs o control de acceso.

---

### ‚ö° 6. HTTP/3 + QUIC (nuevo est√°ndar)

**NGINX 1.25+** y **OpenSSL 3+** incluyen soporte nativo. Mejora latencia y resiliencia.

{% raw %}
```nginx
server {
	listen 443 ssl http2;
	listen 443 quic reuseport;
	server_name example.com;

	ssl_certificate /etc/ssl/example.crt;
	ssl_certificate_key /etc/ssl/example.key;

	add_header Alt-Svc 'h3=":443"; ma=86400';
	add_header QUIC-Status $quic;
}
```
{% endraw %}

**Verificaci√≥n:**

{% raw %}
```bash
curl -I --http3 https://example.com
```
{% endraw %}

---

### üß∞ 7. TLS tuning (rendimiento y seguridad)

{% raw %}
```nginx
ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers 'TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256';
ssl_prefer_server_ciphers on;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 1d;
ssl_session_tickets off;
```
{% endraw %}

**Buenas pr√°cticas 2025:**

* Solo TLS 1.2 y 1.3.
* Desactivar `session_tickets` si no se rotan peri√≥dicamente.
* Configurar `ssl_buffer_size 4k;` para optimizar latencia.

---

### üîç 8. Monitorizaci√≥n SSL en producci√≥n

#### Logs detallados

{% raw %}
```nginx
log_format ssl '$remote_addr - $ssl_protocol/$ssl_cipher $status $bytes_sent';
access_log /var/log/nginx/ssl_access.log ssl;
```
{% endraw %}

#### M√©tricas Prometheus (con NGINX Plus o exporter)

* `nginx_ssl_handshakes_total`
* `nginx_ssl_session_reuses_total`
* `nginx_ssl_connections_active`

---

### üìò 9. Certificados wildcard y multi-site

Wildcard: `*.example.com` (√∫til para subdominios m√∫ltiples)

{% raw %}
```bash
sudo certbot certonly --manual --preferred-challenges=dns -d "*.example.com" -d example.com
```
{% endraw %}

En NGINX:

{% raw %}
```nginx
server {
	listen 443 ssl;
	server_name *.example.com;

	ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
}
```
{% endraw %}

---

### üß© 10. Integraci√≥n con NGINX Proxy Manager

* Interfaz web para crear hosts, redirecciones y certificados SSL autom√°ticamente.
* Manejador visual de reglas, listas blancas y redirecci√≥n HTTPS forzada.
* Certificados Let‚Äôs Encrypt renovados autom√°ticamente.

---

### üîó Recursos √∫tiles

* [Mozilla SSL Configuration Generator](https://ssl-config.mozilla.org/)
* [Let's Encrypt Docs](https://letsencrypt.org/docs/)
* [NGINX SSL/TLS Documentation](https://nginx.org/en/docs/http/configuring_https_servers.html)
* security
* [proxy](/backend/proxy/)
* ssl-tls
* nginx-features

{% raw %}
```

---

¬øQuieres que te prepare una **nota separada de ‚Äúnginx-ssl-tls-cheatsheet‚Äù** con solo comandos, configuraciones y buenas pr√°cticas resumidas para producci√≥n (sin explicaciones)?  
Ser√≠a ideal para consultas r√°pidas o automatizaci√≥n CI/CD.
```
{% endraw %}



# üß† Glosario NGINX (2025)

> Diccionario t√©cnico con los conceptos y tecnolog√≠as relacionados con NGINX, proxies, microservicios y seguridad SSL/TLS.  
> Ideal como referencia cruzada con notas como [proxy](/backend/proxy/), nginx-features, [microservicios](/backend/microservicios/), [Docker](/software%20engineering/docker/), [Kubernetes](/virtualizacion/kubernetes/), Traefik y security.

---

## üî© Fundamentos de NGINX

- **NGINX** ‚Üí Servidor web, proxy inverso, balanceador de carga y cacheador de alto rendimiento.  
  Dise√±ado para manejar concurrencia masiva mediante arquitectura *event-driven* y *non-blocking I/O*.

- **Worker processes** ‚Üí Procesos que manejan las conexiones y peticiones. Su n√∫mero determina el paralelismo.

- **Master process** ‚Üí Proceso principal que gestiona la configuraci√≥n y lanza los workers.

- **Directives** ‚Üí Instrucciones individuales en los archivos de configuraci√≥n (`nginx.conf`), que definen comportamiento.

- **Contextos (`main`, `http`, `server`, `location`)** ‚Üí √Åmbitos jer√°rquicos donde se aplican las directivas.

- **Entrypoint** ‚Üí Punto de entrada de una aplicaci√≥n o servicio. En NGINX, es una combinaci√≥n de `server` + `location`.

---

## üß± Arquitectura y configuraci√≥n

- **Virtual Hosts** ‚Üí Configuraciones de m√∫ltiples sitios web en un solo servidor.  
  Se crean en bloques `server` definidos por `server_name`.

- **Sites-available / sites-enabled** ‚Üí Convenci√≥n usada en distribuciones Linux (Debian, Ubuntu) para organizar hosts activos.

- **Reverse Proxy** ‚Üí Intermediario que recibe peticiones del cliente y las reenv√≠a al backend.  
  Ejemplo: `proxy_pass http://backend_service;`

- **Forward Proxy** ‚Üí Proxy usado por clientes para acceder a recursos externos (poco com√∫n en NGINX).

- **Upstream** ‚Üí Grupo de servidores backend definidos para balanceo de carga.  
  {% raw %}
```nginx
  upstream api_servers {
    server api1:3000;
    server api2:3000;
  }
```
{% endraw %}`

* **Location blocks** ‚Üí Secciones que determinan el enrutamiento seg√∫n patrones de URL o expresiones regulares.

* **Headers personalizados** ‚Üí Variables como `$host`, `$remote_addr`, `$request_uri` se pueden enviar a los backends con:

  {% raw %}
```nginx
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  ```
{% endraw %}

* **Buffer** ‚Üí Almacenamiento temporal de peticiones y respuestas. Controla rendimiento y latencia.

---

## ‚öôÔ∏è Comandos esenciales

* `nginx -t` ‚Üí Verifica sintaxis de configuraci√≥n.
* `nginx -s reload` ‚Üí Recarga configuraci√≥n sin reiniciar el proceso.
* `nginx -s stop` ‚Üí Detiene el servicio.
* `nginx -V` ‚Üí Muestra versi√≥n y m√≥dulos compilados.
* `ps aux | grep nginx` ‚Üí Verifica procesos activos.

---

## üß≠ Enrutamiento y balanceo de carga

* **Load Balancer (Balanceador de carga)** ‚Üí Distribuye tr√°fico entre varios backends.
  M√©todos comunes:

  * *Round Robin*: distribuci√≥n uniforme.
  * *Least Connections*: elige el servidor menos ocupado.
  * *IP Hash*: mantiene afinidad de sesi√≥n seg√∫n IP.
  * *Hash basado en cookie o header*: √∫til para servicios con estado.

* **Router** ‚Üí Reglas que determinan a qu√© backend se dirige cada petici√≥n (por URL, cabecera o m√©todo HTTP).

* **Regex Matching** ‚Üí Uso de expresiones regulares en `location ~` o `if` para patrones de enrutamiento complejos.

* **Health checks** ‚Üí Verificaci√≥n de disponibilidad de backends en configuraciones `upstream`.

---

## üß∞ Docker, DevOps y despliegue

* **Imagen oficial de NGINX** ‚Üí Disponible en [Docker Hub](https://hub.docker.com/_/nginx) o [Docker](/software%20engineering/docker/).

* **Vol√∫menes (`-v`)** ‚Üí Mapear directorios locales al contenedor (para logs o configuraci√≥n):

  {% raw %}
```bash
  docker run -d -p 80:80 -v ./nginx.conf:/etc/nginx/nginx.conf nginx
  ```
{% endraw %}

* **Templates y envfiles** ‚Üí Plantillas din√°micas para generar configuraciones basadas en variables de entorno.

* **Nginx Proxy Manager (NPM)** ‚Üí Interfaz web para crear hosts, certificados SSL, y redirecciones visualmente.
  Permite automatizar:

  * Redirecciones HTTP/HTTPS.
  * Certificados Let‚Äôs Encrypt.
  * Whitelist de IPs.
  * Redirecci√≥n entre contenedores (DNS interno).

* **Docker Swarm / Kubernetes** ‚Üí Orquestadores que gestionan m√∫ltiples instancias de NGINX en cl√∫steres distribuidos.

---

## üîí Seguridad, SSL y TLS

* **SSL (Secure Sockets Layer)** ‚Üí Protocolo original para cifrado en red.

* **TLS (Transport Layer Security)** ‚Üí Evoluci√≥n moderna de SSL, usada actualmente (TLS 1.2, TLS 1.3).

* **Certificados** ‚Üí Archivos `.crt` (p√∫blico) y `.key` (privado).
  Se generan con `openssl` o Let's Encrypt.

* **OCSP Stapling** ‚Üí Mecanismo que acelera la validaci√≥n de certificados al incluir informaci√≥n de estado en el handshake.

* **SNI (Server Name Indication)** ‚Üí Permite a NGINX servir m√∫ltiples dominios SSL en la misma IP.

* **HSTS (HTTP Strict Transport Security)** ‚Üí Pol√≠tica que fuerza al cliente a usar HTTPS.

  {% raw %}
```nginx
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
  ```
{% endraw %}

* **mTLS (Mutual TLS)** ‚Üí Autenticaci√≥n mutua cliente-servidor mediante certificados.
  Ideal para APIs internas o IoT.

* **Certbot** ‚Üí Herramienta de Let's Encrypt para emitir y renovar certificados autom√°ticamente.

* **Wildcard Certificate** ‚Üí Certificado que cubre todos los subdominios de un dominio: `*.example.com`.

* **OCSP/CRL** ‚Üí Mecanismos de revocaci√≥n de certificados.

* **HTTP/2 y HTTP/3** ‚Üí Protocolos modernos que mejoran rendimiento y seguridad sobre TLS.

* **QUIC** ‚Üí Protocolo basado en UDP que permite conexiones m√°s r√°pidas y resilientes (usado en HTTP/3).

---

## üßÆ Performance y optimizaci√≥n

* **Cache** ‚Üí Almacenamiento de respuestas para reducir carga en backend (`proxy_cache`, `fastcgi_cache`).

* **Compression (gzip, brotli)** ‚Üí Compresi√≥n de respuestas HTTP para reducir tama√±o de transferencia.

* **Chunked Encoding** ‚Üí Segmentaci√≥n de respuestas en fragmentos para streaming o contenido din√°mico.

* **Keep-Alive Connections** ‚Üí Mantiene conexiones abiertas para reducir latencia entre cliente y servidor.

* **Session Resumption / Tickets** ‚Üí Reutilizaci√≥n de sesiones TLS para acelerar reconexiones.

* **HTTP/3** ‚Üí Reduce latencia y mejora confiabilidad en redes inestables (basado en QUIC/UDP).

---

## üåê DNS, dominios y redes

* **DNS A record** ‚Üí Asocia un dominio a una IP.
* **Loopback Router** ‚Üí Permite redirigir tr√°fico local (localhost ‚Üí dominio simulado).
* **DuckDNS** ‚Üí Servicio gratuito de DNS din√°mico (√∫til para entornos dom√©sticos o pruebas).
* **Proxy DNS interno** ‚Üí Resoluci√≥n de nombres entre contenedores dentro de la red Docker.

---

## üß† Integraciones y extensiones

* **API Gateway** ‚Üí Puerta de entrada unificada a microservicios. Controla autenticaci√≥n, rate-limiting y logs.
* **Grafana / Prometheus** ‚Üí Herramientas de monitorizaci√≥n.
  Exponen m√©tricas de NGINX (con `nginx-exporter` o `nginx-plus`).
* **Traefik** ‚Üí Alternativa moderna a NGINX Proxy Manager, nativa para Docker/Kubernetes.
* **Service Workers** ‚Üí Scripts del lado del cliente que controlan caching, routing y offline-first en apps web.

---

## üìä Logs y monitorizaci√≥n

* **Access Logs / Error Logs** ‚Üí Archivos donde se registran peticiones y errores.

  {% raw %}
```nginx
  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log warn;
  ```
{% endraw %}

* **Formato de log personalizado**

  {% raw %}
```nginx
  log_format main '$remote_addr - $ssl_protocol/$ssl_cipher $status $bytes_sent';
  ```
{% endraw %}

* **M√©tricas √∫tiles**

  * `nginx_ssl_handshakes_total`
  * `nginx_ssl_session_reuses_total`
  * `nginx_http_requests_total`
  * `nginx_connections_active`

---

## üìö Recursos recomendados

* [NGINX Documentation](https://nginx.org/en/docs/)
* [Alphabetical Index of Directives](https://nginx.org/en/docs/dirindex.html)
* [Mozilla SSL Configuration Generator](https://ssl-config.mozilla.org/)
* [Let's Encrypt Docs](https://letsencrypt.org/docs/)
* [NGINX Mastery Series - VeryAcademy](https://github.com/veryacademy/yt-nginx-mastery-series)
* Beginner‚Äôs Guide
* nginx-features
* [proxy](/backend/proxy/)
* security
* docker
* [microservicios](/backend/microservicios/)


# üßæ nginx-cheatsheet-commands
`$= dv.current().file.tags.join(" ")`

> Referencia r√°pida de comandos, bloques de configuraci√≥n y directivas NGINX.  
> Relacionado con [nginx](/nginx/nginx/), [proxy](/backend/proxy/), SSL, [Docker](/software%20engineering/docker/), DevOps y [microservicios](/backend/microservicios/).

---

## üß© Comandos b√°sicos

{% raw %}
```bash
nginx -t                # Verifica sintaxis
nginx -s reload         # Recarga configuraci√≥n
nginx -s stop           # Detiene el servicio
nginx -s quit           # Detiene de forma segura
nginx -V                # Ver versi√≥n y m√≥dulos
ps aux | grep nginx     # Procesos activos
systemctl status nginx  # Estado del servicio
systemctl restart nginx # Reinicia nginx
```
{% endraw %}`

---

## üß± Estructura general de configuraci√≥n

{% raw %}
```nginx
worker_processes auto;

events {
	worker_connections 1024;
}

http {
	include mime.types;
	default_type application/octet-stream;
	sendfile on;

	server {
		listen 80;
		server_name example.com www.example.com;

		location / {
			root /usr/share/nginx/html;
			index index.html;
		}
	}
}
```
{% endraw %}

---

## üåê Reverse Proxy

{% raw %}
```nginx
server {
	listen 80;
	server_name api.example.com;

	location / {
		proxy_pass http://backend:3000;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}
```
{% endraw %}

---

## ‚öñÔ∏è Load Balancing

{% raw %}
```nginx
upstream backend_cluster {
	server backend1:3000;
	server backend2:3000;
	# server backend3:3000 backup;
}

server {
	listen 80;
	server_name app.example.com;

	location / {
		proxy_pass http://backend_cluster;
	}
}
```
{% endraw %}

**M√©todos de balanceo:**

{% raw %}
```nginx
# round-robin (por defecto)
# least_conn; (menos conexiones activas)
# ip_hash; (persistencia por IP)
# hash $cookie_sessionid consistent;
```
{% endraw %}

---

## üîí SSL / TLS Configuraci√≥n segura

{% raw %}
```nginx
server {
	listen 443 ssl http2;
	server_name example.com;

	ssl_certificate /etc/ssl/certs/example.crt;
	ssl_certificate_key /etc/ssl/private/example.key;
	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM';
	ssl_prefer_server_ciphers on;
	ssl_session_cache shared:SSL:10m;
	ssl_session_timeout 1h;

	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
	add_header X-Frame-Options DENY;
	add_header X-Content-Type-Options nosniff;

	location / {
		proxy_pass http://backend:3000;
	}
}
```
{% endraw %}

**Redirecci√≥n HTTP ‚Üí HTTPS**

{% raw %}
```nginx
server {
	listen 80;
	server_name example.com;
	return 301 https://$host$request_uri;
}
```
{% endraw %}

**Comandos SSL**

{% raw %}
```bash
openssl req -newkey rsa:2048 -nodes -keyout example.key -x509 -days 365 -out example.crt
openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048
certbot --nginx -d example.com -d www.example.com
```
{% endraw %}

---

## üß∞ Logs y depuraci√≥n

{% raw %}
```nginx
access_log /var/log/nginx/access.log;
error_log /var/log/nginx/error.log warn;

log_format main '$remote_addr - $remote_user [$time_local] '
				'"$request" $status $body_bytes_sent '
				'"$http_referer" "$http_user_agent"';
```
{% endraw %}

**Ver actividad**

{% raw %}
```bash
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```
{% endraw %}

---

## üßÆ Performance

{% raw %}
```nginx
gzip on;
gzip_types text/plain application/json application/javascript text/css;
gzip_min_length 1024;

keepalive_timeout 65;
sendfile on;
tcp_nopush on;
tcp_nodelay on;
```
{% endraw %}

**Cache est√°tica**

{% raw %}
```nginx
location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
	expires 30d;
	add_header Cache-Control "public, no-transform";
}
```
{% endraw %}

---

## üß≠ Docker y NGINX

**Dockerfile**

{% raw %}
```dockerfile
FROM nginx:stable
COPY ./nginx.conf /etc/nginx/nginx.conf
EXPOSE 80 443
```
{% endraw %}

**docker-compose.yml**

{% raw %}
```yaml
version: '3.8'
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certs:/etc/ssl/certs:ro
      - ./logs:/var/log/nginx
    networks:
      - proxy_net

networks:
  proxy_net:
    driver: bridge
```
{% endraw %}

---

## üîå Proxy Manager / API Gateway

{% raw %}
```bash
# Acceder al panel Nginx Proxy Manager (Docker)
http://localhost:81

# Crear Proxy Host
# - Dominio: app.local
# - Forward Hostname / IP: backend
# - Forward Port: 3000
# - SSL: Let‚Äôs Encrypt (auto-renovaci√≥n)
```
{% endraw %}

**Ejemplo configuraci√≥n DNS local (hosts)**

{% raw %}
```
127.0.0.1 app.local
```
{% endraw %}

---

## üß† Utilidades avanzadas

{% raw %}
```bash
# Reiniciar NGINX dentro de contenedor
docker exec -it nginx nginx -s reload

# Ver archivos de configuraci√≥n activos
docker exec -it nginx cat /etc/nginx/nginx.conf

# Generar certificado auto-firmado
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout mysite.key -out mysite.crt -subj "/CN=mysite.local"
```
{% endraw %}

---

## üåç HTTP/2 / HTTP/3 / QUIC

{% raw %}
```nginx
server {
	listen 443 ssl http2;
	# Para HTTP/3 (requiere nginx-quic build)
	listen 443 quic reuseport;

	add_header Alt-Svc 'h3=":443"; ma=86400';
	add_header QUIC-Status $quic;
}
```
{% endraw %}

---

## üßæ Redirecciones, subdominios y DNS

{% raw %}
```nginx
server {
	listen 80;
	server_name blog.example.com;
	location / {
		proxy_pass http://blog_backend:4000;
	}
}
```
{% endraw %}

**DuckDNS / DNS din√°mico**

{% raw %}
```bash
curl "https://www.duckdns.org/update?domains=mydomain&token=<TOKEN>&ip="
```
{% endraw %}

---

## üîê Mutual TLS (mTLS)

{% raw %}
```nginx
ssl_verify_client on;
ssl_client_certificate /etc/ssl/certs/ca.crt;
```
{% endraw %}

---

## üîç Diagn√≥stico

{% raw %}
```bash
curl -I http://localhost
curl -vk https://example.com
sudo netstat -tulpn | grep nginx
sudo lsof -i :443
```
{% endraw %}

---

## üì¶ Useful paths (Linux)

{% raw %}
```
/etc/nginx/nginx.conf
/etc/nginx/sites-available/
/etc/nginx/sites-enabled/
/var/log/nginx/
```
{% endraw %}

---

## üìö Referencias

* [nginx.org/en/docs](https://nginx.org/en/docs/)
* [Mozilla SSL Config Generator](https://ssl-config.mozilla.org/)
* [nginx](/nginx/nginx/)
* nginx-features
* [proxy](/backend/proxy/)
* docker
* [devops](/uncategorized/devops/)
* security




# omnivore nginx
{% raw %}
```base
type: list
name: "Notas con #nginx en Omnivore"
order:
  - property: date_saved
    direction: desc
columns:
  - file.name
  - date_saved
filters:
  and:
    - file.inFolder("Omnivore")
    - file.hasTag("nginx")
views:
  - type: table
    name: Table
    sort:
      - property: file.mtime
        direction: DESC

```
{% endraw %}

