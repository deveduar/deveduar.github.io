---
date: 2024-12-11 16:35
title: proxy
tags:
keywords:
source:
status: üåü
Parent: "[[Area-Sistemas]]"
cssclasses:
public_note: "true"
category: proxy
categories:
  - proxy
  - hide-embedded-header1
  - Backend
---
# Proxy
`$= dv.current().file.tags.join(" ")`

- [Redes](/uncategorized/redes/)
- DevOps
- 
- [nginx](/backend/nginx/)
- Traefik
- [apache](/backend/apache/)

---

## Concepto General

Un **proxy** act√∫a como intermediario entre un cliente y un servidor. Su funci√≥n principal es redirigir o filtrar solicitudes, ofreciendo beneficios como seguridad, anonimato, cacheo y control del tr√°fico. Puede operar en distintas capas del modelo OSI, generalmente en la capa de aplicaci√≥n (HTTP/HTTPS).

**Tipos principales:**
- **Forward Proxy (Proxy directo)**: se sit√∫a entre el cliente y el servidor externo, controlando el acceso a internet y ocultando la identidad del cliente.
- **Reverse Proxy (Proxy inverso)**: se ubica entre los clientes externos y los servidores internos, gestionando el acceso, seguridad, y distribuci√≥n de carga.

---

## Forward Proxy

El **forward proxy** representa al cliente frente a los servidores. Se utiliza com√∫nmente en redes corporativas o educativas para:
- **Control de acceso:** restringir sitios o contenidos.
- **Anonimato:** ocultar la IP real del usuario.
- **Cach√© de contenido:** almacenar respuestas frecuentes para reducir consumo de ancho de banda.
- **Seguridad:** filtrar tr√°fico saliente y detectar actividad sospechosa.

**Ejemplo de flujo:**
1. El cliente solicita acceso a un sitio web.
2. El proxy recibe la solicitud y, si est√° permitido, la reenv√≠a al servidor externo.
3. El proxy devuelve la respuesta al cliente, pudiendo almacenarla en cach√©.

---

## Reverse Proxy

El **reverse proxy** representa al servidor frente a los clientes. Se usa en entornos de producci√≥n y alta disponibilidad.

**Funciones clave:**
- **Balanceo de carga:** distribuye solicitudes entre varios servidores backend.
- **Seguridad:** oculta la estructura interna del sistema y act√∫a como capa de protecci√≥n (WAF, autenticaci√≥n).
- **Cach√© y compresi√≥n:** mejora el rendimiento sirviendo contenido est√°tico r√°pidamente.
- **Terminaci√≥n SSL/TLS:** maneja el cifrado, descargando esta tarea de los servidores backend.

**Ejemplo de flujo:**
1. Un cliente realiza una petici√≥n a un dominio.
2. El reverse proxy recibe la solicitud y la redirige al servidor adecuado.
3. El proxy devuelve la respuesta como si proviniera directamente del servidor.

---

## Balanceo de Carga

El balanceo de carga distribuye solicitudes entre varios servidores para optimizar el rendimiento y la disponibilidad del sistema.

**Algoritmos comunes:**
- *Round Robin:* asigna solicitudes de forma secuencial.
- *Least Connections:* dirige la solicitud al servidor con menos conexiones activas.
- *IP Hash:* mantiene la sesi√≥n del cliente en el mismo servidor seg√∫n su IP.

**Ventajas:**
- Escalabilidad horizontal.
- Redundancia y tolerancia a fallos.
- Mejor tiempo de respuesta.

---

## Implementaciones Comunes

### [nginx](/backend/nginx/)
- Altamente eficiente como reverse proxy y balanceador de carga.
- Admite HTTP, HTTPS, TCP y UDP.
- Configuraci√≥n simple y gran rendimiento bajo alta concurrencia.

### [apache](/backend/apache/)
- Amplio soporte de m√≥dulos (mod_proxy, mod_cache).
- Vers√°til: puede actuar como servidor web y proxy simult√°neamente.
- Ideal para entornos configurables y de compatibilidad amplia.

### squid
- Enfocado en *forward proxy* y cach√©.
- Amplias capacidades de filtrado y autenticaci√≥n.
- Usado frecuentemente en redes corporativas para control de acceso a internet.

---

## Ejemplos de Configuraci√≥n

### Nginx Reverse Proxy
{% raw %}
```nginx
server {
	listen 80;
	server_name example.com;

	location / {
		proxy_pass http://backend_server;
		proxy_set_header Host $host;
		proxy_set_header X-Real-IP $remote_addr;
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	}
}
```
{% endraw %}`

### Apache como Reverse Proxy

{% raw %}
```apache
<VirtualHost *:80>
	ServerName example.com
	ProxyPreserveHost On
	ProxyPass / http://backend_server/
	ProxyPassReverse / http://backend_server/
</VirtualHost>
```
{% endraw %}

### Squid Forward Proxy

{% raw %}
```conf
http_port 3128
acl localnet src 192.168.0.0/16
http_access allow localnet
http_access deny all
cache_mem 256 MB
maximum_object_size 50 MB
```
{% endraw %}

---

## Seguridad y Buenas Pr√°cticas

* Usar HTTPS y certificados v√°lidos para proteger la comunicaci√≥n.
* Limitar el acceso administrativo del proxy.
* Implementar listas blancas/negras de dominios o IPs.
* Activar logs y auditor√≠as.
* Actualizar con regularidad para evitar vulnerabilidades conocidas.

---

## Recursos y Documentaci√≥n

* Servidor proxy - Wikipedia, la enciclopedia libre-Servidor_proxy
* Documentaci√≥n oficial:
  * [Nginx Proxy Docs](https://nginx.org/en/docs/)
  * [Apache mod_proxy](https://httpd.apache.org/docs/current/mod/mod_proxy.html)
  * [Squid Official Documentation](http://www.squid-cache.org/Doc/)

# Proxy (Ampliaci√≥n)
`$= dv.current().file.tags.join(" ")`
## Conceptos Avanzados

### Protocolos y modos de operaci√≥n
- Un proxy puede operar en varios protocolos: HTTP, HTTPS, FTP, SOCKS, TCP gen√©rico.  
- Modo *transparente* (‚Äútransparent proxy‚Äù): el cliente no necesita configuraci√≥n expl√≠cita; el proxy intercepta tr√°fico de forma ‚Äúinvisible‚Äù.  
- Modo *expl√≠cito*: el cliente est√° configurado para usar el proxy (direcci√≥n, puerto, credenciales).  
- Modo *reverse-t√∫nel / t√∫nel inverso*: especialmente usado cuando se desea exponer un servicio interno desde afuera pasando por un proxy intermedio.

### Cabeceras HTTP y trazabilidad
- Cabecera `X-Forwarded-For`: permite que un servidor identificase la IP original del cliente que pas√≥ por uno o m√°s proxies. :contentReference[oaicite:0]{index=0}  
- Cabecera `Forwarded`: est√°ndar m√°s moderno que `X-Forwarded-For`.  
- Es importante configurar correctamente el proxy para evitar falsificaci√≥n de estas cabeceras (spoofing).

### TLS/SSL y terminaci√≥n de cifrado
- Un tipo especializado: TLS termination proxy (proxy de terminaci√≥n TLS): descifra las conexiones cifradas, inspecciona/controla tr√°fico, y vuelve a cifrar o no seg√∫n configuraci√≥n. :contentReference[oaicite:2]{index=2}  
- Esto permite: inspecci√≥n de tr√°fico HTTPS, descarga de carga de cifrado desde los servidores backend, centralizaci√≥n de certificados.

### Cach√© avanzada y optimizaci√≥n
- Los proxies pueden almacenar en cach√© no s√≥lo contenido est√°tico (im√°genes, CSS) sino tambi√©n respuestas din√°micas aunque con cuidado (TTL, invalidaci√≥n, coherencia).  
- Algunos proxies implementan *prefetching* (anticipar peticiones) o *compression on the fly* (comprimir respuestas antes de enviarlas).  
- Utilizaci√≥n de t√©cnicas de *edge caching* cuando el proxy opera cercano al usuario (ej. en CDNs) para reducir latencia.

### Pol√≠ticas de seguridad y filtrado
- Filtrado de URLs, dominios, categor√≠as de contenido, listas blancas/negras.  
- Autenticaci√≥n del cliente (usuarios, grupos) antes de permitir acceso a trav√©s del proxy.  
- Protecci√≥n contra amenazas: bloqueo de malware, DDoS, bots, inspecci√≥n de tr√°fico (WAF integrado).  
- Registro (‚Äúlogging‚Äù) y auditor√≠a del tr√°fico, seguimiento de conformidad y cumplimiento normativo.

### Arquitecturas combinadas
- Sistemas h√≠bridos: forward proxy + reverse proxy en la misma infraestructura para cubrir tanto tr√°fico saliente como entrante.  
- Uso de proxies en microservicios: cada servicio puede tener su propio proxy (service mesh) actuando como ‚Äúsidecar‚Äù o ‚Äúingress/egress proxy‚Äù.  
- Redundancia y alta disponibilidad: proxies en cl√∫ster con sincronizaci√≥n, failover y estado compartido.

### Proxy inverso y balanceo de carga (profundizaci√≥n)
- La funci√≥n de balanceo incluye algoritmos como *round robin*, *least connections*, *ip hash*. :contentReference[oaicite:3]{index=3}  
- Puede incorporarse en el reverse proxy soporte para *session persistence* (o ‚Äústicky sessions‚Äù) donde un cliente contin√∫a en el mismo backend.  
- Distribuci√≥n geogr√°fica: el proxy/internacional (o CDN) redirige al servidor m√°s cercano al usuario para latencia reducida. :contentReference[oaicite:4]{index=4}  
- Reescritura de URLs y redirecciones: un reverse proxy puede modificar peticiones/respuestas para adaptarse a estructuras internas de servidor.

### Proxy forward (profundizaci√≥n)
- En entornos corporativos, se utiliza para control de acceso a Internet, caching centralizado, bloqueo de contenidos no deseados, anonimato. :contentReference[oaicite:5]{index=5}  
- Tambi√©n se usa para scraping/web-crawling, rotaci√≥n de IPs, bypass de restricciones geogr√°ficas. :contentReference[oaicite:6]{index=6}  
- Consideraciones de privacidad: un forward proxy puede registrar todas las solicitudes de los clientes, por lo que la pol√≠tica de privacidad y cumplimiento (GDPR, etc.) es importante.

---

## Casos de Uso Emergentes

- Proxies en *service mesh* (ej. Istio, Linkerd): cada microservicio tiene un proxy ‚Äúsidecar‚Äù para controlar tr√°fico, autenticaci√≥n, encriptaci√≥n, observabilidad.  
- Proxies para APIs: actuando como puerta de entrada (‚ÄòAPI Gateway‚Äô) supervisando, autenticando, limitando peticiones (rate-limiting).  
- Proxies IoT / Edge: en redes de dispositivos IoT, se usan proxies ligeros al borde de la red para filtrar tr√°fico de dispositivos y centralizar gesti√≥n.  
- Proxies para WebRTC / media streaming: mediando conexiones P2P, gestionando TURN/STUN, retransmitiendo contenido.

---

## Consideraciones de Implementaci√≥n

- Dimensionamiento del hardware: proxies de alto tr√°fico requieren muchos recursos (CPU para cifrado, memoria para cach√©, red de alta velocidad).  
- Latencia adicional: aunque el proxy da muchos beneficios, introduce un ‚Äúhop‚Äù extra en la cadena; debe optimizarse para minimalizar impacto.  
- Escalabilidad y autoscaling: los proxies deben escalar horizontalmente, con mecanismo de descubrimiento de nuevos nodos, balanceo interno.  
- Monitorizaci√≥n y m√©tricas clave: tasa de aciertos de cach√©, latencia de respuesta, conexiones activas, errores de backend, uso de CPU/RAM.  
- Seguridad del propio proxy: el proxy se convierte en un punto cr√≠tico ‚Äî debe protegerse, actualizarse, auditarse.

---

## Relaci√≥n con otros componentes de arquitectura

- HAProxy: muy usado como proxy reversible y balanceador de carga.  
- CDN (Content Delivery Network): muchos CDNs usan internamente reverse proxies distribuidos globalmente.  
- API Gateway: un tipo especializado de reverse proxy que adem√°s incluye l√≥gica de aplicaci√≥n (autenticaci√≥n, limitaci√≥n, transformaci√≥n).  
- VPN vs Proxy: aunque ambos pueden ocultar la IP del cliente, una VPN cifra el t√∫nel completo mientras que un proxy t√≠picamente s√≥lo act√∫a sobre solicitudes espec√≠ficas.  
- Firewall de Aplicaciones Web (WAF): a menudo se integra en un reverse proxy para inspecci√≥n m√°s profunda de tr√°fico HTTP/HTTPS.

---

## T√©rminos Complementarios / Glosario

- **Proxy transparente**: intercepta tr√°fico sin configuraci√≥n del cliente.  
- **TLS offloading**: ver ‚Äúterminaci√≥n TLS‚Äù.  
- **Session persistence (sticky-session)**: en load balancing, mantener al cliente en el mismo servidor backend.  
- **Edge caching**: caching en nodos cercanos al usuario (usualmente parte de una infraestructura de reverse proxy/CDN).  
- **Rate-limiting**: control del n√∫mero de peticiones que un cliente puede enviar a trav√©s del proxy en un lapso de tiempo.  
- **Blacklist / Whitelist**: listas de dominios/IPs bloqueadas o permitidas por el proxy.  
- **Man-in-the-Middle (MITM) proxy**: cuando el proxy intercepta y descifra tr√°fico cifrado para inspecci√≥n (requiere certificados, configuraci√≥n espec√≠fica).  
- **Sidecar proxy**: patr√≥n en arquitecturas de microservicios donde cada servicio lleva un peque√±o proxy ‚Äúlado a lado‚Äù.

---

### Recursos Adicionales
- Revisi√≥n comparativa: *‚ÄúDifference between Forward Proxy and Reverse Proxy‚Äù* :contentReference[oaicite:10]{index=10}  
- Gu√≠a de reverse proxy en ambientes modernos: :contentReference[oaicite:11]{index=11}  
- Concepto t√©cnico de terminaci√≥n TLS: :contentReference[oaicite:12]{index=12}

# Proxy en Entornos Modernos
`$= dv.current().file.tags.join(" ")`

- [Redes](/uncategorized/redes/)
- DevOps
- Microservicios
- API Gateway
- Edge Computing
- IoT

---

## Introducci√≥n

En las arquitecturas modernas ‚Äîbasadas en microservicios, entornos distribuidos y aplicaciones en la nube‚Äî el papel del **proxy** ha evolucionado m√°s all√° del simple reenv√≠o de tr√°fico.  
Ahora cumple funciones cr√≠ticas en la **observabilidad**, **seguridad**, **gesti√≥n de APIs**, y **orquestaci√≥n de tr√°fico**.

Los proxies modernos se integran en plataformas como Kubernetes, mallas de servicio (*Service Mesh*), redes edge, o infraestructuras IoT.

---

## Proxy en Arquitecturas de Microservicios

### Desaf√≠o en microservicios
Los microservicios comunican entre s√≠ de forma din√°mica, a menudo en contenedores ef√≠meros, lo que complica la visibilidad, el control de tr√°fico y la seguridad.

### Rol del Proxy
- Cada servicio suele estar acompa√±ado por un **proxy sidecar**, que act√∫a como intermediario en todas las comunicaciones entrantes y salientes.
- Estos proxies son **inteligentes**, capaces de aplicar pol√≠ticas de:
	- Retries y timeouts
	- Encriptaci√≥n de tr√°fico (mTLS)
	- Autenticaci√≥n y autorizaci√≥n
	- Rate limiting y circuit breaking
	- Observabilidad (m√©tricas, trazas, logs)

### Ejemplo: Service Mesh
Un **Service Mesh** (como Istio, Linkerd o Consul) integra proxies ligeros (como Envoy) en cada pod o instancia.

**Ventajas:**
- Seguridad de extremo a extremo (mTLS autom√°tico).
- Control de tr√°fico granular (canary releases, A/B testing).
- Reintentos y balanceo de carga a nivel de servicio.
- M√©tricas y trazabilidad unificadas sin modificar el c√≥digo.

**Ejemplo simplificado (Istio + Envoy):**
{% raw %}
```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: example-service
spec:
  hosts:
  - example.local
  http:
  - route:
    - destination:
        host: example-v1
      weight: 80
    - destination:
        host: example-v2
      weight: 20
```
{% endraw %}`

> Aqu√≠, el proxy Envoy decide din√°micamente qu√© versi√≥n del servicio recibe el tr√°fico (canary deployment).

---

## Proxy como API Gateway

### Definici√≥n

Un **API Gateway** es una forma especializada de *reverse proxy* que gestiona las solicitudes hacia microservicios o APIs distribuidas.

### Funciones principales

* **Autenticaci√≥n y autorizaci√≥n** (OAuth2, JWT, API keys)
* **Rate limiting y cuotas**
* **Transformaci√≥n de peticiones y respuestas**
* **Cach√© de respuestas frecuentes**
* **Anal√≠tica y logging**
* **Gesti√≥n de versiones de API**

### Ejemplos de API Gateways

* Kong
* Apigee
* Traefik
* NGINX Plus
* AWS API Gateway
* Zuul

### Ejemplo de configuraci√≥n (Kong Declarative)

{% raw %}
```yaml
_format_version: "3.0"
services:
  - name: user-service
    url: http://user-service:8080
    routes:
      - name: user-route
        paths:
          - /api/users
plugins:
  - name: rate-limiting
    config:
      minute: 100
      policy: local
```
{% endraw %}

---

## Proxy en Edge Computing

### Contexto

El **Edge Computing** acerca el procesamiento y distribuci√≥n de contenido al usuario final o al borde de la red, minimizando la latencia y optimizando recursos.

### Rol del Proxy en el Edge

* **Distribuci√≥n de contenido** (CDN, edge caching).
* **Compresi√≥n y optimizaci√≥n** en tiempo real.
* **Seguridad** (firewall, mitigaci√≥n DDoS, TLS offloading).
* **Reescritura din√°mica** de rutas y contenido seg√∫n localizaci√≥n del usuario.

### Tecnolog√≠as comunes

* Cloudflare Workers
* Fastly
* Akamai Edge Servers
* NGINX Edge
* Envoy Proxy (en despliegues edge ligeros)

**Ejemplo conceptual:**

{% raw %}
```nginx
server {
	listen 443 ssl;
	server_name edge-node.example.com;

	location /static/ {
		proxy_cache my_cache;
		proxy_pass https://origin-server;
		add_header X-Cache-Status $upstream_cache_status;
	}
}
```
{% endraw %}

---

## Proxy en IoT (Internet of Things)

### Problemas comunes

* Dispositivos limitados en recursos o conectividad.
* Necesidad de gestionar miles de conexiones simult√°neas.
* Asegurar el tr√°fico entre dispositivos y servidores.

### Funci√≥n del Proxy

* **Concentrador de tr√°fico (gateway)**: act√∫a como intermediario entre los dispositivos IoT y los servicios cloud.
* **Seguridad y filtrado**: autenticaci√≥n mutua, cifrado TLS, validaci√≥n de payloads.
* **Protocolos soportados**: MQTT, CoAP, HTTP.
* **Conversi√≥n de protocolos**: traduce entre protocolos ligeros (ej. CoAP) y HTTP para integrarse con servicios web.

### Ejemplo MQTT Proxy (Nginx + Stream)

{% raw %}
```nginx
stream {
	upstream mqtt_backend {
		server iot-core.local:1883;
	}
	server {
		listen 8883 ssl;
		proxy_pass mqtt_backend;
		ssl_certificate     /etc/ssl/certs/proxy.crt;
		ssl_certificate_key /etc/ssl/private/proxy.key;
	}
}
```
{% endraw %}

---

## Proxies Contempor√°neos Destacados

| Proxy       | Enfoque                       | Entorno            | Caracter√≠sticas principales                 |
| ----------- | ----------------------------- | ------------------ | ------------------------------------------- |
| **Envoy**   | Service Mesh / Edge           | Kubernetes, Cloud  | mTLS, observabilidad, alta configurabilidad |
| **Traefik** | API Gateway / Reverse Proxy   | Kubernetes, Docker | Auto-discovery, dashboard, middleware       |
| **Kong**    | API Gateway                   | Cloud-Native       | Plugins, autenticaci√≥n, rate limiting       |
| **HAProxy** | Reverse Proxy / Load Balancer | General            | Rendimiento alto, bajo nivel, flexible      |
| **NGINX**   | Generalista / Edge            | Web y CDN          | Ligero, extensible, alto rendimiento        |

---

## Seguridad en Proxies Modernos

* **mTLS** entre servicios (autenticaci√≥n mutua).
* **JWT / OAuth2** en gateways.
* **Rate limiting** y *circuit breaking*.
* **DDoS mitigation** en el edge.
* **Policy enforcement** centralizado mediante mallas de servicio.

---

## Observabilidad y M√©tricas

* **Tracing distribuido:** con [OpenTelemetry](/monitoreo/opentelemetry/) o Jaeger.
* **Logs estructurados:** JSON logs enviados a ELK Stack o Grafana Loki.
* **M√©tricas:** Prometheus + Grafana (latencia, tr√°fico, errores, tasa de aciertos).
* **Dashboards unificados**: permiten diagnosticar flujos entre servicios sin modificar c√≥digo.

---

## Tendencias Futuras

* **Proxies sin servidor (serverless)**: desplegados como funciones ligeras (ej. Cloudflare Workers).
* **Smart proxies con IA**: priorizaci√≥n de tr√°fico y predicci√≥n de fallos.
* **Integraci√≥n Zero-Trust**: proxies actuando como enforcement points de pol√≠ticas de identidad.
* **Automatizaci√≥n declarativa**: configuraci√≥n gestionada por pol√≠ticas YAML (GitOps).

---

## Recursos y Documentaci√≥n

* [Envoy Proxy Docs](https://www.envoyproxy.io/docs)
* [Istio Service Mesh](https://istio.io/latest/docs/)
* [Traefik Proxy](https://doc.traefik.io/traefik/)
* [Kong Gateway](https://docs.konghq.com/)
* [Cloudflare Edge Network](https://developers.cloudflare.com/)
* [NGINX IoT Proxy Example](https://www.nginx.com/blog/using-nginx-mqtt-load-balancing/)

---

# Algoritmos en Proxies y Balanceadores
`$= dv.current().file.tags.join(" ")`

- Proxy
- Balanceo de carga
- [Redes](/uncategorized/redes/)
- DevOps
- Microservicios

---

## Introducci√≥n

Los **algoritmos** empleados en proxies y balanceadores de carga determinan c√≥mo se distribuyen, enrutan o procesan las solicitudes entre los clientes y los servidores backend.  
Su correcta elecci√≥n afecta directamente el rendimiento, la disponibilidad, la latencia y la eficiencia del sistema.

Estos algoritmos se aplican principalmente en:
- Reverse Proxy y Load Balancer
- Service Mesh
- API Gateway
- Edge Computing

---

## Clasificaci√≥n General

1. **Algoritmos de distribuci√≥n de carga**  
	Definen c√≥mo se asignan las solicitudes entre m√∫ltiples servidores backend.
2. **Algoritmos de enrutamiento**  
	Deciden el destino l√≥gico o f√≠sico de una petici√≥n seg√∫n reglas, rutas o metadatos.
3. **Algoritmos de cach√©**  
	Determinan qu√© contenido se almacena, por cu√°nto tiempo y cu√°ndo se invalida.
4. **Algoritmos de control de tr√°fico**  
	Gestionan el flujo, la prioridad o la limitaci√≥n de peticiones (QoS, rate limiting).
5. **Algoritmos de resiliencia y tolerancia a fallos**  
	Se utilizan en *service mesh* o gateways para mantener disponibilidad.

---

## Algoritmos de Distribuci√≥n de Carga

### 1. Round Robin
Asigna solicitudes a los servidores en orden secuencial, volviendo al primero al llegar al final de la lista.

**Ventajas:**
- Simple y r√°pido.
- Eficiente con servidores homog√©neos.

**Desventajas:**
- No considera carga real ni latencia.

**Ejemplo (Nginx):**
{% raw %}
```nginx
upstream backend {
	server app1.example.com;
	server app2.example.com;
}
```
{% endraw %}`

---

### 2. Weighted Round Robin

Asigna pesos a cada servidor seg√∫n su capacidad. Un servidor con peso mayor recibe m√°s solicitudes.

**Ejemplo:**

{% raw %}
```nginx
upstream backend {
	server app1.example.com weight=3;
	server app2.example.com weight=1;
}
```
{% endraw %}

---

### 3. Least Connections

Env√≠a la solicitud al servidor con **menos conexiones activas**.

**Ideal para:**

* Servidores con cargas variables o sesiones largas.

**Ejemplo:**

{% raw %}
```nginx
upstream backend {
	least_conn;
	server app1.example.com;
	server app2.example.com;
}
```
{% endraw %}

---

### 4. Least Response Time

Dirige las peticiones al servidor que responde m√°s r√°pido en promedio (requiere monitoreo continuo).

**Ventajas:**

* Optimiza la latencia percibida.
* Se adapta din√°micamente a la carga real.

---

### 5. IP Hash

Usa la direcci√≥n IP del cliente para determinar el servidor asignado.

**Ventajas:**

* Mantiene *session persistence*.
* Ideal para sesiones que requieren afinidad de cliente-servidor.

**Ejemplo:**

{% raw %}
```nginx
upstream backend {
	ip_hash;
	server app1.example.com;
	server app2.example.com;
}
```
{% endraw %}

---

### 6. Consistent Hashing

Basado en un hash distribuido que mapea claves (por IP o sesi√≥n) a nodos del cl√∫ster.

**Ventajas:**

* Escalable y estable al a√±adir o eliminar servidores.
* Muy usado en CDN, Cache distribuida y Service Mesh.

**Ejemplo (HAProxy):**

{% raw %}
```haproxy
balance uri
```
{% endraw %}

**Usos comunes:**

* Cache distribuida (Memcached, Redis)
* Proxy inverso con sesiones persistentes
* Sistemas de streaming o IoT a gran escala

---

### 7. Random

Selecciona el backend aleatoriamente, a menudo ponderado por capacidad.

**Uso t√≠pico:**

* En sistemas de baja carga o como fallback.

---

## Algoritmos de Enrutamiento

### 1. Path-Based Routing

Elige el backend seg√∫n la ruta de la URL (`/api`, `/static`, `/admin`).

**Ejemplo:**

{% raw %}
```nginx
location /api/ {
	proxy_pass http://api_backend;
}
```
{% endraw %}

### 2. Header-Based Routing

Decide el destino en funci√≥n de cabeceras HTTP (por ejemplo, `User-Agent`, `Authorization`).

### 3. GeoIP Routing

Asigna el servidor m√°s cercano seg√∫n la ubicaci√≥n del cliente.

### 4. Weighted Routing / Canary Deployment

Divide el tr√°fico entre versiones de una aplicaci√≥n (A/B testing, canary releases).

**Ejemplo (Istio):**

{% raw %}
```yaml
route:
  - destination:
      host: app-v1
    weight: 90
  - destination:
      host: app-v2
    weight: 10
```
{% endraw %}

---

## Algoritmos de Cach√©

### 1. LRU (Least Recently Used)

Elimina el objeto menos usado recientemente.

**Usado en:** Squid, Nginx, Varnish, Redis.

### 2. LFU (Least Frequently Used)

Elimina el objeto con menos accesos en un per√≠odo.

### 3. FIFO (First In, First Out)

Descarta el contenido m√°s antiguo independientemente de su frecuencia.

### 4. Adaptive Replacement Cache (ARC)

Combina LRU y LFU din√°micamente seg√∫n patrones de acceso.

**Ventajas:**

* Se adapta al comportamiento real del tr√°fico.
* Mejora la eficiencia en entornos variables.

---

## Algoritmos de Control de Tr√°fico

### 1. Token Bucket

Permite procesar solicitudes mientras haya ‚Äútokens‚Äù disponibles; los tokens se regeneran con el tiempo.

**Usado para:** Rate limiting y protecci√≥n contra picos.

### 2. Leaky Bucket

Establece un ritmo constante de salida de solicitudes, evitando r√°fagas.

### 3. Circuit Breaker

Evita enviar peticiones a servicios que fallan repetidamente.

**Ejemplo (Istio):**

{% raw %}
```yaml
trafficPolicy:
  connectionPool:
    tcp:
      maxConnections: 100
  outlierDetection:
    consecutive5xxErrors: 5
    interval: 5s
    baseEjectionTime: 30s
```
{% endraw %}

### 4. Retry & Backoff

Vuelve a intentar solicitudes fallidas con pausas crecientes (exponencial o lineal).

---

## Algoritmos de Resiliencia y Escalabilidad

### Health Checking

Eval√∫a peri√≥dicamente el estado de los servidores para excluir nodos inactivos.

**M√©todos:**

* HTTP `200 OK`
* TCP handshake
* Custom script

### Auto-Scaling Feedback

Los proxies modernos ajustan su comportamiento seg√∫n m√©tricas (latencia, CPU, tr√°fico) y disparan escalado autom√°tico.

### Weighted Fair Queuing (WFQ)

Distribuye tr√°fico equitativamente entre flujos de distinta prioridad.

### Priority Scheduling

Asigna prioridad seg√∫n tipo de tr√°fico o cliente (p. ej., API interna vs externa).

---

## Algoritmos Combinados (H√≠bridos)

Los proxies avanzados y service meshes utilizan **estrategias h√≠bridas**, combinando varios algoritmos:

* **Least Response Time + Weighted Round Robin** ‚Üí balanceo adaptativo.
* **Consistent Hash + Circuit Breaker** ‚Üí sesiones persistentes tolerantes a fallos.
* **Token Bucket + Retry** ‚Üí control de picos con resiliencia.

---

## Implementaciones Notables

| Software        | Algoritmos principales                                      | Particularidades                                      |
| --------------- | ----------------------------------------------------------- | ----------------------------------------------------- |
| **NGINX**       | Round Robin, Least Conn, IP Hash, Weighted                  | Configurable y eficiente en entornos web              |
| **HAProxy**     | Round Robin, Consistent Hash, Random                        | Balanceo avanzado y health checks precisos            |
| **Envoy**       | Weighted Round Robin, Least Request, Retry, Circuit Breaker | Inteligente, con m√©tricas y observabilidad integradas |
| **Traefik** | Dynamic routing, Weighted, Sticky sessions                  | Integraci√≥n autom√°tica con Kubernetes y Docker        |
| **Squid**       | LRU, FIFO, Adaptive Cache Replacement                       | Foco en caching y proxy directo                       |

---

## M√©tricas de Evaluaci√≥n

* **Throughput** (solicitudes por segundo)
* **Latency promedio / p95 / p99**
* **Tasa de aciertos de cach√©**
* **Error rate**
* **Fairness index (equidad de distribuci√≥n)**
* **Tiempo medio de recuperaci√≥n (MTTR)**

---

## Recursos y Referencias

* [NGINX Load Balancing Algorithms](https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/)
* [HAProxy Load Balancing Guide](https://www.haproxy.com/blog/load-balancing-algorithms-in-haproxy/)
* [Envoy Proxy Traffic Management](https://www.envoyproxy.io/docs)
* [Squid Cache Replacement Policy](http://www.squid-cache.org/Doc/config/cache_replacement_policy/)
* [Istio Traffic Management](https://istio.io/latest/docs/concepts/traffic-management/)

# Temas Complementarios sobre Proxies  
`$= dv.current().file.tags.join(" ")`

- Proxy
- [Redes](/uncategorized/redes/)
- DevOps
- Arquitectura de software

---

## Patr√≥n de Dise√±o ‚ÄúProxy‚Äù  
Aunque lo hemos tratado sobre proxies de red, tambi√©n es √∫til conocer el patr√≥n de dise√±o de software Proxy Pattern, porque muchos de los conceptos de intermediaci√≥n/capa de abstracci√≥n se reflejan tambi√©n en infraestructura:

### Definici√≥n  
Un objeto proxy act√∫a como **sustituto** o **intermediario** de otro objeto (‚Äúsujeto real‚Äù), controlando acceso, a√±adiendo funcionalidad, retrasando operaciones costosas o gestionando objetos remotos. :contentReference[oaicite:1]{index=1}

### Tipos de proxy (en software)  
- Proxy Virtual: retrasa la instanciaci√≥n del objeto real hasta que sea necesario. :contentReference[oaicite:2]{index=2}  
- Proxy de Protecci√≥n (‚ÄúProtection Proxy‚Äù): controla acceso y permisos antes de invocar al objeto real. :contentReference[oaicite:3]{index=3}  
- Proxy Remoto (‚ÄúRemote Proxy‚Äù): representa un objeto que reside en otro espacio de direcciones (otro servidor, contenedor). :contentReference[oaicite:4]{index=4}  
- Proxy de Cach√© (‚ÄúCache Proxy‚Äù): almacena resultados de operaciones para reutilizaci√≥n. :contentReference[oaicite:5]{index=5}  
- Proxy Inteligente (‚ÄúSmart Proxy‚Äù): a√±ade funcionalidades adicionales (logging, contadores, sincronizaci√≥n). :contentReference[oaicite:6]{index=6}

### Aplicaci√≥n en Infraestructura  
Esta analog√≠a ayuda cuando dise√±as proxies de red: el proxy de red **tambi√©n** puede comportarse como un ‚Äúproxy de protecci√≥n‚Äù (filtrado, seguridad), ‚Äúproxy de cach√©‚Äù (almacenamiento de respuestas), etc.

---

## Modelos de Implementaci√≥n y Arquitectura Interna  
### Arquitecturas de alta disponibilidad  
- Cl√∫steres de proxies con sincronizaci√≥n de estado, compartir cach√©, replicaci√≥n de configuraci√≥n.  
- Failover autom√°tico: si un proxy ‚Äúnodo‚Äù se cae, otro lo sustituye inmediatamente.  
- Uso de datos de salud (‚Äúhealth probes‚Äù) y m√©tricas para determinar cu√°ndo un nodo debe retirarse.  

### Consideraciones de estado vs sin estado  
- Proxies sin estado (‚Äústateless‚Äù) son m√°s escalables: pueden reproducirse f√°cilmente y no requieren refrigerios de sesi√≥n.  
- Proxies con estado (‚Äústateful‚Äù, por ejemplo con *sticky sessions*) requieren replicaci√≥n de estado o persistencia compartida.  
- Buena arquitectura: mantener el proxy lo m√°s sin estado posible, delegar estado en backend o sesiones externas.

### Capa de control/configuraci√≥n  
- Proxies modernos tienen **paneles de control**, APIs de configuraci√≥n (via YAML, JSON, via declarativo).  
- Uso de GitOps para configurar proxies (infraestructura como c√≥digo, versionado).  
- Automatizaci√≥n de despliegue de proxies (containers, Kubernetes, etc).

---

## Operaciones, Monitoreo y Mantenimiento  
### Monitorizaci√≥n  
- M√©tricas clave: conexiones activas, latencia de petici√≥n/respuesta, tasa de errores, aciertos de cach√©, uso de CPU/memoria.  
- Trazabilidad (‚Äúdistributed tracing‚Äù): ver recorrido de la petici√≥n a trav√©s del proxy al backend al cliente.  
- Logs estructurados: contiene detalles de la petici√≥n, IPs originales, cabeceras modificadas, destino, tiempos.  

### Mantenimiento  
- Actualizaciones: al tratarse de un componente cr√≠tico, requiere buen proceso de despliegue, rollback, pruebas A/B.  
- Seguridad: aplicar parches, zonas de DMZ si el proxy est√° expuesto, certificados SSL/TLS renovados, control de acceso administrativo.  
- Backup de configuraci√≥n: versionar y respaldar la configuraci√≥n del proxy.  

### Escalabilidad operativa  
- Cache warming: precargar cach√© despu√©s de reinicio o despliegue para evitar ‚Äúcache cold start‚Äù.  
- Rate-limiting din√°mico: ajustar l√≠mites en tiempo real seg√∫n la carga o an√°lisis de comportamiento.

---

## Legal, √âtica y Privacidad  
- Un proxy puede implicar recolecci√≥n de datos de tr√°fico, logs de usuarios, filtrado de contenido: es necesario cumplir con regulaciones como GDPR en Europa.  
- Transparencia: especialmente en organizaciones que monitorean tr√°fico de usuarios internos, debe haber pol√≠ticas claras.  
- Uso √©tico: proxies an√≥nimos pueden usarse para actividades maliciosas (fraude, scraping sin autorizaci√≥n). :contentReference[oaicite:8]{index=8}

---

## Tendencias Tecnol√≥gicas Emergentes  
- Integraci√≥n de **IA/ML** para detecci√≥n de anomal√≠as en el tr√°fico proxy (bots, DDoS, tr√°fico inusual). :contentReference[oaicite:9]{index=9}  
- Proxies adaptativos: que modifican sus reglas/configuraci√≥n en funci√≥n de la telemetr√≠a en tiempo real.  
- Proxies orientados a **5G**, borde m√≥vil, conectividad ultra baja latencia. :contentReference[oaicite:10]{index=10}  
- Uso de proxies en entornos de **computaci√≥n cu√°ntica o cifrado post-cu√°ntico** (a√∫n emergente) para preparar futuros escenarios.

---

## Glosario Adicional  
- **Failover**: mecanismo autom√°tico para cambiar al nodo de respaldo en caso de fallo del nodo activo.  
- **Cache warming**: precargar el cach√© antes de poner en producci√≥n un proxy o una versi√≥n nueva.  
- **DMZ (Zona Desmilitarizada)**: segmento de red en que se ubican proxies p√∫blicos expuestos para aislar de la red interna.  
- **Telemetr√≠a**: datos de comportamiento que env√≠a el proxy para an√°lisis de rendimiento o seguridad.  
- **Infraestructura como c√≥digo (IaC)**: gesti√≥n declarativa de la configuraci√≥n de proxies mediante ficheros versionados (e.g., Terraform, Ansible).  

---

## Recursos Sugeridos  
- [‚ÄúProxy Servers: How Proxies Work, Common Types, Uses & More‚Äù](https://www.splunk.com/en_us/blog/learn/proxy-servers.html) ‚Äì Splunk. :contentReference[oaicite:11]{index=11}  
- [‚ÄúProxy in System Design‚Äù](https://www.geeksforgeeks.org/system-design/network-protocols-and-proxies-in-system-design/) ‚Äì GeeksforGeeks. :contentReference[oaicite:12]{index=12}  
- [Proxy Pattern ‚Äì software design](https://sourcemaking.com/design_patterns/proxy) ‚Äì SourceMaking. :contentReference[oaicite:13]{index=13}  

---

