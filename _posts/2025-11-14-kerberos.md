---
date: 2025-11-14 17:41
title: Kerberos
tags:
keywords:
source:
status: 
Parent: "[[Area-Sistemas]]"
cssclasses:
public_note: "true"
category: autenticacion
categories:
  - autenticacion
  - kerberos
  - hide-embedded-header1
---
# Kerberos
`$= dv.current().file.tags.join(" ")`

- [SSO Single Sign-On](/autenticacion/sso-single-sign-on/)
- [ticketing](/management/ticketing/)
- [Active Directory](/sistemas/active-directory/)
- [ticketing](/management/ticketing/)
- [Protocolos](/redes/protocolos/)
## Conceptos Fundamentales
- Basado en **criptograf铆a sim茅trica** y emisi贸n de **tickets**.
- Dise帽ado originalmente por el MIT.
- Implementaci贸n predominante: **Kerberos v5**.
- Es un mecanismo esencial en entornos corporativos Windows mediante **Active Directory (AD)**.
- Permite autenticaci贸n s贸lida y **SSO** dentro de redes internas confiables.

## Componentes Principales
### KDC (Key Distribution Center)
El coraz贸n del sistema. Consta de dos servicios:
- **AS (Authentication Server)**: autentica al usuario y entrega el *Ticket-Granting Ticket (TGT)*.
- **TGS (Ticket Granting Server)**: emite tickets de servicio basados en el TGT.

### Principal
- Identidad 煤nica dentro del sistema Kerberos.
- Puede ser un usuario, servicio o equipo.
- Formato t铆pico: `usuario@REALM` o `servicio/host@REALM`.

### Realm
- Dominio l贸gico de administraci贸n para Kerberos.
- Suele escribirse en may煤sculas: `EMPRESA.LOCAL`.

### Tickets
- **TGT (Ticket-Granting Ticket)**: permite solicitar otros tickets sin reautenticar.
- **ST (Service Ticket)**: permite acceder a un servicio espec铆fico.
- Ambos est谩n cifrados y tienen expiraci贸n definida.

## Flujo de Autenticaci贸n Kerberos
### Proceso General
1. El usuario se autentica ante el **AS** con su secreto (contrase帽a o clave derivada).
2. El AS entrega un **TGT** cifrado.
3. El usuario solicita al **TGS** un ticket de servicio usando el TGT.
4. El TGS emite un **Service Ticket** para el servicio solicitado.
5. El usuario presenta el Service Ticket al servicio objetivo.
6. El servicio valida el ticket y concede acceso sin pedir contrase帽a nuevamente.

## Integraci贸n con SSO
- Kerberos facilita SSO en redes Windows mediante **Active Directory**.
- Los usuarios autenticados en un dominio no deben volver a introducir credenciales al acceder a servicios integrados.
- Utiliza **validaci贸n mutua** para evitar ataques de impersonaci贸n.

## Ventajas
- **Muy seguro**: basado en claves sim茅tricas y tickets temporales.
- **Prevenci贸n contra replay**: incluye timestamps y nonce.
- **SSO nativo** en redes corporativas.
- **Mutual authentication** entre cliente y servicio.

## Desventajas
- Requiere reloj sincronizado (tolerancia t铆pica: 卤5 minutos).
- Dependencia cr铆tica del KDC (punto 煤nico de fallo si no hay redundancia).
- Complejo en entornos heterog茅neos fuera de AD.
- Dif铆cil de integrar con aplicaciones modernas externas a la red interna.

## Kerberos en Active Directory
### Caracter铆sticas
- AD act煤a como **KDC**.
- Utiliza SPNs (Service Principal Names) para identificar servicios.
- Los controladores de dominio gestionan claves, pol铆ticas y tickets.

### SPN (Service Principal Name)
- Mapea servicios a cuentas.
- Ejemplo: `HTTP/webserver.empresa.local@EMPRESA.LOCAL`.

## Casos de Uso
### Redes Corporativas
- Autenticaci贸n para:
	- Windows login.
	- SMB y CIFS.
	- Servicios corporativos internos.
	- Aplicaciones web integradas mediante **Kerberos Delegation**.

### Delegaci贸n Kerberos
- **Constrained Delegation**: el servicio solo puede actuar en nombre del usuario hacia servicios espec铆ficos.
- **Protocol Transition (S4U)**: permite crear tickets sin credenciales expl铆citas del usuario.

## Ataques Comunes Relacionados
### Kerberoasting
- Ataque donde se solicitan Service Tickets y se crackean offline.
- Mitigaci贸n: contrase帽as robustas para cuentas de servicio; usar Managed Service Accounts.

### Pass-the-Ticket
- Reutilizaci贸n de tickets capturados.
- Mitigaci贸n: cifrado fuerte, rotaci贸n, controles de endpoint.

### Golden Ticket
- Ataque donde se genera un TGT falso si el atacante roba la clave `krbtgt`.
- Mitigaci贸n: rotar peri贸dicamente la contrase帽a de `krbtgt`.

## Comparaci贸n con Otros Protocolos
### Kerberos vs SAML
- Kerberos: entorno interno, tickets sim茅tricos.
- SAML: federaci贸n externa, XML, firmado asim茅trico.

### Kerberos vs OIDC/OAuth2
- Kerberos no se basa en tokens JWT ni JSON.
- OIDC se orienta a aplicaciones modernas y servicios externos.
- Kerberos se usa principalmente en AD e intranets.

## Ejemplo de Configuraci贸n B谩sica (Linux krb5.conf)
### C贸digo
```ini
[libdefaults]
	default_realm = EMPRESA.LOCAL

[realms]
	EMPRESA.LOCAL = {
		kdc = kdc1.empresa.local
		admin_server = kdc1.empresa.local
	}

[domain_realm]
	.empresa.local = EMPRESA.LOCAL
	empresa.local = EMPRESA.LOCAL
