creation date: 2025-04-14 18:26
tags:
  - oauth
  - autentication
  - Hacking
  - ciberseguridad
  - openid
keywords:
source:
status: üåü
Parent: "Area-Sistemas"
cssclasses:
  - hide-embedded-header1
  - wide
categories: "[autenticacion](/autenticacion/autenticacion/)"
public_note: "true"
# OAuth

- [autenticacion](/autenticacion/autenticacion/)
- [ciberseguridad](/ciberseguridad/ciberseguridad/)

## Conceptos Clave
- tipo de [SSO Single Sign-On](/autenticacion/sso-single-sign-on/)
- **autorizacion** (no autenticaci√≥n)
- est√°ndar basado en [JSON](/databases/json/)
- acceso delegado mediante *tokens*
- flujo seguro sin compartir credenciales (UN, PW ‚Äì redes sociales)
- usado en [api](/backend/api/) modernas, apps m√≥viles, SPAs y servicios distribuidos

## Componentes Principales
- **Resource Owner (RO)**  
	- Usuario que concede acceso a un recurso protegido.
- **Client (Aplicaci√≥n Cliente)**  
	- App que solicita acceso delegado a recursos del usuario.
- **Authorization Server (AS)**  
	- Emite tokens y gestiona permisos y consentimientos.
- **Resource Server (RS)**  
	- Servicio que protege los datos y valida tokens.
- **Tokens**
	- **Access Token**: acceso a recursos protegidos.
	- **Refresh Token**: permite renovar el access token sin reautenticar.

## Flujos (Grant Types)
- **Authorization Code**  
	- El m√°s seguro. Ideal para apps web con backend.
- **PKCE (Proof Key for Code Exchange)**  
	- Variante moderna segura para SPAs y apps m√≥viles.
- **Client Credentials**  
	- Comunicaci√≥n servicio-a-servicio sin usuario.
- **Device Code**  
	- Autenticaci√≥n en dispositivos limitados (TVs, IoT).
- **Implicit (obsoleto)**  
	- Ya no recomendado por vulnerabilidades.

## Riesgos y Buenas Pr√°cticas
- evitar tokens largos en URL  
- usar HTTPS siempre  
- validar el `redirect_uri`  
- usar PKCE cuando sea posible  
- establecer expiraciones cortas  
- rotaci√≥n de tokens  
- evitar scopes excesivamente amplios

## Enlaces y Recursos
- [¬øQu√© es OAuth 2.0? - Auth0](https://auth0.com/es/intro-to-iam/what-is-oauth-2)
- [¬øQu√© es OAuth? | Proofpoint](https://www.proofpoint.com/es/threat-reference/oauth)
- [OAuth 2.0 para apps servidor | Google](https://developers.google.com/identity/protocols/oauth2/web-server?hl=es-419)
- [OAuth - Wikipedia](https://es.wikipedia.org/wiki/OAuth)
- [OAuth, OIDC y JWT para dummies ‚Äì YouTube](https://youtu.be/I6ZYVsUuPU8)

## OpenID Connect (OIDC)
- protocolos
- [OAuth](/uncategorized/oauth/)
- auntenticacion
- capa superior de OAuth enfocada en autenticaci√≥n
- OAuth = autorizaci√≥n  
  OIDC = autenticaci√≥n
- a√±ade **ID Token** (JWT) que identifica al usuario
- **Relying Party (RP)**: aplicaci√≥n que conf√≠a en el Identity Provider
- interoperable, RESTful y ampliamente usado
- fundamental en SSO moderno
- √∫til para apps web, m√≥viles y APIs distribuidas

### Recursos OIDC
- [OpenID Connect - Wikipedia](https://es.wikipedia.org/wiki/OpenID_Connect)
- [OIDC en Microsoft Identity Platform](https://learn.microsoft.com/es-es/entra/identity-platform/v2-protocols-oidc)
- [OpenID ‚Äì P√≠ldoras de Conocimiento](https://youtu.be/fJTwvJuQcHA)

## Tabla Comparativa SSO vs OAuth

| SSO | OAuth | |
| --- | --- | --- |
| SSO | OAuth | |
| C√≥mo funciona | El usuario se autentica una vez con un IdP | El usuario autoriza a una app a acceder a sus datos en otra app |
| Cu√°ndo usar | Para simplificar el proceso de inicio de sesi√≥n | Para otorgar acceso delegado a datos |
| Ejemplos | Salesforce (una sola sesi√≥n) | Apps que publican en redes sociales en nombre del usuario |

# OAuth ‚Äî Conceptos Avanzados y Profundizaci√≥n

## Arquitectura y Modelo de Confianza
- **OAuth como Framework**  
	- No define un √∫nico m√©todo; proporciona un conjunto adaptable de mecanismos.
- **Modelo de Confianza entre Roles**
	- Cliente conf√≠a en el Authorization Server para gestionar permisos del usuario.
	- Resource Server conf√≠a en el AS para validar tokens.
	- Ning√∫n actor necesita las credenciales del otro ‚Üí principio "Zero Knowledge".
- **Desacoplamiento**  
	- El AS y el RS pueden ser servicios distintos ‚Üí microservicios, escalabilidad, delegaci√≥n.

## Scopes en Profundidad
- **Scopes granulares**
	- Permiten dise√±ar permisos finos: lectura, escritura, operaciones espec√≠ficas.
- **Scopes compuestos o jer√°rquicos**
	- Muchos proveedores implementan scopes internos anidados.
- **Scope Inflation Risk**
	- El cliente pide m√°s permisos de los necesarios.  
	- Contramedida: *consent guided by minimal access*.
- **Scopes din√°micos**
	- Algunos proveedores permiten construir scopes en tiempo de ejecuci√≥n.

## Tokens: Detalles T√©cnicos Avanzados
- **Formato del Access Token**
	- Opaque vs JWT
	- Opaque es m√°s seguro para evitar exfiltraci√≥n de datos.
- **Token Introspection**
	- Proceso para validar tokens no-JWT mediante un endpoint seguro.
- **Token Binding**
	- Vincula el token al dispositivo/cliente para evitar replay attacks.
- **JWT Claims Avanzados**
	- `aud`: define qui√©n debe aceptar el token.  
	- `jti`: identifica un token de forma √∫nica ‚Üí revocaci√≥n.  
	- `nonce`: mitigaci√≥n de ataques de reproducci√≥n en flujos h√≠bridos.

## Seguridad Avanzada en OAuth
- **Ataques Comunes**
	- *Authorization Code Interception*
	- *Token Leakage*
	- *Redirect Manipulation*
	- *Confused Deputy Problem*
- **Medidas Avanzadas**
	- PKCE obligatorio incluso para apps con backend.
	- *State parameter* para evitar CSRF.
	- *Nonce* en OIDC para mitigar reproducci√≥n.
	- Validaci√≥n del *issuer* y *audience* del token.
	- Caducidad ultracorta para Access Tokens; refresh rotativos.

## Patrones de Implementaci√≥n
- **Backend for Frontend (BFF) + OAuth**
	- Patrones seguros para SPAs evitando exponer tokens en el navegador.
- **Token Exchange (RFC 8693)**
	- Permite intercambiar un tipo de token por otro  
	- Usado en arquitecturas complejas con microservicios.
- **OAuth para M2M**
	- Uso de Client Credentials + scopes m√≠nimos + rotaci√≥n frecuente.

## OAuth en Entornos Empresariales
- **Gobernanza y Cumplimiento**
	- Control de consentimientos del usuario  
	- Auditor√≠a de emisiones e invalidaciones de tokens  
	- Segmentaci√≥n por entorno (DEV, QA, PROD)
- **Integraci√≥n con IAM corporativo**
	- Compatibilidad con LDAP, Active Directory, proveedores de identidad federada.
- **Multi-Tenant OAuth**
	- Distinci√≥n entre ‚Äútenant-aware‚Äù y ‚Äútenant-isolated‚Äù tokens.
	- Aislamiento organizacional mediante claims espec√≠ficos.

## Extensiones Relevantes del Est√°ndar (sin repetir OIDC)
- **OAuth 2.1 (draft)**
	- Eliminaci√≥n del flujo Implicit  
	- PKCE como obligatorio  
	- Endpoints simplificados  
- **OAuth 2.0 Device Authorization Grant (RFC 8628)**
	- Autenticaci√≥n en dispositivos con UI limitada.
- **JAR / JARM**
	- *JWT Secured Authorization Request*  
	- *JWT Secured Authorization Response*  
	- Proporcionan integridad y no repudio en solicitudes/respuestas.
- **PAR ‚Äî Pushed Authorization Requests**
	- El cliente env√≠a la solicitud de autorizaci√≥n directamente al AS, evitando manipulaci√≥n en el navegador.

## Dise√±o Seguro de APIs con OAuth
- **API Gateway + OAuth**
	- Centraliza autenticaci√≥n, validaci√≥n de tokens y throttling.
- **Resource Indicators**
	- Permiten solicitar tokens espec√≠ficos para distintos recursos/servicios.
- **Pol√≠ticas de Autorizaci√≥n Basadas en Claims**
	- Decisiones din√°micas seg√∫n atributos del token (rol, grupo, device_id).
- **Service Mesh + OAuth**
	- Token exchange interno + mTLS + autorizaci√≥n granular per-servicio.

## OAuth en Microservicios y Arquitecturas Zero Trust
- **Zero Trust**
	- Autorizaci√≥n continua mediante tokens de vida corta.  
	- Validaci√≥n estricta por servicio, no confiar en la red interna.
- **Workload Identity**
	- Servicios que act√∫an como clientes: tokens emitidos para workloads, no usuarios.
- **Separaci√≥n de dominios**
	- Cada microservicio puede requerir un scope distinto ‚Üí control de privilegios.

## Testing y Validaci√≥n
- **Pruebas Autom√°ticas**
	- Validaci√≥n de flujos OAuth en pipelines CI/CD.  
	- Mock de Authorization Server para pruebas unitarias.
- **Herramientas**
	- OAuth2 Proxy  
	- Curity OAuth Tools  
	- MITREid Test tools

