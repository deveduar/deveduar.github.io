---
date: 2025-05-19 22:28
title: MAUI NET
tags:
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
cssclasses:
public_note: "true"
category: NET
categories:
  - NET
  - maui
  - CSharp
  - android
  - hide-embedded-header1
  - wide
  - Desarrollo multiplataforma
---
# .NET MAUI  
``$= dv.current().file.tags.join(" ")``

[xamarin](/desarrollo%20multiplataforma/xamarin/) ¬∑ [net](/software%20engineering/net/) ¬∑ [csharp](/software%20engineering/csharp/) - blazor ¬∑ android ¬∑ [Backend](/uncategorized/backend/) - [csharp](/software%20engineering/csharp/) - [Desarrollo multiplataforma](/uncategorized/desarrollo-multiplataforma/)

## Introducci√≥n a .NET MAUI

**.NET MAUI (Multi-platform App UI)** es el framework moderno de .NET para desarrollar aplicaciones **nativas multiplataforma** (Android, iOS, macOS y Windows) usando una **base de c√≥digo unificada** en CSharp.

Surgi√≥ como evoluci√≥n de Xamarin.Forms, con un enfoque m√°s moderno, mayor rendimiento, soporte completo para MVVM y XAML, y una arquitectura m√°s modular y extensible.  

MAUI permite que los desarrolladores compartan la l√≥gica del negocio, servicios y modelos de datos entre plataformas, manteniendo la capacidad de crear interfaces nativas mediante XAML o C#.

---

## Caracter√≠sticas clave

- **Un solo proyecto**: gesti√≥n unificada de recursos, dependencias y configuraci√≥n multiplataforma.  
- **Compatibilidad total con XAML** para la definici√≥n de interfaces declarativas.  
- **MVVM integrado** para separar l√≥gica de presentaci√≥n y vista.  
- **Hot Reload** (XAML y C#): mejora dr√°sticamente la productividad.  
- **Integraci√≥n con [Backend](/uncategorized/backend/)s y APIs REST** mediante CSharp.  
- **Desarrollo multiplataforma real**: compila nativamente para Android, iOS, macOS y Windows.  
- **Interoperabilidad nativa**: acceso directo a API de sistema y librer√≠as espec√≠ficas de cada plataforma.

---

## Arquitectura general

- **UI Layer (View)**: Interfaces en **XAML** o **C#**, dependientes de plataforma o compartidas.
- **ViewModel Layer (MVVM)**: Gesti√≥n del estado, comandos, validaciones y enlace de datos.
- **Model Layer**: L√≥gica de negocio, entidades y acceso a datos.
- **Services Layer**: Integraci√≥n con [Backend](/uncategorized/backend/), APIs o almacenamiento local (SQLite, Preferences, etc.).

Este dise√±o modular favorece la escalabilidad, testabilidad y mantenimiento del c√≥digo.

---

## Interfaces y XAML

XAML (eXtensible Application Markup Language) define la **estructura visual y comportamientos de UI** en MAUI.  
Permite la vinculaci√≥n directa con propiedades y comandos del ViewModel (Data Binding).  

Ejemplo b√°sico de una interfaz en MAUI:

### Ejemplo: XAML b√°sico

{% raw %}
```xml
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
			 x:Class="MyApp.MainPage">

	<VerticalStackLayout Padding="30">
		<Label Text="Hola .NET MAUI"
			   FontSize="24"
			   HorizontalOptions="Center" />
		<Button Text="Pulsa aqu√≠"
				Command="{Binding OnClickCommand}" />
	</VerticalStackLayout>
</ContentPage>
```
{% endraw %}`

---

## Patr√≥n MVVM en .NET MAUI

El patr√≥n **MVVM (Model-View-ViewModel)** es la base para separar la l√≥gica de UI de la l√≥gica de negocio.
Facilita el **enlace de datos**, el **testing unitario** y la **reactividad** en la aplicaci√≥n.

### Ejemplo: ViewModel en C#

{% raw %}
```csharp
public class MainViewModel : INotifyPropertyChanged
{
	public ICommand OnClickCommand { get; }

	private string _message;
	public string Message
	{
		get => _message;
		set { _message = value; OnPropertyChanged(); }
	}

	public MainViewModel()
	{
		OnClickCommand = new Command(() => Message = "¬°Bot√≥n pulsado!");
	}

	public event PropertyChangedEventHandler PropertyChanged;
	protected void OnPropertyChanged([CallerMemberName] string name = null)
	{
		PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(name));
	}
}
```
{% endraw %}

El enlace con la vista se realiza autom√°ticamente mediante **data binding** y el sistema de notificaci√≥n de cambios (`INotifyPropertyChanged`).

---

## Migraci√≥n desde Xamarin.Forms

MAUI es el reemplazo natural de Xamarin.Forms:

* Se mantienen los principios de XAML y MVVM.
* Cambios m√≠nimos en l√≥gica, pero mejora en el **sistema de proyecto unificado**.
* Nuevas APIs para manejar dependencias, recursos y estilos compartidos.
* Migraciones asistidas disponibles desde Visual Studio y herramientas CLI.

---

## Integraci√≥n con [Backend](/uncategorized/backend/) y l√≥gica compartida

La l√≥gica de negocio puede integrarse con:
- APIs REST o gRPC.
- Entity Framework Core o Prisma (si se usa con servicios externos).
- Autenticaci√≥n JWT, OAuth o Auth0.
- Almacenamiento local mediante `Preferences`, `SecureStorage` o SQLite.

Esto convierte a MAUI en un **cliente nativo potente** dentro de un ecosistema de arquitectura moderna (p. ej. con Clean Architecture o CQRS).

## Ecosistema de UI relacionadas

### WPF
Framework de UI basado en XAML para aplicaciones **de escritorio Windows**.
MAUI hereda parte de sus conceptos, especialmente en **data binding** y estilos.

### WinUI
Evoluci√≥n moderna de la UI de Windows, base de **Windows App SDK**.
MAUI usa WinUI como capa nativa cuando se ejecuta en Windows.

## Recursos y documentaci√≥n

- [GitHub - dotnet/maui](https://github.com/dotnet/maui)  
- [Documentaci√≥n oficial de .NET MAUI](https://learn.microsoft.com/es-es/dotnet/maui/?view=net-maui-8.0&WT.mc_id=dotnet-35129-website)  
- [¬øQu√© es .NET MAUI?](https://learn.microsoft.com/es-es/dotnet/maui/what-is-maui?view=net-maui-8.0)  
- [Patr√≥n MVVM: fundamentos](https://keepcoding.io/blog/que-es-el-patron-de-arquitectura-mvvm/)  
- [MVVM en .NET MAUI | Microsoft Learn](https://learn.microsoft.com/es-es/dotnet/architecture/maui/mvvm)  
- [Patr√≥n MVVM reactivo (video)](https://youtu.be/0aJRmdXk8Go)  
- [WPF Overview](https://learn.microsoft.com/es-es/dotnet/desktop/wpf/overview/?view=netdesktop-8.0)  
- [WinUI - Windows apps](https://learn.microsoft.com/es-es/windows/apps/winui/)


## Pr√≥ximos temas sugeridos

- Integraci√≥n con Blazor Hybrid  
- Optimizaci√≥n de rendimiento en UI  
- Despliegue multiplataforma (App Store / Play Store / Windows Store)  
- Testing UI con MAUI Test Tools  
- Estilos y temas globales con ResourceDictionary  
- Integraci√≥n CI/CD con GitHub Actions y Azure DevOps  

# .NET MAUI ‚Äì Avanzado y ciclo de vida  

[net](/software%20engineering/net/) ¬∑ [csharp](/software%20engineering/csharp/) ¬∑ [xamarin](/desarrollo%20multiplataforma/xamarin/) ¬∑ android ¬∑ [Backend](/uncategorized/backend/)

---

## Ciclo de vida de una app .NET MAUI

MAUI abstrae los distintos ciclos de vida (Android, iOS, Windows, macOS) mediante la clase `Application` y los m√©todos globales de eventos:

	- `OnStart()`: al iniciar la app.  
	- `OnSleep()`: cuando entra en segundo plano.  
	- `OnResume()`: al volver a primer plano.  

Tambi√©n se pueden usar los **eventos del `MauiAppBuilder`** para configurar servicios o suscripciones globales antes del arranque.

### Ejemplo: ciclo de vida en App.xaml.cs

{% raw %}
```csharp
public partial class App : Application
{
	protected override void OnStart()
	{
		Console.WriteLine("App iniciada");
	}

	protected override void OnSleep()
	{
		Console.WriteLine("App suspendida");
	}

	protected override void OnResume()
	{
		Console.WriteLine("App reanudada");
	}
}
```
{% endraw %}`

---

## Inyecci√≥n de dependencias (DI)

.NET MAUI usa el **sistema de DI nativo de .NET**, facilitando la modularidad y testabilidad.
Los servicios se registran en `MauiProgram.cs`.

### Ejemplo: configuraci√≥n de DI

{% raw %}
```csharp
public static class MauiProgram
{
	public static MauiApp CreateMauiApp()
	{
		var builder = MauiApp.CreateBuilder();

		builder.Services.AddSingleton<ApiService>();
		builder.Services.AddTransient<MainViewModel>();
		builder.Services.AddTransient<MainPage>();

		return builder.Build();
	}
}
```
{% endraw %}

Esto permite **inyectar dependencias** autom√°ticamente en constructores de vistas o viewmodels.

---

## Integraci√≥n con APIs nativas y permisos

MAUI proporciona acceso unificado a **funcionalidades del dispositivo** mediante `Microsoft.Maui.Essentials`:


- Sensores: GPS, aceler√≥metro, br√∫jula.  
- Sistema: bater√≠a, conectividad, almacenamiento.  
- Multimedia: c√°mara, micr√≥fono, galer√≠a.  
- Seguridad: autenticaci√≥n biom√©trica y permisos.  


### Ejemplo: uso de GPS

{% raw %}
```csharp
var location = await Geolocation.GetLastKnownLocationAsync();
if (location != null)
	Console.WriteLine($"Lat: {location.Latitude}, Lon: {location.Longitude}");
```
{% endraw %}

Los permisos deben gestionarse en `AndroidManifest.xml` o `Info.plist`, seg√∫n plataforma.

---

## Persistencia local

Opciones comunes para almacenar datos en MAUI:


- **Preferences**: pares clave-valor simples.  
- **SecureStorage**: datos cifrados (tokens, credenciales).  
- **SQLite**: base de datos local estructurada.


### Ejemplo: SQLite b√°sico

{% raw %}
```csharp
public class Note
{
	[PrimaryKey, AutoIncrement]
	public int Id { get; set; }
	public string Text { get; set; }
}

public class NoteDatabase
{
	private readonly SQLiteAsyncConnection _database;

	public NoteDatabase(string dbPath)
	{
		_database = new SQLiteAsyncConnection(dbPath);
		_database.CreateTableAsync<Note>().Wait();
	}

	public Task<List<Note>> GetNotesAsync() => _database.Table<Note>().ToListAsync();
	public Task<int> SaveNoteAsync(Note note) => _database.InsertOrReplaceAsync(note);
}
```
{% endraw %}

---

## Optimizaci√≥n de rendimiento

- **Usar im√°genes escaladas** por plataforma para evitar sobrecarga de GPU.  
- **Evitar layouts anidados**: preferir `Grid` sobre `StackLayout`.  
- **Compilar XAML (XAML Compilation)** para reducir tiempo de carga.  
- **Lazy loading** de recursos y vistas pesadas.  
- **Profiling** con herramientas de Visual Studio o `dotnet-trace`.


---

## Testing y CI/CD

MAUI soporta **tests unitarios y UI tests**:

- Unit tests: l√≥gica MVVM (usando xUnit o NUnit).
- UI tests: con Appium o MAUI Test Tools.
- CI/CD: integraciones con GitHub Actions, Azure DevOps o App Center.


### Ejemplo: test de ViewModel

{% raw %}
```csharp
[Fact]
public void ClickCommand_ShouldChangeMessage()
{
	var vm = new MainViewModel();
	vm.OnClickCommand.Execute(null);
	Assert.Equal("¬°Bot√≥n pulsado!", vm.Message);
}
```
{% endraw %}

---

## Despliegue y publicaci√≥n

- **Android**: firma y exportaci√≥n `.aab` o `.apk`.  
- **iOS**: requiere cuenta de Apple Developer.  
- **Windows/macOS**: empaquetado MSIX o `.pkg`.  
- **Distribuci√≥n**: AppCenter, Play Store, TestFlight, sideloading.

Recomendable usar **pipelines automatizados** para versionado y despliegue continuo.

---

## Ejemplo completo: App de Notas con API REST + SQLite + MVVM

### Estructura del proyecto


- **Models/** ‚Üí `Note.cs`  
- **ViewModels/** ‚Üí `NotesViewModel.cs`  
- **Views/** ‚Üí `NotesPage.xaml`  
- **Services/** ‚Üí `ApiService.cs`, `NoteDatabase.cs`


### Flujo

1. Al abrir la app, se cargan notas locales desde SQLite.
2. El usuario puede sincronizar con una API REST remota.
3. La UI reacciona mediante bindings MVVM.
4. Los servicios se inyectan mediante DI.

### Ejemplo: `ApiService.cs`

{% raw %}
```csharp
public class ApiService
{
	private readonly HttpClient _client = new();

	public async Task<List<Note>> GetNotesAsync()
	{
		var response = await _client.GetAsync("https://api.example.com/notes");
		response.EnsureSuccessStatusCode();
		var json = await response.Content.ReadAsStringAsync();
		return JsonSerializer.Deserialize<List<Note>>(json);
	}
}
```
{% endraw %}

### Ejemplo: integraci√≥n en ViewModel

{% raw %}
```csharp
public class NotesViewModel : INotifyPropertyChanged
{
	private readonly ApiService _api;
	private readonly NoteDatabase _db;
	public ObservableCollection<Note> Notes { get; set; } = new();

	public ICommand SyncCommand { get; }

	public NotesViewModel(ApiService api, NoteDatabase db)
	{
		_api = api;
		_db = db;
		SyncCommand = new Command(async () => await SyncNotes());
	}

	private async Task SyncNotes()
	{
		var apiNotes = await _api.GetNotesAsync();
		foreach (var note in apiNotes)
			await _db.SaveNoteAsync(note);

		Notes.Clear();
		var local = await _db.GetNotesAsync();
		foreach (var note in local)
			Notes.Add(note);
	}
}
```
{% endraw %}

---

## Conclusi√≥n

Con estos m√≥dulos, .NET MAUI permite desarrollar **aplicaciones multiplataforma robustas y modernas**, integrando:
- Arquitectura MVVM.
- Persistencia local.
- Integraci√≥n con [Backend](/uncategorized/backend/) y APIs nativas.
- Flujo CI/CD completo.

Es una herramienta madura y central en el ecosistema .NET moderno para desarrollo m√≥vil y de escritorio.

---

## Recursos adicionales

- [MAUI Essentials](https://learn.microsoft.com/es-es/dotnet/maui/platform-integration/?view=net-maui-8.0)  
- [SecureStorage y SQLite](https://learn.microsoft.com/es-es/dotnet/maui/data-cloud/?view=net-maui-8.0)  
- [App lifecycle en MAUI](https://learn.microsoft.com/es-es/dotnet/maui/fundamentals/app-lifecycle?view=net-maui-8.0)  
- [Testing y CI/CD MAUI](https://learn.microsoft.com/es-es/dotnet/maui/test-cloud/?view=net-maui-8.0)

# .NET MAUI + Blazor Hybrid  

[net](/software%20engineering/net/) ¬∑ [csharp](/software%20engineering/csharp/) ¬∑ blazor ¬∑ maui ¬∑ [xamarin](/desarrollo%20multiplataforma/xamarin/) ¬∑ frontend ¬∑ [Backend](/uncategorized/backend/)

---

## Introducci√≥n a Blazor Hybrid en .NET MAUI

**Blazor Hybrid** permite combinar **componentes web interactivos (Blazor)** dentro de una **aplicaci√≥n nativa .NET MAUI**, compartiendo la misma base de c√≥digo en CSharp y .NET.

Esta integraci√≥n une:
	- La **interfaz web basada en Razor Components**.  
	- El **renderizado nativo multiplataforma** de MAUI.  
	- Un √∫nico modelo de programaci√≥n full-stack C# (sin JavaScript).

El resultado: una aplicaci√≥n que puede usar **UI nativa o web embebida**, con acceso a **APIs del dispositivo y servicios locales**, sin depender de un navegador externo.

---

## Arquitectura h√≠brida

- **BlazorWebView**: el puente entre MAUI y Blazor.  
- **Razor Components**: UI basada en HTML + C#.  
- **Services & ViewModels**: compartidos entre Blazor y MAUI.  
- **Backend APIs** (opcional): comunicaci√≥n mediante HttpClient o SignalR.

{% raw %}
```

[ MAUI Host ]
‚îî‚îÄ‚îÄ BlazorWebView
‚îú‚îÄ‚îÄ Razor Components
‚îú‚îÄ‚îÄ Shared C# Logic
‚îî‚îÄ‚îÄ Interop con servicios nativos (GPS, Storage, etc.)

```
{% endraw %}`

Esta estructura permite usar Blazor para la UI principal, o solo para partes espec√≠ficas de la app (por ejemplo, dashboards o vistas reactivas).

---

## Configuraci√≥n de un proyecto Blazor Hybrid

Se puede crear un proyecto desde Visual Studio o CLI:

{% raw %}
```bash
dotnet new maui-blazor -n MyHybridApp
```
{% endraw %}`

Esto genera un proyecto MAUI con:
- `MainPage.xaml`: contenedor con `BlazorWebView`.
- `wwwroot/`: recursos est√°ticos (CSS, JS, im√°genes).
- `Pages/` y `Shared/`: componentes Razor.

### Ejemplo: `MainPage.xaml`

{% raw %}
```xml
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
			 xmlns:local="clr-namespace:MyHybridApp"
			 x:Class="MyHybridApp.MainPage">

	<BlazorWebView HostPage="wwwroot/index.html">
		<BlazorWebView.RootComponents>
			<RootComponent Selector="#app" ComponentType="{x:Type local:Main}" />
		</BlazorWebView.RootComponents>
	</BlazorWebView>
</ContentPage>
```
{% endraw %}

---

## Ejemplo b√°sico de componente Razor

{% raw %}
```razor
@page "/"
@inject HttpClient Http

<h1>Notas desde API</h1>

@if (notes == null)
{
	<p>Cargando...</p>
}
else
{
	<ul>
		@foreach (var note in notes)
		{
			<li>@note.Text</li>
		}
	</ul>
}

@code {
	private List<Note>? notes;

	protected override async Task OnInitializedAsync()
	{
		notes = await Http.GetFromJsonAsync<List<Note>>("https://api.example.com/notes");
	}
}
```
{% endraw %}

Este componente puede ejecutarse dentro del `BlazorWebView`, accediendo a los mismos servicios registrados por MAUI.

---

## Comunicaci√≥n entre Blazor y MAUI (Interop)

Puedes exponer **servicios nativos de MAUI** (p. ej. GPS, almacenamiento, c√°mara) a Blazor mediante **inyecci√≥n de dependencias compartida**:

### Ejemplo: inyectar un servicio MAUI en Blazor

#### 1. Registrar el servicio en `MauiProgram.cs`

{% raw %}
```csharp
builder.Services.AddSingleton<LocationService>();
```
{% endraw %}

#### 2. Servicio nativo (C#)

{% raw %}
```csharp
public class LocationService
{
	public async Task<string> GetLocationAsync()
	{
		var loc = await Geolocation.GetLastKnownLocationAsync();
		return loc == null ? "Sin datos" : $"{loc.Latitude}, {loc.Longitude}";
	}
}
```
{% endraw %}

#### 3. Usar el servicio desde Blazor

{% raw %}
```razor
@inject LocationService LocationService

<p>Ubicaci√≥n actual: @location</p>

@code {
	private string location = "Obteniendo...";

	protected override async Task OnInitializedAsync()
	{
		location = await LocationService.GetLocationAsync();
	}
}
```
{% endraw %}

Esto permite que un componente Razor acceda a hardware nativo sin usar JavaScript.

---

## Compartir c√≥digo entre UI nativa y Blazor

Un mismo `ViewModel`, `Service` o modelo de datos puede usarse tanto en:
- Una vista XAML nativa de MAUI.
- Un componente Razor Blazor.

### Ejemplo

{% raw %}
```csharp
public class NotesService
{
	private readonly HttpClient _http;
	public NotesService(HttpClient http) => _http = http;

	public async Task<List<Note>> GetNotesAsync() =>
		await _http.GetFromJsonAsync<List<Note>>("https://api.example.com/notes");
}
```
{% endraw %}

Tanto una p√°gina XAML (`NotesPage.xaml`) como un componente Razor (`Notes.razor`) pueden inyectar y usar `NotesService` sin duplicar l√≥gica.

---

## Integraci√≥n con [Backend](/uncategorized/backend/) y APIs

Blazor Hybrid puede consumir:
- APIs REST del backend.
- Servicios locales del dispositivo.
- WebSockets o SignalR para actualizaciones en tiempo real.
- gRPC-Web si se desea rendimiento binario en entorno h√≠brido.

Los componentes Razor pueden trabajar en modo offline, almacenando datos con SQLite o SecureStorage y sincronizando al reconectarse.

---

## Ejemplo completo: App h√≠brida de tareas

### Arquitectura

{% raw %}
```
- `MainPage.xaml` ‚Üí contenedor con `BlazorWebView`.
- `Tasks.razor` ‚Üí listado y formulario de tareas.
- `TaskService.cs` ‚Üí servicio compartido (REST + SQLite).
```
{% endraw %}

### Flujo

1. El usuario crea o edita tareas desde el componente Blazor.
2. Los datos se guardan localmente con SQLite.
3. Se sincronizan con el backend mediante API REST.
4. La UI Blazor refleja los cambios al instante.

### Ejemplo de componente

{% raw %}
```razor
@page "/tasks"
@inject TaskService TaskService

<h2>Tareas</h2>
<input @bind="newTask" placeholder="Nueva tarea" />
<button @onclick="AddTask">Agregar</button>

<ul>
	@foreach (var task in tasks)
	{
		<li>@task.Text</li>
	}
</ul>

@code {
	private List<TaskItem> tasks = new();
	private string newTask = "";

	protected override async Task OnInitializedAsync()
	{
		tasks = await TaskService.GetTasksAsync();
	}

	private async Task AddTask()
	{
		await TaskService.AddTaskAsync(new TaskItem { Text = newTask });
		tasks = await TaskService.GetTasksAsync();
		newTask = "";
	}
}
```
{% endraw %}

---

## Ventajas de Blazor Hybrid

- Reutilizaci√≥n de c√≥digo C# entre backend, l√≥gica y UI.  
- Renderizado web sin navegador externo.  
- Acceso directo a APIs nativas.  
- Actualizaci√≥n r√°pida mediante Hot Reload.  
- Ideal para apps empresariales o multiplataforma con UI web existente.

## Limitaciones y consideraciones

- Mayor consumo de memoria que una UI nativa pura.  
- No apto para apps con animaciones o gr√°ficos intensivos.  
- Requiere mantener `wwwroot` y componentes Razor.  
- Interfaz dependiente de WebView: rendimiento variable por plataforma.

---

## Integraci√≥n con Blazor Server y Blazor WebAssembly

Blazor Hybrid puede convivir con otros modelos de Blazor:

| Tipo            | Ejecuci√≥n                           | Casos de uso           |
| --------------- | ----------------------------------- | ---------------------- |
| **Hybrid**      | C√≥digo C# dentro de MAUI (nativo)   | Apps multiplataforma   |
| **Server**      | Renderizado en servidor via SignalR | Web apps empresariales |
| **WebAssembly** | Cliente puro en navegador           | SPA sin backend nativo |

Todos comparten el mismo modelo de componentes Razor, lo que permite migrar o reutilizar UI entre entornos.

---

## Despliegue

Las apps Blazor Hybrid se publican como **apps MAUI normales**, empaquetadas en formato nativo:

{% raw %}
```
- Android: `.aab` / `.apk`  
- iOS: `.ipa`  
- Windows: `.msix`  
- macOS: `.pkg`
```
{% endraw %}

No dependen de un servidor web, ya que **BlazorWebView ejecuta los componentes localmente**.

---

## Recursos adicionales

- [Documentaci√≥n oficial ‚Äì Blazor Hybrid](https://learn.microsoft.com/es-es/dotnet/maui/blazor/?view=net-maui-8.0)
- [dotnet/maui-samples (Blazor Hybrid demos)](https://github.com/dotnet/maui-samples)
- [BlazorWebView Overview ‚Äì Microsoft Docs](https://learn.microsoft.com/es-es/dotnet/maui/user-interface/controls/blazorwebview?view=net-maui-8.0)
- [Ejemplo: Blazor + MAUI Todo App (GitHub)](https://github.com/dotnet/maui-samples/tree/main/7.0/Apps/ToDoMauiBlazor)

---

## Pr√≥ximos temas sugeridos

- Blazor Hybrid + MAUI + Electron.NET (para escritorio extendido)  
- [pwa](/frontend/pwa/) y empaquetado h√≠brido  
- SignalR en tiempo real con Blazor Hybrid  
- Patr√≥n MVU (Model-View-Update) aplicado a MAUI-Blazor  
- Testing de componentes h√≠bridos con bUnit  

# .NET MAUI + Blazor Hybrid ‚Äì Integraci√≥n avanzada con servicios nativos  

[net](/software%20engineering/net/) ¬∑ [csharp](/software%20engineering/csharp/) ¬∑ blazor ¬∑ maui ¬∑ frontend ¬∑ [Backend](/uncategorized/backend/) ¬∑ [xamarin](/desarrollo%20multiplataforma/xamarin/) ¬∑ mobile

---
## Introducci√≥n

En un entorno **Blazor Hybrid + .NET MAUI**, los componentes Blazor se ejecutan dentro de un contenedor nativo (`BlazorWebView`).  
Esto permite acceder **directamente a APIs y hardware del dispositivo** sin usar JavaScript ni dependencias externas.  

Esta integraci√≥n se realiza mediante:
	- **Servicios nativos** registrados en el `MauiProgram.cs`.  
	- **Inyecci√≥n de dependencias** compartida entre MAUI y Blazor.  
	- **Microsoft.Maui.Essentials**, que unifica acceso a c√°mara, sensores, notificaciones, almacenamiento, etc.

---
## Arquitectura de integraci√≥n nativa

{% raw %}
```

[ .NET MAUI Host ]
‚îî‚îÄ‚îÄ BlazorWebView
‚îú‚îÄ‚îÄ Razor Components
‚îú‚îÄ‚îÄ Servicios C# inyectados (nativos)
‚îî‚îÄ‚îÄ API Essentials (GPS, c√°mara, bater√≠a, almacenamiento)

```
{% endraw %}`

Cada servicio puede exponerse como clase C# registrada en DI y consumida desde Blazor v√≠a `@inject`.

---

## üì± Notificaciones locales

Las notificaciones locales permiten enviar alertas o recordatorios desde la app sin conexi√≥n a internet.

### Servicio: `NotificationService.cs`

{% raw %}
```csharp
using Plugin.LocalNotification;

public class NotificationService
{
	public void Show(string title, string message)
	{
		var request = new NotificationRequest
		{
			NotificationId = 1,
			Title = title,
			Description = message,
			Schedule = new NotificationRequestSchedule
			{
				NotifyTime = DateTime.Now.AddSeconds(2)
			}
		};
		LocalNotificationCenter.Current.Show(request);
	}
}
```
{% endraw %}`

### Registro en `MauiProgram.cs`

{% raw %}
```csharp
builder.Services.AddSingleton<NotificationService>();
```
{% endraw %}

### Uso desde Blazor

{% raw %}
```razor
@inject NotificationService NotificationService

<button @onclick="Notify">Enviar notificaci√≥n</button>

@code {
	private void Notify()
	{
		NotificationService.Show("Recordatorio", "Has pulsado el bot√≥n de prueba");
	}
}
```
{% endraw %}

---

## üì∏ C√°mara y galer√≠a

Puedes capturar fotos o seleccionar im√°genes con la API nativa de MAUI (`MediaPicker`).

### Servicio: `CameraService.cs`

{% raw %}
```csharp
public class CameraService
{
	public async Task<FileResult?> TakePhotoAsync()
	{
		if (MediaPicker.Default.IsCaptureSupported)
		{
			return await MediaPicker.Default.CapturePhotoAsync();
		}
		return null;
	}

	public async Task<FileResult?> PickPhotoAsync()
	{
		return await MediaPicker.Default.PickPhotoAsync();
	}
}
```
{% endraw %}

### Uso desde Blazor

{% raw %}
```razor
@inject CameraService CameraService

<button @onclick="TakePhoto">üì∑ Tomar foto</button>

@if (photoPath != null)
{
	<img src="@photoPath" width="200" />
}

@code {
	private string? photoPath;

	private async Task TakePhoto()
	{
		var result = await CameraService.TakePhotoAsync();
		if (result != null)
			photoPath = result.FullPath;
	}
}
```
{% endraw %}

> üí° Blazor Hybrid puede mostrar im√°genes locales usando `file://` o `data:` URIs.

---

## üìÇ Almacenamiento local y archivos

Puedes guardar o leer archivos usando `FileSystem` y `Preferences`.

### Servicio: `StorageService.cs`

{% raw %}
```csharp
public class StorageService
{
	public string GetAppDataPath() => FileSystem.AppDataDirectory;

	public async Task SaveTextAsync(string filename, string text)
	{
		var path = Path.Combine(FileSystem.AppDataDirectory, filename);
		await File.WriteAllTextAsync(path, text);
	}

	public async Task<string?> ReadTextAsync(string filename)
	{
		var path = Path.Combine(FileSystem.AppDataDirectory, filename);
		return File.Exists(path) ? await File.ReadAllTextAsync(path) : null;
	}
}
```
{% endraw %}

### Uso desde Blazor

{% raw %}
```razor
@inject StorageService StorageService

<input @bind="text" placeholder="Escribe algo..." />
<button @onclick="Save">Guardar</button>
<button @onclick="Load">Cargar</button>

<p>@loadedText</p>

@code {
	private string text = "";
	private string loadedText = "";

	private async Task Save()
	{
		await StorageService.SaveTextAsync("demo.txt", text);
	}

	private async Task Load()
	{
		loadedText = await StorageService.ReadTextAsync("demo.txt") ?? "Archivo vac√≠o";
	}
}
```
{% endraw %}

---

## üß≠ Sensores del dispositivo

MAUI expone m√∫ltiples sensores: **GPS, aceler√≥metro, br√∫jula, bater√≠a, conectividad**, etc.
Estos se pueden consultar o suscribir desde Blazor sin intermediarios JS.

### Servicio: `SensorService.cs`

{% raw %}
```csharp
public class SensorService
{
	public async Task<string> GetLocationAsync()
	{
		var location = await Geolocation.GetLastKnownLocationAsync();
		return location == null ? "Sin ubicaci√≥n" : $"{location.Latitude}, {location.Longitude}";
	}

	public double GetBatteryLevel() => Battery.ChargeLevel * 100;
}
```
{% endraw %}

### Uso desde Blazor

{% raw %}
```razor
@inject SensorService SensorService

<h3>üìç Informaci√≥n del dispositivo</h3>
<p>Ubicaci√≥n: @location</p>
<p>Bater√≠a: @battery%</p>

<button @onclick="Refresh">Actualizar</button>

@code {
	private string location = "";
	private double battery;

	private async Task Refresh()
	{
		location = await SensorService.GetLocationAsync();
		battery = SensorService.GetBatteryLevel();
	}
}
```
{% endraw %}

---

## üõ†Ô∏è Manejo de permisos

Al acceder a c√°mara, almacenamiento o GPS, MAUI gestiona los permisos seg√∫n la plataforma.
Antes de usar una API, se recomienda solicitar permisos expl√≠citamente:

{% raw %}
```csharp
var status = await Permissions.RequestAsync<Permissions.Camera>();
if (status != PermissionStatus.Granted)
{
	// Mostrar aviso al usuario
}
```
{% endraw %}

En **Android**, declara permisos en `AndroidManifest.xml`.
En **iOS**, agrega descripciones en `Info.plist` (p. ej. `NSCameraUsageDescription`).

---

## üß© Integraci√≥n combinada ‚Äì ejemplo pr√°ctico

### Escenario

App h√≠brida de reportes de campo que:
- Usa la c√°mara para capturar una imagen.
- Guarda metadatos en almacenamiento local.
- Env√≠a notificaci√≥n local confirmando guardado.
- Adjunta coordenadas GPS.

### Flujo

1. El usuario abre el componente Blazor.
2. Pulsa ‚ÄúTomar foto‚Äù.
3. La imagen y datos se guardan con `StorageService`.
4. `SensorService` a√±ade ubicaci√≥n.
5. `NotificationService` env√≠a confirmaci√≥n.

{% raw %}
```razor
@page "/report"
@inject CameraService Camera
@inject StorageService Storage
@inject SensorService Sensor
@inject NotificationService Notify

<button @onclick="CreateReport">üì∏ Crear reporte</button>

<p>@status</p>

@code {
	private string status = "Esperando acci√≥n...";

	private async Task CreateReport()
	{
		var photo = await Camera.TakePhotoAsync();
		if (photo == null) return;

		var loc = await Sensor.GetLocationAsync();
		var metadata = $"Foto tomada en {DateTime.Now} - {loc}";

		await Storage.SaveTextAsync("report.txt", metadata);
		Notify.Show("Reporte creado", metadata);

		status = "Reporte guardado correctamente ‚úÖ";
	}
}
```
{% endraw %}

---

## üîê Buenas pr√°cticas de integraci√≥n


- Centralizar el acceso a APIs nativas en servicios.  
- Evitar llamadas directas desde componentes Razor.  
- Controlar errores por plataforma (try/catch con fallback).  
- Implementar permisos condicionales.  
- Usar `IConnectivity` para validar conexi√≥n antes de llamadas REST.  
- Aprovechar `Preferences` o `SecureStorage` para datos sensibles.  

---

## üöÄ Pruebas y despliegue

* Usa **Emuladores y simuladores** (Android/iOS) para validar hardware.
* Las APIs de `Essentials` se adaptan autom√°ticamente seg√∫n plataforma.
* En CI/CD, deshabilita funciones que requieran sensores f√≠sicos o usa mocks.
* Firma y distribuye como cualquier app MAUI (`.aab`, `.msix`, `.pkg`).

---

## üìö Recursos


- [Microsoft.Maui.Essentials overview](https://learn.microsoft.com/es-es/dotnet/maui/platform-integration/?view=net-maui-8.0)
- [Plugin.LocalNotification (GitHub)](https://github.com/thudugala/Plugin.LocalNotification)
- [Camera & MediaPicker en MAUI](https://learn.microsoft.com/es-es/dotnet/maui/platform-integration/device-media/picker?view=net-maui-8.0)
- [Geolocation y sensores](https://learn.microsoft.com/es-es/dotnet/maui/platform-integration/device/geolocation?view=net-maui-8.0)
- [FileSystem y almacenamiento](https://learn.microsoft.com/es-es/dotnet/maui/platform-integration/storage/filesystem?view=net-maui-8.0)
## Pr√≥ximos temas sugeridos

- Blazor Hybrid + MAUI + SignalR (sincronizaci√≥n en tiempo real)
- Arquitectura Clean Architecture h√≠brida (backend + MAUI + Blazor)
- [Testing](/testing/testing/) avanzado de servicios nativos (mocks y simulaciones)
- PWA + MAUI: empaquetado h√≠brido para escritorio y m√≥vil

# .NET MAUI + Blazor Hybrid ‚Äì Extensiones avanzadas y escenarios empresariales  
[net](/software%20engineering/net/) ¬∑ maui ¬∑ blazor ¬∑ hybrid ¬∑ [xamarin](/desarrollo%20multiplataforma/xamarin/) ¬∑ mobile ¬∑ [cloud](/uncategorized/cloud/) ¬∑ uiux ¬∑ arquitectura

---

## üåê Integraci√≥n con servicios web y APIs REST

Blazor Hybrid permite consumir servicios REST directamente desde el cliente, pero aprovechando **HttpClient** configurado a nivel MAUI para autenticaci√≥n, logs o compresi√≥n.

### Configuraci√≥n centralizada

{% raw %}
```csharp
builder.Services.AddHttpClient("ApiClient", client =>
{
	client.BaseAddress = new Uri("https://api.miempresa.com/");
	client.DefaultRequestHeaders.Add("Accept", "application/json");
});
```
{% endraw %}`

### Uso desde Blazor

{% raw %}
```razor
@inject IHttpClientFactory HttpFactory

@code {
	private async Task<List<Product>> LoadProductsAsync()
	{
		var client = HttpFactory.CreateClient("ApiClient");
		return await client.GetFromJsonAsync<List<Product>>("products");
	}
}
```
{% endraw %}

> üí° Se recomienda un **servicio intermedio** que encapsule las llamadas API, agregue caching o maneje reintentos autom√°ticos con `Polly`.

---

## üîÅ Comunicaci√≥n bidireccional Blazor ‚Üî Nativo

La comunicaci√≥n entre Blazor y c√≥digo nativo (C# MAUI) es fundamental cuando se requiere interacci√≥n directa entre UI web y l√≥gica de dispositivo.

### Desde Blazor a MAUI

Se realiza inyectando servicios nativos (`@inject`) o usando un *bridge* en el contenedor `BlazorWebView`.

{% raw %}
```csharp
blazorWebView.HostPage = "wwwroot/index.html";
blazorWebView.RootComponents.Add(new RootComponent
{
	Selector = "#app",
	ComponentType = typeof(MainPage)
});
blazorWebView.RegisterCustomJavaScriptBridge("AppInterop", new AppInterop());
```
{% endraw %}

### Desde MAUI a Blazor

Puedes invocar m√©todos de componentes Blazor desde C# usando `Dispatcher` o `IJSRuntime`.

{% raw %}
```csharp
await blazorWebView.Dispatcher.DispatchAsync(async () =>
{
	await blazorWebView.WebView.CoreWebView2.ExecuteScriptAsync("window.refreshUI()");
});
```
{% endraw %}

Esto permite, por ejemplo:
- Actualizar vistas Blazor al recibir datos nativos (sensores, Bluetooth).
- Sincronizar estado de la app entre capas.
- Integrar UI web con eventos nativos (por ejemplo, cierre de sesi√≥n autom√°tico).

---

## ‚ö° Sincronizaci√≥n en tiempo real con SignalR

Blazor Hybrid puede usar **SignalR** como cualquier aplicaci√≥n web para actualizaciones instant√°neas.
El cliente puede ejecutarse dentro del proceso MAUI, compartiendo conexi√≥n y almacenamiento local.

### Ejemplo b√°sico

{% raw %}
```csharp
builder.Services.AddSingleton<HubConnection>(sp =>
	new HubConnectionBuilder()
		.WithUrl("https://api.miempresa.com/hub/notificaciones")
		.WithAutomaticReconnect()
		.Build());
```
{% endraw %}

{% raw %}
```razor
@inject HubConnection Hub

@code {
	protected override async Task OnInitializedAsync()
	{
		Hub.On<string>("Mensaje", msg => mensajes.Add(msg));
		await Hub.StartAsync();
	}
}
```
{% endraw %}

> üöÄ Ideal para sincronizar estados en apps de inventario, chat, pedidos o telemetr√≠a en tiempo real.

---

## üîê Autenticaci√≥n y autorizaci√≥n h√≠brida

En escenarios empresariales se requiere integrar autenticaci√≥n nativa (AppCenter, MSAL, biometr√≠a) con Blazor y API backend.

### Tipos comunes de autenticaci√≥n

1. **OAuth2 / OpenID Connect (MSAL / Azure AD)**
   Integraci√≥n directa con `Microsoft.Identity.Client` para obtener tokens.

2. **Biometr√≠a nativa (FaceID / Fingerprint)**
   Uso de `Platform.CurrentActivity` o librer√≠as como `Plugin.Fingerprint`.

3. **JWT Token Sharing**
   El token JWT se guarda con `SecureStorage` y se pasa a Blazor a trav√©s de `HttpClient`.

{% raw %}
```csharp
var token = await SecureStorage.GetAsync("auth_token");
client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
```
{% endraw %}

> ‚öôÔ∏è Para entornos empresariales, la sincronizaci√≥n entre capas debe hacerse mediante un **servicio de sesi√≥n compartido**.

---

## üß© Integraci√≥n con hardware externo (Bluetooth, NFC, GPS extendido)

El modelo h√≠brido permite integrar librer√≠as MAUI para hardware extendido sin depender de JS.

### Bluetooth

Usa `Plugin.BLE` o `Shiny.BluetoothLE` para escanear y conectar dispositivos.

{% raw %}
```csharp
var adapter = CrossBluetoothLE.Current.Adapter;
adapter.DeviceDiscovered += (s, a) =>
{
	Console.WriteLine($"Dispositivo: {a.Device.Name}");
};
await adapter.StartScanningForDevicesAsync();
```
{% endraw %}

### NFC

`Shiny.Nfc` permite leer/escribir etiquetas NFC desde MAUI, pasando datos a Blazor mediante servicios inyectados.

### GPS avanzado

Para tracking continuo o rutas, combina `Geolocation` con `Geocoding` y `BackgroundService` (MAUI Worker) para enviar posiciones incluso con la app en segundo plano.

---

## üì§ Sincronizaci√≥n offline y almacenamiento h√≠brido

Blazor Hybrid puede trabajar **offline**, sincronizando datos locales con el servidor al reconectarse.

### Opciones de almacenamiento
- `SQLite` local (nativo en MAUI).  
- `LiteDB` o `Realm` para modelos offline con sincronizaci√≥n.  
- `Preferences` para configuraciones r√°pidas.  


### Ejemplo con SQLite

{% raw %}
```csharp
builder.Services.AddSingleton<LocalDatabase>();

public class LocalDatabase
{
	private readonly SQLiteAsyncConnection _db;
	public LocalDatabase()
	{
		var path = Path.Combine(FileSystem.AppDataDirectory, "app.db");
		_db = new SQLiteAsyncConnection(path);
		_db.CreateTableAsync<Report>();
	}
	public Task<int> SaveAsync(Report report) => _db.InsertAsync(report);
}
```
{% endraw %}

> üíæ La capa de datos puede compartirse entre MAUI (nativo) y Blazor (interfaz).

---

## üß† Patrones de arquitectura h√≠brida recomendados

Para mantener escalabilidad y limpieza del c√≥digo:

* **MVU (Model‚ÄìView‚ÄìUpdate)** o **MVVM** con `CommunityToolkit.Mvvm`.
* **Clean Architecture**: separaci√≥n entre UI, l√≥gica y persistencia.
* **Service Locator Pattern** para inyectar servicios nativos en Blazor.
* **Reactive UI / EventBus** para comunicaci√≥n entre componentes.

### Ejemplo con MVVM + Blazor

{% raw %}
```csharp
public partial class ReportViewModel : ObservableObject
{
	[ObservableProperty]
	private string reportStatus = "Iniciando...";

	private readonly NotificationService _notification;

	public ReportViewModel(NotificationService notification)
	{
		_notification = notification;
	}

	public void SaveReport()
	{
		_notification.Show("Reporte", "Guardado con √©xito");
		ReportStatus = "Completado ‚úÖ";
	}
}
```
{% endraw %}

Blazor consume el `ViewModel` directamente v√≠a `@inject` o mediante un `CascadingParameter`.

---

## üß± Personalizaci√≥n UI/UX h√≠brida

Combina **controles nativos MAUI** con **componentes Razor** para ofrecer una experiencia fluida:

{% raw %}
```
- P√°ginas nativas (`ContentPage`, `Shell`) con fragmentos Blazor (`BlazorWebView`).  
- Controles MAUI para navegaci√≥n, men√∫s, tabs y modales.  
- CSS y temas compartidos (`wwwroot/css`) con estilos adaptativos.  
- Animaciones con `CommunityToolkit.Maui.Animations`.
```
{% endraw %}

### Ejemplo de Shell + BlazorWebView

{% raw %}
```xml
<ShellContent Title="Inicio">
	<BlazorWebView HostPage="wwwroot/index.html">
		<BlazorWebView.RootComponents>
			<RootComponent Selector="#app" ComponentType="{x:Type local:Main}" />
		</BlazorWebView.RootComponents>
	</BlazorWebView>
</ShellContent>
```
{% endraw %}

> üé® Los temas pueden adaptarse con variables CSS ligadas a `AppThemeBinding` para modo oscuro y claro.

---

## ‚òÅÔ∏è Despliegue y CI/CD

* Publica como **APK / AAB**, **MSIX**, o **PKG** seg√∫n la plataforma.
* Usa **.NET MAUI Workload** en GitHub Actions o Azure Pipelines.
* Automatiza versiones y firmas con `dotnet workload install maui` + `msbuild`.
* Empaqueta recursos Blazor (`wwwroot`) junto con el proyecto MAUI.

> üí° En entornos enterprise, se recomienda usar App Center o Intune para distribuci√≥n controlada.

---

## üìä Monitorizaci√≥n y telemetr√≠a

Integraci√≥n directa con:
- **App Center Analytics**
- **Azure Application Insights**
- **Sentry** o **Raygun** para capturar errores y m√©tricas.

{% raw %}
```csharp
AppCenter.Start("android=APP_KEY;ios=APP_KEY;", typeof(Analytics), typeof(Crashes));
```
{% endraw %}

> Los eventos y m√©tricas pueden combinarse con logs de Blazor (`ILogger`) para obtener trazabilidad completa.

---

## üîÆ Pr√≥ximos m√≥dulos sugeridos

- Blazor Hybrid + MAUI + SignalR + Offline Sync  
- Clean Architecture aplicada a proyectos h√≠bridos  
- [Testing](/testing/testing/) de UI y servicios nativos con `xUnit` + `bUnit` + `MauiTest`  
- Integraci√≥n con AI Services (Cognitive Services, OpenAI, Azure AI)  
- Blazor MAUI Desktop: crear apps de escritorio multiplataforma con l√≥gica compartida  
- Micro Frontends h√≠bridos con Blazor WebAssembly + MAUI Host



