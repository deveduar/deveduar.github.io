---
date: 2025-01-29 17:53
title: astro
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
public_note: "true"
category: astro
tags:
  - astro
  - framework
  - Frontend
---
# Astro
``$= dv.current().file.tags.join(" ")``

## Panorama general
- [Frontend](/uncategorized/frontend/) y [Backend](/uncategorized/backend/) framework h√≠brido orientado a contenido.
- Enfoque principal en **SSG (Static Site Generation)**, optimizado para sitios r√°pidos basados en contenido.
- Soporte completo para **SSR (Server-Side Rendering)** cuando el proyecto requiere din√°micas del lado servidor.
- Integraci√≥n fluida con ecosistemas como [react](/frontend/react/), [vuejs](/frontend/vuejs/), Svelte, Solid y otros.
- Documentaci√≥n oficial: [Astro](https://docs.astro.build/en/getting-started/)

## Fundamentos
- Arquitectura basada en **Islands Architecture**, donde solo partes interactivas del sitio se hidratan en cliente.
- ‚ÄúIsland components‚Äù ejecutados **en el servidor por defecto**, minimizando el JS enviado al navegador.
- Fuerte soporte para **Markdown**, **MDX** y contenido est√°tico como base de proyectos orientados a documentaci√≥n o blogs.
- Compatibilidad con **Layouts**, **Collections**, y la API unificada de contenido `Content Collections`.
- Rutas basadas en archivos (`/src/pages`), compatible con APIs serverless mediante `.js/.ts` en el mismo sistema de rutas.

## Caracter√≠sticas clave
- Render por defecto en servidor, enviando HTML pre-generado ultra-eficiente.
- Zero-JS por defecto: ‚Äúbring your own framework‚Äù sin cargar nada al cliente a menos que se especifique.
- Hibridaci√≥n inteligente usando directivas (`client:load`, `client:idle`, `client:visible`, etc.).
- Integraci√≥n con herramientas modernas: Vite, TypeScript, Tailwind, y adaptadores para m√∫ltiples plataformas.

## Island Components
- Componentes interactivos aislados.
- Se procesan en servidor y env√≠an al cliente solo cuando es estrictamente necesario.
- Permiten mezclar m√∫ltiples frameworks en un mismo proyecto sin coste adicional en arquitectura.

## Markdown y Contenido
- Soporta `.md` y `.mdx`, convirtiendo cada archivo en una ruta si se ubica en `src/pages`.
- ‚ÄúContent Collections‚Äù permiten tipado, validaci√≥n y organizaci√≥n de contenido estructurado.
- Soporte para frontmatter YAML con tipado autom√°tico en TypeScript.
- `astro:content` aporta utilidades para cargar, validar y transformar contenido antes del render.

## Integraci√≥n con Frameworks
- Puedes usar componentes de:
	- [react](/frontend/react/)
	- [vuejs](/frontend/vuejs/)
	- Svelte
	- [solid.js](/frontend/solid-js/)
	- Preact
- Cada framework puede ser hidratado de forma independiente usando directivas cliente.
- Ideal para migraciones parciales o proyectos multicapa.

## SSR (Server-Side Rendering)
- Modo opcional para apps con:
	- Autenticaci√≥n
	- Personalizaci√≥n de contenido
	- Integraci√≥n con bases de datos
- Adaptadores disponibles para:
	- Node
	- Deno
	- Cloudflare
	- Netlify
	- Vercel

## Bloques de c√≥digo

### Ejemplo b√°sico de p√°gina Astro
{% raw %}
```astro
---
// Frontmatter en Astro: JS/TS ejecutado en el servidor
const title = "Hola desde Astro";
---
<html>
	<head>
		<title>{title}</title>
	</head>
	<body>
		<h1>{title}</h1>
		<p>Esta es una p√°gina generada con Astro.</p>
	</body>
</html>
```
{% endraw %}`

### Uso de un componente React como ‚Äúisland‚Äù

{% raw %}
```astro
---
import Counter from "../components/Counter.jsx";
---
<div>
	<h2>Contador interactivo</h2>
	<Counter client:idle />
</div>
```
{% endraw %}

### Ejemplo simple de Markdown convertido en p√°gina

{% raw %}
```markdown
---
title: "Mi p√°gina en Markdown"
description: "Astro convierte Markdown en HTML autom√°ticamente"
---

# Hola desde Markdown
Contenido est√°tico, r√°pido y limpio.
```
{% endraw %}

### Ejemplo de Collection

{% raw %}
```ts
import { defineCollection, z } from "astro:content";

export const collections = {
	blog: defineCollection({
		schema: z.object({
			title: z.string(),
			date: z.string(),
			tags: z.array(z.string()).optional()
		})
	})
};
```
{% endraw %}

# Astro ‚Äî Expansi√≥n de conceptos faltantes

## ¬øQu√© conceptos quedaban por cubrir?
A√∫n quedaban √°reas relevantes que no se hab√≠an cubierto y que completan la visi√≥n global de Astro sin repetir lo anterior:
- Sistema de rutas avanzado
- Endpoints API y server logic
- Data fetching y patrones de carga
- Arquitectura de renderizado granular (Partial/Hydration Strategies)
- Integraci√≥n con estilos y CSS
- Performance, caching y optimizaci√≥n de build
- Integraci√≥n con bases de datos y servicios externos
- Middleware y hooks
- Configuraci√≥n avanzada de proyecto
- Despliegue y adaptadores
- Testing
- DevTools y DX

A continuaci√≥n se presenta una **nota expandida**, organizada y sin repetir lo anterior.

---

# Astro ‚Äî Conceptos avanzados y arquitectura extendida

## Rutas y Estructura de Navegaci√≥n
- Sistema basado en archivos dentro de `src/pages`.
- Rutas din√°micas mediante `[param].astro`.
- Rutas anidadas simplemente ubicando carpetas dentro de `pages`.
- Soporte para **catch-all** con `[...slug].astro`.
- Posibilidad de mezclar p√°ginas `.astro`, `.md`, `.mdx`, `.js`, `.ts`.
- Rutas de API disponibles en el mismo sistema de archivos.

### Ejemplo de ruta din√°mica
{% raw %}
```astro
---
export async function getStaticPaths() {
	return [
		{ params: { id: "1" } },
		{ params: { id: "2" } }
	];
}

export async function get({ params }) {
	return {
		body: `ID: ${params.id}`
	};
}
---
```
{% endraw %}`

## API Endpoints y l√≥gica servidor

* Archivos `.js` o `.ts` dentro de `src/pages/api`.
* Permiten crear:
  * Endpoints REST
  * Webhooks
  * L√≥gica de backend simple
* Totalmente compatibles con adaptadores SSR y plataformas serverless.

### Ejemplo de endpoint API

{% raw %}
```ts
export function get() {
	return new Response(JSON.stringify({ ok: true }), {
		headers: { "Content-Type": "application/json" }
	});
}
```
{% endraw %}

## Data Fetching

* Carga de datos **en servidor** en el frontmatter (`---`) de los archivos `.astro`.
* Integraci√≥n con fetch nativo.
* Compatible con `getStaticPaths`, `get` y SSR puro.
* No env√≠a JS extra al cliente a menos que se use un ‚Äúisland‚Äù.

### Ejemplo de data fetching en `.astro`

{% raw %}
```astro
---
const res = await fetch("https://api.example.com/posts");
const posts = await res.json();
---
<ul>
	{posts.map(post => <li>{post.title}</li>)}
</ul>
```
{% endraw %}

## Estrategias de Hidrataci√≥n Avanzada

* Adem√°s de `client:load`, `client:idle`, `client:visible` existen nuevas estrategias:

  * **client:media** ‚Äî hidrata seg√∫n media-queries.
  * **client:hover** ‚Äî hidrata al interactuar con hover.
* Permiten controlar con precisi√≥n cu√°nta interactividad carga el usuario.
* Combinables con m√∫ltiples frameworks simult√°neamente.

## Estilos y CSS

* Soporte integrado para:

  * CSS global (`src/styles`)
  * CSS Scoped dentro de `.astro`
  * Tailwind (config oficial)
  * PostCSS y Sass
  * CSS Modules
* Cada `.astro` puede contener estilos encapsulados.

### Ejemplo de CSS Scoped

{% raw %}
```astro
<style>
	h1 {
		color: var(--accent);
	}
</style>
```
{% endraw %}

## Performance y Optimizaci√≥n

* Astro produce HTML est√°tico ultra-optimizado.
* Minimiza JS por defecto.
* Optimiza im√°genes autom√°ticamente con `@astrojs/image`.
* Integraci√≥n con:

  * Prefetch autom√°tico de rutas
  * Carga diferida de componentes
  * Caching inteligente por adaptador
* Build final altamente estable y con tree-shaking aplicado a islands.

## Integraci√≥n con Bases de Datos y Servicios

* Usando SSR o endpoints API:
  * Conexiones a PostgreSQL, MySQL, MongoDB, Redis, Supabase, etc.
* En SSG:
  * Astro genera el contenido en build-time usando fetch o SDKs.

## Middleware y Hooks

* Middleware global mediante `src/middleware.js`.
* Permite:
  * Autenticaci√≥n
  * Reescritura de rutas
  * Inyecci√≥n de headers
  * Validaci√≥n de acceso
* Hooks integrados en `astro.config.mjs` (build, dev, pre-render, etc.).

### Ejemplo de middleware simple

{% raw %}
```ts
export async function onRequest({ request, locals, url }, next) {
	if (url.pathname.startsWith("/admin") && !locals.user) {
		return new Response("Unauthorized", { status: 401 });
	}
	return next();
}
```
{% endraw %}

## Configuraci√≥n Avanzada (`astro.config.mjs`)

* Personalizaci√≥n de:
  * Integraciones
  * Adaptadores
  * Pre-render
  * Markdown
  * Aliases
  * Server config
* Integraciones oficiales: React, Vue, Svelte, Tailwind, MDX, Sitemap, Partytown, Solid.

### Alias √∫til

{% raw %}
```js
alias: {
	"@components": "./src/components",
	"@lib": "./src/lib"
}
```
{% endraw %}

## Despliegues y Adaptadores (ampliado)

No repetimos lo mencionado antes, sino que a√±adimos:

* **Static** ‚Äî genera HTML sin servidor (el modo m√°s r√°pido).
* **Node SSR** ‚Äî para proyectos grandes con backend tradicional.
* **Edge** ‚Äî ejecuta en Cloudflare y otros entornos edge.
* **Hybrid Render** ‚Äî p√°ginas mezcladas entre SSG y SSR.
* Auto-inyecci√≥n de headers, streaming, caching y compatibilidad con Edge Functions.

## Testing y Calidad

* Testing recomendado:

  * **Vitest** para l√≥gica interna.
  * **Playwright** para e2e.
  * **@astrojs/test** para componentes `.astro`.
* Integraci√≥n con TypeScript estricta.
* Tipado autom√°tico de contenido con `astro:content`.

## Herramientas de Desarrollo

* Astro Dev Tools (extensi√≥n navegador).
* Vista de rutas en tiempo real.
* Inspecci√≥n de islands y rutas.
* Logs detallados de SSR y compilaci√≥n.

---

# Nota complementaria: conceptos que completan la arquitectura de Astro

* **Fragmentos (`<Fragment />`)** para composici√≥n sin nodos extra.
* **Slots avanzados**: m√∫ltiples, nombrados y anidados.
* **Prerender a nivel de p√°gina** con `export const prerender = true;`.
* **Streaming SSR** renderizando HTML progresivo.
* **Static redirects** y **server redirects**.
* **Hybrid islands** combinando frameworks dentro del mismo componente.

Si deseas puedo generar:

* Una **nota separada** solo para ‚ÄúSSR y arquitectura de renderizado‚Äù.
* Un **glosario de conceptos** completo.
* Una **nota pr√°ctica** con patrones de uso reales.
* Una **gu√≠a de migraci√≥n** desde Next.js o Vite SPA.


