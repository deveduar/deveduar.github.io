---
date: 2025-01-29 17:36
title: sveltkit
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
public_note: "true"
category: Frontend
tags:
  - svelt
  - ui
  - framework
  - svelkit
  - frameworks
---
# SvelteKit
``$= dv.current().file.tags.join(" ")``

- [Frontend](/uncategorized/frontend/)
- [SvelteKit](https://kit.svelte.dev/)
- Framework UI

## Qu√© es SvelteKit
SvelteKit es el framework oficial basado en Svelte que permite construir aplicaciones completas (SSR, SPA, SSG, Edge Rendering). Combina un enrutado basado en el filesystem, loaders y actions, adaptadores desplegables y una arquitectura optimizada para rendimiento.

## Caracter√≠sticas clave
- **SSR progresivo**: Renderizado inicial en servidor con hidraci√≥n parcial.
- **File-based routing**: La estructura de `/src/routes` determina las rutas autom√°ticamente.
- **Optimizaci√≥n autom√°tica**: Code-splitting, prerendering selectivo, tree-shaking y cargas diferidas.
- **Adaptadores**: Deploy a Node, Vercel, Cloudflare, Netlify, est√°tico, etc.
- **Reactividad de Svelte**: Actualizaci√≥n fina sin VDOM.
- **Stores compartidos**: Estado global reactivo sin librer√≠as externas.
- **Acciones y loaders**: L√≥gica de servidor integrada sin necesidad de backend separado.

## Estructura b√°sica de un proyecto
- `/src/routes`  
	- Define p√°ginas, layouts y endpoints.
- `/src/lib`  
	- C√≥digo reutilizable (componentes, utilidades, stores).
- `+page.svelte`  
	- Componente de p√°gina.
- `+page.server.js`  
	- L√≥gica que corre exclusivamente en el servidor.
- `+layout.svelte`  
	- Plantilla com√∫n para un conjunto de rutas.
- `+layout.server.js`  
	- L√≥gica para cargar datos comunes.

## Fundamentos del enrutado
- **Rutas simples**: `src/routes/about/+page.svelte` ‚Üí `/about`
- **Rutas din√°micas**: `src/routes/blog/[slug]/+page.svelte`
- **Layouts anidados**: Cada carpeta puede tener su propio layout que se compone con los superiores.
- **Rutas API**: `+server.js` o `+server.ts` crean endpoints REST o acciones personalizadas.

## Loaders (`load`)
Permiten cargar datos antes de renderizar la p√°gina. Pueden ejecutarse en servidor o cliente seg√∫n el archivo.

### `+page.js` y `+layout.js`
- Se ejecutan en cliente tras la primera carga.
- √ötiles para datos no sensibles o din√°micos.

### `+page.server.js` y `+layout.server.js`
- Siempre se ejecutan en el servidor.
- Ideales para datos sensibles, consultas protegidas o acceso a APIs privadas.

## Actions (formularios progresivos)
Permiten manejar formularios y mutaciones sin necesidad de endpoints adicionales.

- `+page.server.js` define acciones como `actions = { default: async (event) => { ... } }`
- Funcionan con SSR, devolviendo `fail()` o `redirect()` seg√∫n el flujo.
- Compatibles con progressive enhancement.

## Stores y estado global
- **Writable**: estado reactivo mutable.
- **Readable**: estado derivado o est√°tico.
- **Derived**: valores calculados autom√°ticamente.
- Permiten manejar estado global sin Redux ni context.

## Rendering modes
- **SSR** (por defecto): Ideal para SEO y contenido din√°mico.
- **CSR**: Cuando necesitas una SPA pura.
- **Prerendering**: Generaci√≥n est√°tica de rutas (`prerender = true`).
- **Hybrid**: Mezcla de est√°tico + din√°mico seg√∫n ruta.

## Despliegue y adaptadores
SvelteKit usa adaptadores para ajustar el build al entorno de ejecuci√≥n.

- `@sveltejs/adapter-auto` ‚Üí elige el mejor para tu entorno.
- `@sveltejs/adapter-node` ‚Üí servidor Node.
- `@sveltejs/adapter-cloudflare` ‚Üí workers.
- `@sveltejs/adapter-vercel` ‚Üí Vercel Edge/Serverless.
- `@sveltejs/adapter-static` ‚Üí sitios 100% prerenderizados.

## Buenas pr√°cticas esenciales
- Usar `+page.server.js` para datos sensibles.
- Mantener l√≥gica de negocio en `/src/lib`.
- Aprovechar `form actions` para mutaciones.
- Dividir layouts para mejorar composici√≥n y performance.
- Usar `export const prerender = true` en rutas est√°ticas.

---

## Ejemplos de c√≥digo

### Ejemplo: loader en `+page.server.js`
{% raw %}
```javascript
// +page.server.js
export async function load({ params }) {
	const post = await fetchPost(params.slug);
	return { post };
}
```
{% endraw %}`

### Ejemplo: acci√≥n de formulario

{% raw %}
```javascript
// +page.server.js
import { fail, redirect } from '@sveltejs/kit';

export const actions = {
	default: async ({ request }) => {
		const data = Object.fromEntries(await request.formData());
		const ok = await saveUser(data);

		if (!ok) return fail(400, { message: 'Datos inv√°lidos' });
		throw redirect(303, '/dashboard');
	}
};
```
{% endraw %}

### Ejemplo: store global

{% raw %}
```javascript
// src/lib/stores/user.js
import { writable } from 'svelte/store';

export const user = writable(null);
```
{% endraw %}

### Ejemplo: p√°gina con datos cargados

{% raw %}
```svelte
<!-- +page.svelte -->
<script>
	export let data;
</script>

<h1>{data.post.title}</h1>
<p>{data.post.content}</p>
```
{% endraw %}


# SvelteKit ‚Äî Conceptos Avanzados

## Hooks y ciclo de vida del servidor
SvelteKit permite interceptar y modificar peticiones y respuestas usando hooks. Se definen en `src/hooks.server.js`.

- **handle**: Permite envolver todas las requests y responses.
{% raw %}
```javascript
// src/hooks.server.js
export async function handle({ event, resolve }) {
	// Modificar request o autenticar usuario
	const response = await resolve(event);
	return response;
}
```
{% endraw %}
- **handleFetch**: Intercepta fetch internos para a√±adir headers, tokens, etc.
- **handleError**: Maneja errores globales de SSR.
- **getSession** (deprecated, se reemplaza con `event.locals`): permite exponer datos de usuario a la app.

## `event.locals` y manejo de estado temporal
`event.locals` es el lugar recomendado para almacenar datos por request, como usuario autenticado.

{% raw %}
```javascript
// src/hooks.server.js
export async function handle({ event, resolve }) {
	event.locals.user = await getUserFromCookie(event.request.headers.get('cookie'));
	return resolve(event);
}
```
{% endraw %}

## Rutas protegidas y autenticaci√≥n
Para proteger rutas se puede usar un loader en `+page.server.js` verificando `event.locals`:

{% raw %}
```javascript
// +page.server.js
import { redirect } from '@sveltejs/kit';

export async function load({ locals }) {
	if (!locals.user) throw redirect(303, '/login');
	return { user: locals.user };
}
```
{% endraw %}

## Manejo avanzado de errores
- `+error.svelte` captura errores por ruta.  
- `handleError` permite logging global:
{% raw %}
```javascript
// src/hooks.server.js
export function handleError({ error, event }) {
	console.error('Error en request:', event.url, error);
	return { message: 'Ocurri√≥ un error interno' };
}
```
{% endraw %}

## Optimizaci√≥n y rendimiento
- **Prerendering selectivo**: `export const prerender = true/false`  
- **Streaming SSR**: permite enviar contenido progresivamente al cliente.  
- **Cache control**: configurar headers para mejorar el rendimiento y edge caching.  
- **Edge rendering**: desplegar con adaptadores para ejecuci√≥n en CDN/Edge.

## Formularios avanzados y validaci√≥n
- Uso de librer√≠as como `zod` o `superValidate` para validaci√≥n avanzada.  
- Compatible con progressive enhancement.
{% raw %}
```javascript
import { z } from 'zod';
const schema = z.object({ email: z.string().email() });
```
{% endraw %}

## Environment Variables
- `$env/static/private` ‚Üí variables privadas disponibles solo en build/server.  
- `$env/static/public` ‚Üí expuestas al cliente.  
- `$env/dynamic/private` ‚Üí accesibles din√°micamente en SSR.  

## Internacionalizaci√≥n (i18n)
- Se puede integrar usando stores y loaders para traducir contenido din√°mico.  
- Ejemplo simple con store:
{% raw %}
```javascript
// src/lib/stores/i18n.js
import { writable } from 'svelte/store';
export const locale = writable('es');
```
{% endraw %}

## Navegaci√≥n, transiciones y layouts avanzados
- `<slot>` permite componer layouts.  
- Layouts paralelos: diferentes layouts para rutas espec√≠ficas.  
- Layout resets: reiniciar layout en subruta usando `+layout.reset.svelte`.

## Acceso avanzado a cookies y request
- `event.cookies` permite leer y escribir cookies con seguridad.
{% raw %}
```javascript
// +page.server.js
export function load({ cookies }) {
	const token = cookies.get('session');
	return { token };
}
```
{% endraw %}

## Integraci√≥n con bases de datos y ORMs
- Conexi√≥n directa en loaders o actions (`+page.server.js`) usando Prisma, Drizzle o cualquier ORM.  
- Evitar exponer credenciales al cliente.

## Testing en SvelteKit
- **Vitest** ‚Üí testing unitario de componentes y stores.  
- **Playwright** ‚Üí pruebas end-to-end para navegaci√≥n, SSR y formularios.

## Configuraci√≥n avanzada
- `svelte.config.js` permite configurar adaptadores, preprocessors, alias y m√°s.  
- Ejemplo:
{% raw %}
```javascript
import adapter from '@sveltejs/adapter-vercel';
export default {
	kit: {
		adapter: adapter(),
		alias: { $lib: 'src/lib' }
	}
};
```
{% endraw %}

## Datos incrementales y partial loading
- Cargar solo lo necesario para renderizar primero.  
- Ideal para dashboards y listados grandes.  
- Se combina con streaming SSR para mejorar experiencia de usuario.

## Summary
SvelteKit avanzado combina:
	- SSR optimizado y edge-ready  
	- Form actions progresivos y seguros  
	- Manejo de errores y estado por request (`event.locals`)  
	- Internacionalizaci√≥n y layouts complejos  
	- Integraci√≥n con bases de datos y testing completo  
	- Optimizaci√≥n mediante prerendering, streaming y cache control  

Estos conceptos permiten construir aplicaciones completas, escalables y seguras sin depender de librer√≠as externas para estado, routing o validaci√≥n.
