---
date: 2025-10-13 15:24
title: git hooks
tags:
  - git
  - github
  - automation
  - automatizacion
  - git_hooks
keywords:
source:
status: 游
Parent: "[[Area-Prog]]"
cssclasses:
  - hide-embedded-header1
categories:
  - Automatizacion y Build
public_note: "true"
category: Automatizacion y Build
---
# Git Hooks
``$= dv.current().file.tags.join(" ")``

- [Software engineering](/uncategorized/software-engineering/)
- [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
- [git](/software%20engineering/git/)
- [husky](/automatizacion%20y%20build/husky/)

## Documentaci칩n y Recursos
- Git - Git Hooks
- [GitHub - edunavajas/git-commit-enhancer: Automatic git Hook that captures the original commit and send it to Gemini Api to enhance it](https://github.com/edunavajas/git-commit-enhancer)

## Conceptos Clave
- **Git Hooks**: Scripts que se ejecutan autom치ticamente en respuesta a ciertos eventos en el repositorio de Git, como commits, merges o push.
- **Tipos de Hooks**:
	- **Client-side Hooks**: Se ejecutan en el cliente donde ocurre la acci칩n (por ejemplo, `pre-commit`, `prepare-commit-msg`, `commit-msg`, `post-commit`).
	- **Server-side Hooks**: Se ejecutan en el servidor de Git, 칰tiles para controlar pushes o actualizaciones (por ejemplo, `pre-receive`, `update`, `post-receive`).
- **Usos Comunes**:
	- Validar mensajes de commit.
	- Ejecutar tests autom치ticamente antes de un commit o push.
	- Formatear c칩digo antes de guardar cambios.
	- Integrar herramientas de CI/CD y an치lisis de calidad de c칩digo.
	- Automatizar tareas repetitivas de desarrollo.

## Ejemplos de Hooks

### pre-commit
```bash
#!/bin/sh
# Evita commits si hay errores de lint
npm run lint
if [ $? -ne 0 ]; then
  echo "Lint errors found. Commit aborted."
  exit 1
fi
````

### commit-msg

```bash
#!/bin/sh
# Valida que el mensaje de commit siga el patr칩n de convenciones
commit_regex='^feat|fix|docs|style|refactor|test|chore: .+$'
if ! grep -qE "$commit_regex" "$1"; then
  echo "Error: commit message does not follow convention"
  exit 1
fi
```

### post-commit

```bash
#!/bin/sh
# Enviar notificaci칩n despu칠s del commit
echo "Commit realizado con 칠xito: $(git log -1 --pretty=%B)"
```

## Herramientas y Mejoras

- **git-commit-enhancer**: Hook autom치tico que captura el commit original y lo mejora usando Gemini API.
- Integraci칩n con linters, formateadores y pruebas unitarias para garantizar calidad antes del push.
- Scripts personalizados seg칰n el flujo de trabajo del equipo o proyecto.

## Buenas Pr치cticas

- Versionar hooks dentro del repositorio (`.githooks`) y usar `core.hooksPath` para que todos los desarrolladores los tengan consistentes.
- Mantener hooks ligeros para no afectar el flujo de trabajo.
- Documentar cada hook y su prop칩sito.
- Priorizar hooks client-side para validaciones preventivas y server-side para reglas cr칤ticas.


# Git Hooks - Avanzado

## Tipos Avanzados de Hooks
- **Client-side Hooks** (ya mencionados) se pueden detallar:
	- `pre-rebase`: Se ejecuta antes de un rebase, 칰til para prevenir conflictos y mantener commits limpios.
	- `pre-push`: Valida cambios antes de enviar al remoto, ejecutando tests o an치lisis de seguridad.
	- `prepare-commit-msg`: Modifica o preconfigura mensajes de commit autom치ticamente.

- **Server-side Hooks** (ya mencionados) con casos de uso:
	- `pre-receive`: Previene push si no cumple pol칤ticas del repositorio (ej: tests fallidos, rama protegida).
	- `update`: Similar a pre-receive, pero espec칤fico para cada rama.
	- `post-receive`: Puede disparar integraciones CI/CD, despliegues autom치ticos o notificaciones.

## Integraciones y Automatizaci칩n
- **CI/CD Hooks**: Integraci칩n con herramientas como GitHub Actions, GitLab CI, Jenkins.
- **Automatizaci칩n de commits**:
	- A침adir informaci칩n autom치tica sobre el autor, fecha o ticket asociado.
	- Formatear mensajes seg칰n convenciones internas del equipo.
- **Seguridad y calidad de c칩digo**:
	- Validaci칩n de vulnerabilidades antes del push.
	- Enforcear reglas de branch o protecci칩n de ramas.

## Ejemplos Avanzados de Hooks

### pre-push
```bash
#!/bin/sh
# Ejecutar tests antes de hacer push
npm test
if [ $? -ne 0 ]; then
  echo "Tests fallidos. Push cancelado."
  exit 1
fi
````

### pre-rebase

```bash
#!/bin/sh
# Evitar rebase si hay cambios locales no comprometidos
if ! git diff-index --quiet HEAD --; then
  echo "Cambios locales detectados. Guarda o commitea antes de rebase."
  exit 1
fi
```

### post-receive

```bash
#!/bin/sh
# Desplegar autom치ticamente al servidor de staging
while read oldrev newrev refname
do
  if [ "$refname" = "refs/heads/main" ]; then
    echo "Desplegando cambios en main a staging..."
    ./deploy_staging.sh
  fi
done
```

## Herramientas Complementarias

- **[git-commit-enhancer](https://github.com/edunavajas/git-commit-enhancer)**: Mejora autom치tica de mensajes de commit usando IA.
- **Husky**: Facilita la gesti칩n de hooks en proyectos Node.js.
- **Lint-staged**: Ejecuta linters solo sobre archivos staged para mejorar velocidad y eficiencia.
- Integraci칩n con an치lisis est치tico de c칩digo como ESLint, Prettier, Pylint, Checkstyle.

## Buenas Pr치cticas Avanzadas

- Mantener todos los hooks versionados y en un directorio centralizado (`.githooks`).
- Usar hooks client-side para prevenci칩n y server-side para reglas cr칤ticas.
- Documentar cada hook y su objetivo.
- Combinar hooks con pipelines CI/CD para mayor seguridad y consistencia.
- Revisar peri칩dicamente los hooks para adaptarlos a nuevas necesidades del equipo o proyecto.

# Git Hooks - Ejemplos Pr치cticos y Casos de Uso

## Conceptos Clave
- **Git Hooks**: Scripts autom치ticos que se ejecutan ante eventos en Git (commits, push, merge, rebase, etc.).
- **Tipos de Hooks**:
	- **Client-side**: Se ejecutan en el equipo del desarrollador (`pre-commit`, `commit-msg`, `pre-push`, `pre-rebase`, `prepare-commit-msg`, `post-commit`).
	- **Server-side**: Se ejecutan en el servidor remoto (`pre-receive`, `update`, `post-receive`).
- **Usos comunes**:
	- Validar mensajes de commit.
	- Ejecutar tests o linters antes de commits/push.
	- Formatear c칩digo autom치ticamente.
	- Integrar automatizaciones CI/CD.
	- Controlar seguridad y pol칤ticas de ramas.

## Ejemplos Pr치cticos de Hooks

### pre-commit
```bash
#!/bin/sh
# Evitar commits con errores de lint
npm run lint
if [ $? -ne 0 ]; then
  echo "Lint errors detected. Commit aborted."
  exit 1
fi
````

**Caso de uso real:** En proyectos de frontend, asegura que todos los archivos JS/TS cumplen reglas de ESLint antes de commitear.

### commit-msg

```bash
#!/bin/sh
# Forzar mensajes de commit que sigan convenciones de equipo
regex="^(feat|fix|docs|style|refactor|test|chore): .+$"
if ! grep -qE "$regex" "$1"; then
  echo "Invalid commit message format."
  exit 1
fi
```

**Caso de uso real:** Equipos que usan convenciones de Git Commit para generar changelogs autom치ticos.

### pre-push

```bash
#!/bin/sh
# Ejecutar pruebas antes de permitir push
npm test
if [ $? -ne 0 ]; then
  echo "Tests failed. Push aborted."
  exit 1
fi
```

**Caso de uso real:** Evitar que c칩digo roto llegue a la rama principal en proyectos colaborativos.

### pre-rebase

```bash
#!/bin/sh
# Prevenir rebase con cambios locales no guardados
if ! git diff-index --quiet HEAD --; then
  echo "Local changes detected. Commit or stash before rebasing."
  exit 1
fi
```

**Caso de uso real:** Proteger ramas importantes de conflictos o p칠rdida de cambios durante rebase.

### post-commit

```bash
#!/bin/sh
# Notificar en Slack despu칠s de cada commit
message=$(git log -1 --pretty=%B)
curl -X POST -H 'Content-type: application/json' --data "{\"text\":\"Nuevo commit: $message\"}" $SLACK_WEBHOOK_URL
```

**Caso de uso real:** Mantener al equipo informado de commits importantes en proyectos distribuidos.

### post-receive

```bash
#!/bin/sh
# Desplegar autom치ticamente en staging tras push a main
while read oldrev newrev refname
do
  if [ "$refname" = "refs/heads/main" ]; then
    ./deploy_staging.sh
    echo "Deployment to staging completed."
  fi
done
```

**Caso de uso real:** Automatizaci칩n de despliegues de staging en proyectos de backend o microservicios.

## Herramientas Complementarias

- **[git-commit-enhancer](https://github.com/edunavajas/git-commit-enhancer)**: Mejora autom치tica de mensajes de commit usando IA.
- **Husky**: Facilita la gesti칩n de hooks en proyectos Node.js.
- **Lint-staged**: Ejecuta linters solo sobre archivos staged para eficiencia.
- Integraci칩n con pipelines CI/CD, Prettier, ESLint, Pylint, Checkstyle.

## Buenas Pr치cticas

- Versionar todos los hooks (`.githooks`) y configurar `core.hooksPath`.
- Usar client-side hooks para validaciones preventivas y server-side para reglas cr칤ticas.
- Mantener hooks ligeros para no afectar productividad.
- Documentar el prop칩sito y funcionamiento de cada hook.
- Revisar y actualizar peri칩dicamente los hooks seg칰n necesidades del proyecto.
- Combinar hooks con herramientas de CI/CD para automatizaci칩n completa y seguridad.

## Casos de Uso Reales Resumidos

- Prevenir commits con c칩digo que no cumple est치ndares.
- Garantizar mensajes de commit consistentes para changelogs autom치ticos.
- Ejecutar tests antes de push para proteger ramas principales.
- Despliegue autom치tico de staging/producci칩n tras push.
- Notificaciones en Slack, Teams o correo sobre commits y merges importantes.
- Validaci칩n de pol칤ticas de ramas y control de accesos mediante hooks server-side.