---
date: 2025-12-07 18:15
title: pwa
keywords:
source:
status: ðŸŒŸ
Parent: "[[Area-Prog]]"
public_note: "true"
category: Frontend
tags:
  - PWA
  - frontend
---
# PWA
``

## DefiniciÃ³n y PropÃ³sito
Una **PWA (Progressive Web App)** es una aplicaciÃ³n web que emplea capacidades modernas del navegador para ofrecer experiencias similares a las aplicaciones nativas, manteniendo la accesibilidad universal de la web.  
Preserva el despliegue vÃ­a URL, pero aÃ±ade capacidades offline, instalaciÃ³n, rendimiento mejorado y acceso parcial a APIs del dispositivo.

Enlaces base:  
- PWA (aplicaciÃ³n web progresiva) Requisitos MÃ­nimos  Appy Pie  
- Progressive web apps  MDN-Progressive_web_apps

## CaracterÃ­sticas Fundamentales (core)
- **Progresiva**  
	- Funciona en cualquier navegador y mejora con capacidades disponibles.
- **Responsiva**  
	- Adaptable a cualquier tamaÃ±o de pantalla y densidad.
- **App-like**  
	- Se comporta como una app nativa: sin chrome del navegador, navegabilidad fluida, transiciones.
- **Conectividad resiliente**  
	- Funciona offline o con mala red usando Service Workers.
- **Actualizable**  
	- Descarga actualizaciones en segundo plano.
- **Segura (HTTPS)**  
	- Requiere contexto seguro para la mayorÃ­a de APIs y para registrar el Service Worker.
- **Descubrible**  
	- El `manifest.json` permite a los buscadores identificar la app.
- **Instalable**  
	- Permite aÃ±adir al home screen y ejecutarse en standalone.
- **Linkable**  
	- Accesible por URL sin instalaciones.

## Componentes Esenciales de una PWA
- **Service Worker**
	- Script que corre en segundo plano y gestiona:
		- CachÃ© offline.
		- Estrategias de fetch.
		- SincronizaciÃ³n en segundo plano.
		- Push notifications.
	- Es el corazÃ³n de la experiencia offline y de rendimiento.
- **Web App Manifest**
	- Archivo JSON que define:
		- Nombre, descripciones.
		- Iconos.
		- `display`, `theme_color`, `background_color`.
		- Scope y start_url.
- **HTTPS**
	- Obligatorio para poder registrar service workers y usar la mayorÃ­a de APIs modernas.
- **Estrategias de CachÃ©**
	- `cache-first`, `network-first`, `stale-while-revalidate`, `network-only`, `cache-only`.
	- Cada ruta o recurso puede tener una estrategia especÃ­fica segÃºn su criticidad.

## Arquitectura BÃ¡sica
- **Capa de presentaciÃ³n**  
	- HTML/CSS/JS, frameworks (React, Svelte, Lit, Solid, Vueâ€¦).
- **Capa de runtime (SW)**  
	- Intercepta requests y coordina cachÃ©s.
- **Capa de contenido**  
	- Servidor HTTP, endpoints, APIs REST/GraphQL, WebSockets, Assets.

## Requisitos MÃ­nimos (normativos)
- Servir la app vÃ­a **HTTPS**.
- Incluir un **manifest.json** vÃ¡lido.
- Registrar un **Service Worker** funcional.
- Debe existir un **evento fetch** operativo.
- Debe proporcionar **iconos** en varias resoluciones.
- Debe mostrar **comportamiento offline mÃ­nimo** (aunque sea una pantalla fallback).
- Debe respetar **performance bÃ¡sico** (carga inicial razonable, evitar bloqueo del main thread).

## Ventajas Clave
- DistribuciÃ³n sin tiendas de apps.
- Actualizaciones sin fricciÃ³n.
- TamaÃ±o reducido y mayores tasas de conversiÃ³n.
- Comodidad para SEO, deep linking y compartir.
- Ahorro de costes: un cÃ³digo para web y â€œappâ€.

## Limitaciones
- Soporte desigual entre navegadores (especialmente ciertas APIs en iOS).
- Acceso limitado a APIs del dispositivo comparado con apps nativas.
- Restricciones en background execution.
- Menos control sobre instalaciÃ³n comparado con tiendas nativas.

## APIs Relacionadas (nivel 2025)
- **Web Push**  
	- Soporte mÃ¡s estable en iOS desde 2024.
- **Background Sync / Periodic Sync**  
	- SincronizaciÃ³n confiable cuando vuelve la red.
- **File System Access API**  
	- Acceso estructurado al sistema de archivos.
- **Badging API**  
	- Badges en el icono instalado.
- **Screen Wake Lock API**  
	- Evitar que la pantalla se apague.
- **Web Share / Web Share Target**  
	- Compartir desde y hacia la PWA.
- **Media Session API**  
	- Control multimedia desde SO.
- **Credential Management / WebAuthn**  
	- AutenticaciÃ³n moderna y segura.
- **Background Fetch API**  
	- Descargas largas fuera de la interfaz.

## Mejores PrÃ¡cticas
- Cargar JavaScript **dividido** (code-splitting).
- Reducir render blocking.
- Usar `async`/`defer`.
- ImÃ¡genes optimizadas (AVIF, WebP).
- Pre-cachÃ© de assets crÃ­ticos.
- CachÃ© diferenciada por tipo de recurso.
- Control estricto de versiones del SW.
- Logs mÃ­nimos dentro del Service Worker.

## Manifest.json (ejemplo)
{% raw %}
```json
{
	"name": "Mi PWA",
	"short_name": "PWA",
	"start_url": "/",
	"display": "standalone",
	"background_color": "#ffffff",
	"theme_color": "#0d6efd",
	"icons": [
		{
			"src": "/icons/icon-192.png",
			"sizes": "192x192",
			"type": "image/png"
		},
		{
			"src": "/icons/icon-512.png",
			"sizes": "512x512",
			"type": "image/png"
		}
	]
}
```
{% endraw %}`

## Registro del Service Worker (ejemplo)

{% raw %}
```javascript
if ('serviceWorker' in navigator) {
	navigator.serviceWorker.register('/sw.js')
		.then(() => console.log('SW registrado'))
		.catch(err => console.error('Error SW', err));
}
```
{% endraw %}

## Service Worker BÃ¡sico (ejemplo)

{% raw %}
```javascript
self.addEventListener('install', event => {
	event.waitUntil(
		caches.open('v1').then(cache => cache.addAll([
			'/',
			'/index.html',
			'/styles.css',
			'/app.js'
		]))
	);
});

self.addEventListener('fetch', event => {
	event.respondWith(
		caches.match(event.request).then(resp => resp || fetch(event.request))
	);
});
```
{% endraw %}

## Estrategias de CachÃ© (ejemplos)

### Cache First

{% raw %}
```javascript
event.respondWith(
	caches.match(event.request).then(cacheRes => {
		return cacheRes || fetch(event.request);
	})
);
```
{% endraw %}

### Network First

{% raw %}
```javascript
event.respondWith(
	fetch(event.request)
		.then(networkRes => {
			caches.open('dynamic').then(cache => cache.put(event.request, networkRes.clone()));
			return networkRes;
		})
		.catch(() => caches.match(event.request))
);
```
{% endraw %}

### Stale While Revalidate

{% raw %}
```javascript
event.respondWith(
	caches.match(event.request).then(cacheRes => {
		const fetchPromise = fetch(event.request).then(networkRes => {
			caches.open('dynamic').then(cache => cache.put(event.request, networkRes.clone()));
			return networkRes;
		});
		return cacheRes || fetchPromise;
	})
);
```
{% endraw %}

## Testing y AuditorÃ­as

* **Lighthouse / PageSpeed**
	* Auditar performance, PWA y accesibilidad.
* **Workbox DevTools**
	* MonitorizaciÃ³n de estrategias de cachÃ©.
* **Chrome Application Panel**
	* Ver SW, manifest, storage y cachÃ©s.

## PatrÃ³n de Arquitectura recomendado

* App **SPA/MPA hÃ­brida** con precarga selectiva.
* **Workbox** para gestionar cachÃ© y rutas.
* Contenido crÃ­tico prerenderizado o server-side rendering.
* ActualizaciÃ³n suave del Service Worker (`skipWaiting` controlado + `clientsClaim` opcional).
* NotificaciÃ³n de nueva versiÃ³n al usuario.

## GuÃ­a de despliegue

* Forzar HTTPS (Nginx/Cloudflare).
* VersiÃ³n del SW vinculada al bundle (hash).
* purge de iconos viejos.
* `manifest.json` accesible en `/manifest.json`.
* `service-worker.js` en la raÃ­z para scope completo (o ajustar el scope explÃ­citamente).
* Verificar `display: standalone` y tamaÃ±os de iconos.

# PWA â€” Conceptos Avanzados y Arquitectura (2025)

## Objetivo de esta nota
Extender la informaciÃ³n previa incorporando **conceptos avanzados, patrones arquitectÃ³nicos modernos y nuevas APIs** sin repetir lo ya documentado.

## Nuevos Conceptos Clave (2025)
- **Islas de Interactividad (Islands Architecture) para PWAs**
	- TÃ©cnica donde solo partes interactivas de la pÃ¡gina hidratan en el cliente, mejorando rendimiento.
	- Ideal para PWAs con SSR + reactividad granular.
- **Prerendering + Streaming SSR**
	- El servidor envÃ­a HTML por streaming para First Paint ultra rÃ¡pido.
	- Encaja con PWAs que quieren SEO y rendimiento extremo.
- **Edge Rendering (CDN Functions)**
	- GeneraciÃ³n de HTML en el borde (Cloudflare, Vercel, Netlify).
	- Reduce TTFB global.
- **App Shell Moderno**
	- Shell mÃ­nimo renderizado instantÃ¡neamente.
	- Contenido dinÃ¡mico cargado progresivamente.
	- Se combina con Service Worker + prerender.
- **PWA como MPA hÃ­brida**
	- Varias pÃ¡ginas HTML con Service Worker como â€œpegamentoâ€.
	- MÃ¡s rÃ¡pido para SEO, navegaciÃ³n real entre pÃ¡ginas, sin hidratar todo.
- **Instant Navigation**
	- NavegaciÃ³n precargada por heurÃ­sticas (hover, viewport).
	- Usa Navigation API, prerendering y caching inteligente.

## Nuevas Capacidades UX (2024â€“2025)
- **Window Controls Overlay para PWAs instaladas**
	- Permite integrar controles nativos en el tÃ­tulo de la ventana.
- **URL Protocol Handlers**
	- La PWA puede abrir enlaces personalizados `myapp://`.
- **Tab Management API** (soporte parcial)
	- Coordina mÃºltiples pestaÃ±as de la misma PWA.
- **Idle Detection API**
	- Detecta cuÃ¡ndo el usuario estÃ¡ ausente para sincronizaciones silenciosas.
- **Launch Handler**
	- Control total sobre cÃ³mo se abre la PWA instalada (nueva ventana, tab existente, restauraciÃ³n de sesiÃ³n).

## Patrones de CachÃ© Avanzados
- **Rutas mixtas con Workbox Routing**
	- Estrategias distintas segÃºn:
		- tipo de recurso (HTML, CSS, imÃ¡genes, API JSON)
		- prioridad
		- red disponible (Network Information API)
- **Cache Warming**
	- Precalentamiento de cachÃ©s antes de que el usuario necesite recursos.
- **Cache Versioning por MÃ³dulos**
	- En vez de un cachÃ© global, crear cachÃ©s por dominio funcional:
		- `cache-html-vX`
		- `cache-api-vX`
		- `cache-assets-vX`
	- Acelera activaciÃ³n del SW y limpieza mÃ¡s simple.
- **Partial Responses Cache**
	- Cachear respuestas parciales (streaming) para contenido reutilizable.

## Nuevos Patrones de ActualizaciÃ³n (Upgrade Flow)
- **Soft-Update con UI Friendly Prompt**
	- El SW notifica la actualizaciÃ³n al cliente mediante `postMessage`.
	- La UI muestra un prompt elegante que:
		- informa
		- permite â€œActualizar ahoraâ€
		- permite â€œRecordar mÃ¡s tardeâ€
- **Dual-SW Strategy**
	- Un SW activo + un SW en staging probando rutas sin afectar usuarios.
- **Rollback AutomÃ¡tico**
	- Detectar fallos tras activar nueva versiÃ³n y restaurar versiÃ³n previa desde cachÃ© segura.

## Arquitectura de Datos en PWAs Avanzadas
- **IndexedDB + WASM para procesamiento offline**
	- AnÃ¡lisis de datos local sin servidor.
- **ReplicaciÃ³n offline â†’ online**
	- Aplicaciones que sincronizan datos como si fueran apps nativas *(Notion, Figma, Obsidian modelos PWA)*.
- **CRDTs (Conflict-free Replicated Data Types)**
	- SincronizaciÃ³n colaborativa en tiempo real sin conflictos.
	- Ãštil para editores, notas, productividad.
- **Storage Buckets (Origin Private File System)**
	- OrganizaciÃ³n por buckets persistentes con cuotas altas.
- **Persistencia Permanente**
	- Solicitud de almacenamiento persistente evitando el borrado automÃ¡tico del navegador.

## APIs Especializadas (2025)
- **Local Font Access API**
	- Acceso a fuentes locales instaladas.
- **Bluetooth / WebHID / WebUSB**
	- ConexiÃ³n directa con hardware externo.
- **Web NFC**
	- ComunicaciÃ³n con etiquetas NFC.
- **Contact Picker API**
	- SelecciÃ³n de contactos del dispositivo.
- **Payment Request API (avanzada)**
	- Pagos integrados con proveedores nativos.
- **Digital Credentials / Passkeys PWA**
	- AutenticaciÃ³n de alto nivel para apps sin password.
- **Launch Queue API**
	- GestiÃ³n de archivos abiertos mediante la PWA instalada.

## Seguridad y Privacidad
- **COOP / COEP / CORP**
	- Aislamiento contra ataques de cross-origin resource sharing.
- **Sandboxing del SW**
	- SeparaciÃ³n de Ã¡mbitos: no acceso al DOM.
- **Restricciones de lectura cruzada en Storage**
	- Cada origen tiene su espacio aislado.
- **Secure Context Only APIs**
	- La mayorÃ­a de APIs avanzadas requieren HTTPS y permisos explÃ­citos.

## AuditorÃ­as ampliadas
- **Web Vitals NWB (Next Web Benchmarks)**
	- MÃ©tricas modernas: INP, TTFB, CLS, Smoothness.
- **Real User Monitoring (RUM)**
	- InstrumentaciÃ³n directo en la PWA para medir latencia real.
- **Tracing en Edge Logs**
	- Permite detectar problemas en serverless/edge que afectan a la PWA.

## Nuevas Herramientas del Ecosistema PWA
- **Workbox v7+**
	- Mejor routing, estrategias predefinidas, background sync y precaching declarativo.
- **VitePWA / @vite-pwa/plugin**
	- GeneraciÃ³n automÃ¡tica de manifest, SW, precache.
- **SvelteKit / Next.js / Astro con PWA opt-in**
	- IntegraciÃ³n nativa para generar SW + manifest.
- **PWABuilder (2025)**
	- Empaquetado a tiendas (Microsoft Store, Play Store Web Apps, Meta Quest Web Apps).
- **WebContainer + PWA**
	- Correr entornos de desarrollo dentro de una PWA offline.

## Casos de Uso Avanzados
- **PWA como IDE offline**
- **PWA como cliente de sincronizaciÃ³n**
- **PWA como lector offline masivo (PDFs, docs, multimedia)**
- **PWA industriales**
	- ConexiÃ³n a maquinaria vÃ­a WebHID/USB/Bluetooth.
- **PWAs instaladas como aplicaciones de escritorio**
	- Con Window Controls Overlay + File Handling.

## Servicio Worker Avanzado â€” Ejemplo Modular
{% raw %}
```javascript
import { registerRoute } from 'workbox-routing'
import { NetworkFirst, StaleWhileRevalidate, CacheFirst } from 'workbox-strategies'
import { ExpirationPlugin } from 'workbox-expiration'

// HTML â†’ Network First para contenido fresco
registerRoute(
	({ request }) => request.destination === 'document',
	new NetworkFirst({
		cacheName: 'html',
		networkTimeoutSeconds: 3
	})
)

// CSS/JS â†’ Stale-While-Revalidate
registerRoute(
	({ request }) => request.destination === 'script' || request.destination === 'style',
	new StaleWhileRevalidate({
		cacheName: 'static-assets'
	})
)

// ImÃ¡genes â†’ Cache First + expiraciÃ³n
registerRoute(
	({ request }) => request.destination === 'image',
	new CacheFirst({
		cacheName: 'images',
		plugins: [
			new ExpirationPlugin({
				maxEntries: 100,
				maxAgeSeconds: 60 * 60 * 24 * 30
			})
		]
	})
)
```
{% endraw %}`

## Manifest Avanzado (Web App Manifest Level 2)

{% raw %}
```json
{
	"name": "PWA Avanzada",
	"short_name": "PWA-Adv",
	"start_url": "/",
	"display": "standalone",
	"categories": ["productivity", "utilities"],
	"description": "PWA moderna con capacidades avanzadas",
	"launch_handler": {
		"client_mode": "focus-existing"
	},
	"file_handlers": [
		{
			"action": "/open-file",
			"accept": {
				"text/plain": [".txt"],
				"application/json": [".json"]
			}
		}
	],
	"protocol_handlers": [
		{
			"protocol": "myapp",
			"url": "/handler?url=%s"
		}
	]
}
```
{% endraw %}

