---
date: 2024-11-26 01:06
title: PHPUnit
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
public_note: "true"
category: Testing
tags:
  - PHP
  - testing
  - phpunit
---
# PHPUnit

- [Testing](/testing/testing/)
- [PHP](/backend/php/)
- docs
	- [PHPUnit: The PHP Testing Framework](https://phpunit.de/index.html)
	- [1. Installation ‚Äî PHPUnit 11.4 Manual](https://docs.phpunit.de/en/11.4/installation.html)
- guias
	- PHPUnit - Gu√≠a avanzada y patrones de testing profesional
	- Testing de APIs REST y Microservicios con PHPUnit y Mockery
---
## üß† Conceptos Fundamentales

PHPUnit es el framework de testing est√°ndar para PHP, utilizado para crear **pruebas unitarias**, de **integraci√≥n** y **funcionales**. Se basa en la filosof√≠a de [TDD - Test Driven Development](/testing/tdd---test-driven-development/) y permite garantizar la calidad del c√≥digo mediante pruebas automatizadas.

- **TestCase:** clase base de PHPUnit desde la cual heredan todas las pruebas.
- **Assertions:** m√©todos para verificar resultados esperados (`assertEquals`, `assertTrue`, `assertCount`, etc.).
- **Fixtures:** c√≥digo de inicializaci√≥n y limpieza antes o despu√©s de cada prueba (`setUp`, `tearDown`).
- **Mocks y Stubs:** objetos simulados que reemplazan dependencias reales durante las pruebas.
- **Data Providers:** mecanismos para ejecutar una misma prueba con distintos conjuntos de datos.
- **Annotations:** metadatos usados para definir comportamiento (`@test`, `@dataProvider`, `@depends`, `@group`, etc.).

---

## ‚öôÔ∏è Instalaci√≥n y Configuraci√≥n

PHPUnit se instala t√≠picamente a trav√©s de Composer:

{% raw %}
```bash
composer require --dev phpunit/phpunit
```
{% endraw %}`


Para verificar la instalaci√≥n:

{% raw %}
```bash
vendor/bin/phpunit --version
```
{% endraw %}

Archivo de configuraci√≥n recomendado (`phpunit.xml`):

{% raw %}
```xml
<?xml version="1.0" encoding="UTF-8"?>
<phpunit bootstrap="vendor/autoload.php"
         colors="true"
         verbose="true">
    <testsuites>
        <testsuite name="App Test Suite">
            <directory>tests</directory>
        </testsuite>
    </testsuites>
</phpunit>
```
{% endraw %}

---

## üß© Estructura B√°sica de una Prueba

{% raw %}
```php
<?php

use PHPUnit\Framework\TestCase;

class MathTest extends TestCase
{
    public function testAddition()
    {
        $this->assertEquals(4, 2 + 2);
    }
}
```
{% endraw %}


- Cada clase de prueba debe extender `TestCase`.
- Los m√©todos de prueba comienzan con `test` o usan la anotaci√≥n `@test`.
- Las afirmaciones verifican resultados esperados.

---

## üß± Fixtures y Ciclo de Vida


PHPUnit ejecuta m√©todos especiales antes y despu√©s de cada prueba o conjunto de pruebas:


{% raw %}
```php
protected function setUp(): void
{
    // Preparar entorno antes de cada test
}

protected function tearDown(): void
{
    // Limpiar entorno despu√©s de cada test
}

public static function setUpBeforeClass(): void
{
    // Ejecutado una vez antes de todas las pruebas de la clase
}

public static function tearDownAfterClass(): void
{
    // Ejecutado una vez despu√©s de todas las pruebas de la clase
}
```
{% endraw %}

---

## üß™ Assertions Comunes

| M√©todo                                           | Descripci√≥n                             |
| ------------------------------------------------ | --------------------------------------- |
| `assertTrue($cond)`                              | Verifica que la condici√≥n sea verdadera |
| `assertFalse($cond)`                             | Verifica que sea falsa                  |
| `assertEquals($a, $b)`                           | Compara igualdad de valores             |
| `assertSame($a, $b)`                             | Compara igualdad estricta               |
| `assertCount($n, $arr)`                          | Verifica cantidad de elementos          |
| `assertInstanceOf($class, $obj)`                 | Comprueba tipo de objeto                |
| `assertStringContainsString($needle, $haystack)` | Verifica substring                      |
| `assertArrayHasKey($key, $arr)`                  | Verifica clave en array                 |

---

## üß† Mocks y Dobles de Prueba


Los mocks permiten aislar dependencias durante las pruebas.


{% raw %}
```php
$mock = $this->createMock(UserRepository::class);
$mock->method('find')
     ->willReturn(new User('John'));

$service = new UserService($mock);
$result = $service->getUser('123');
$this->assertEquals('John', $result->getName());
```
{% endraw %}


Tipos de dobles:
- **Stub:** devuelve valores fijos.
- **Mock:** verifica llamadas esperadas.
- **Spy:** registra interacciones para verificarlas despu√©s.
- **Dummy:** objeto sin comportamiento, solo relleno.

---

## üì¶ Data Providers


Permiten ejecutar una misma prueba con m√∫ltiples entradas:


{% raw %}
```php
/**
 * @dataProvider additionProvider
 */
public function testAdd($a, $b, $expected)
{
    $this->assertEquals($expected, $a + $b);
}

public static function additionProvider(): array
{
    return [
        [2, 2, 4],
        [2, 3, 5],
        [5, 5, 10],
    ];
}
```
{% endraw %}

---

## üîó Dependencias entre Tests


Una prueba puede depender del resultado de otra:


{% raw %}
```php
public function testUserCreation(): User
{
    $user = new User('Alice');
    $this->assertNotNull($user);
    return $user;
}

/**
 * @depends testUserCreation
 */
public function testUserEmail(User $user)
{
    $user->setEmail('alice@example.com');
    $this->assertStringContainsString('@', $user->getEmail());
}
```
{% endraw %}

---

## üß∞ Integraci√≥n con CI/CD

PHPUnit se integra f√°cilmente con sistemas de CI/CD como GitHub Actions, GitLab CI, Jenkins o [Docker](/software%20engineering/docker/).
Ejemplo con GitHub Actions (`.github/workflows/phpunit.yml`):
{% raw %}
```

```
{% endraw %}yaml
name: PHPUnit Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
      - name: Install dependencies
        run: composer install
      - name: Run PHPUnit
        run: vendor/bin/phpunit
{% raw %}
```

---

## üìä Cobertura de C√≥digo


PHPUnit puede generar informes de cobertura usando Xdebug o PCOV.


```
{% endraw %}bash
vendor/bin/phpunit --coverage-html coverage/
```


Resultado:
- Carpeta `/coverage` con informe HTML.
- M√©tricas de l√≠neas, m√©todos y clases cubiertas.
- √ötil para integrarlo con SonarQube o Codecov.

## üß± Patrones y Buenas Pr√°cticas


- Nombra los tests con claridad (`testShouldReturnValidResponse`).
- Una sola **aserci√≥n principal** por prueba.
- Evita dependencias externas (DB, red) ‚Üí usa mocks.
- Automatiza la ejecuci√≥n con CI.
- Mant√©n las pruebas r√°pidas, independientes y determin√≠sticas.
- Separa **unit tests**, **integration tests** y **feature tests**.

---
## üß≠ Casos de Uso y Ejemplos Reales


- Validar controladores y servicios en frameworks como Laravel, Symfony, Slim.
- Probar integraciones con bases de datos SQLite en memoria.
- Simular API externas con mocks o Mockery.
- Ejecutar tests paralelos con `--parallel`.
- Generar reportes XML para herramientas de an√°lisis continuo.
## üìö Recursos y Referencias

* [Documentaci√≥n Oficial de PHPUnit](https://docs.phpunit.de/en/11.4/)
* [Assertions Reference](https://docs.phpunit.de/en/11.4/assertions.html)
* [Mock Objects](https://docs.phpunit.de/en/11.4/test-doubles.html)
* [Test Suites y Configuraci√≥n](https://docs.phpunit.de/en/11.4/configuration.html)
* [TDD - Test Driven Development](/testing/tdd---test-driven-development/)
* [CICD](/devops/cicd/)
* SonarQube
* [PHP](/backend/php/)

