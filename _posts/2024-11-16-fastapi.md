---
date: 2024-11-16 19:43
title: FastApi
tags:
  - fastapi
  - api
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
cssclasses:
  - hide-embedded-header1
  - wide
categories:
  - Backend
public_note: "true"
category: Backend
---
# FastAPI
`$= dv.current().file.tags.join(" ")`

- [python](/software%20engineering/python/)
- framework [Backend](/uncategorized/backend/) moderno, r√°pido y orientado a la productividad.
- Basado en **tipado est√°tico**, **async/await** y **validaci√≥n autom√°tica** con Pydantic.
- Cumple con el est√°ndar **ASGI**, lo que permite alta concurrencia y rendimiento.
- Ideal para construir APIs REST, microservicios o backends para aplicaciones modernas.

## Recursos y documentaci√≥n

- [Tutorial - User Guide - FastAPI](https://fastapi.tiangolo.com/tutorial/)
- [GitHub - Full Stack FastAPI Template](https://github.com/fastapi/full-stack-fastapi-template)
- [Crea una Aplicaci√≥n con FastAPI para Python - Kinsta¬Æ](https://kinsta.com/es/blog/fastapi/)
- [04. Documentaci√≥n autom√°tica | Curso de Introducci√≥n a FastAPI 2024 - YouTube](https://youtu.be/5gwCOje67Js)

## Caracter√≠sticas clave

- **Desarrollo r√°pido** gracias a autocompletado y tipado en los editores.
- **Validaci√≥n autom√°tica** de datos con Pydantic.
- **Documentaci√≥n interactiva** autom√°tica con Swagger y Redoc.
- **Compatible con ASGI**, permitiendo servidores concurrentes de alto rendimiento.
- **Integraci√≥n sencilla** con bases de datos, autenticaci√≥n JWT, middlewares y CORS.
- **Escalable**: adecuado para microservicios o arquitecturas complejas.

## Servidores ASGI compatibles

- [Uvicorn](https://www.uvicorn.org/) ‚Äî r√°pido, basado en asyncio.
- [Starlette](https://www.starlette.io/) ‚Äî framework ligero sobre el que se construye FastAPI.

## Validaci√≥n y modelos de datos

- [Welcome to Pydantic - Pydantic](https://docs.pydantic.dev/latest/)
- Pydantic permite:
	- Validar entradas y salidas.
	- Definir esquemas con tipado estricto.
	- Generar documentaci√≥n a partir de los modelos.

### Ejemplo b√°sico con Pydantic

{% raw %}
```python
from pydantic import BaseModel

class Item(BaseModel):
	name: str
	price: float
	in_stock: bool = True
```
{% endraw %}`

## Creaci√≥n de una API b√°sica

### Ejemplo de servidor FastAPI

{% raw %}
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
	name: str
	price: float
	in_stock: bool = True

@app.get("/")
def read_root():
	return {"message": "Bienvenido a FastAPI"}

@app.post("/items/")
def create_item(item: Item):
	return {"item": item}
```
{% endraw %}

* Ejecutar con Uvicorn:

{% raw %}
```bash
uvicorn main:app --reload
```
{% endraw %}

* Documentaci√≥n generada autom√°ticamente:

  * **Swagger UI:** [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)
  * **ReDoc:** [http://127.0.0.1:8000/redoc](http://127.0.0.1:8000/redoc)

## Mejores pr√°cticas

* Organizar la app por m√≥dulos (routers, models, services).
* Usar dependencias con `Depends` para inyecci√≥n de l√≥gica com√∫n.
* A√±adir middleware para logs, seguridad y control de errores.
* Definir variables de entorno con `python-dotenv` o `pydantic-settings`.
* Implementar tests con `pytest` y `httpx`.

## Extensiones y ecosistema

* **Autenticaci√≥n:** `fastapi-users`, JWT o OAuth2.
* **Bases de datos:** `SQLModel`, `SQLAlchemy`, `Tortoise ORM`.
* **Tareas as√≠ncronas:** `Celery`, `RQ`, o `BackgroundTasks`.
* **Integraci√≥n con frontend:** ideal con Blazor, React, Vue o Svelte.
* **Despliegue:** Docker, [Kubernetes](/virtualizacion/kubernetes/), [Azure](/cloud/azure/), AWS Lambda.

## Plantillas y ejemplos completos

* [FastAPI Full Stack Template (FastAPI + React + PostgreSQL)](https://github.com/fastapi/full-stack-fastapi-template)
* [fastapi-best-practices](https://github.com/zhanymkanov/fastapi-best-practices)
* [fastapi-realworld-example-app](https://github.com/nsidnev/fastapi-realworld-example-app)

## Temas relacionados

* ASGI
* Swagger
* Pydantic
* Python AsyncIO
* [Backend](/uncategorized/backend/)
* Microservicios


# FastAPI (temas avanzados adicionales)

## WebSockets y comunicaci√≥n en tiempo real
- FastAPI soporta WebSockets nativamente.
- √ötil para chat, notificaciones, dashboards en tiempo real o juegos online.
- Ejemplo b√°sico:

{% raw %}
```python
from fastapi import FastAPI, WebSocket

app = FastAPI()

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
	await websocket.accept()
	while True:
		data = await websocket.receive_text()
		await websocket.send_text(f"Recibido: {data}")
```
{% endraw %}`

## Background Tasks

* Permite ejecutar tareas en segundo plano sin bloquear la respuesta al cliente.
* Ideal para enviar correos, procesar archivos o actualizar registros en BD.

{% raw %}
```python
from fastapi import BackgroundTasks, FastAPI

app = FastAPI()

def write_log(message: str):
	with open("log.txt", "a") as f:
		f.write(message + "\n")

@app.post("/send/")
async def send_message(background_tasks: BackgroundTasks, message: str):
	background_tasks.add_task(write_log, message)
	return {"status": "Mensaje encolado"}
```
{% endraw %}

## Eventos de startup y shutdown

* Permite inicializar recursos al arrancar la app (DB, cache) y cerrarlos correctamente al detenerse.

{% raw %}
```python
@app.on_event("startup")
async def startup_event():
	print("Aplicaci√≥n iniciada, recursos cargados")

@app.on_event("shutdown")
async def shutdown_event():
	print("Aplicaci√≥n cerrada, recursos liberados")
```
{% endraw %}

## Dependencias avanzadas

* Las dependencias (`Depends`) pueden ser jer√°rquicas y reutilizables.
* Ejemplo: autenticaci√≥n con roles, conexi√≥n a BD o configuraci√≥n de servicios.

{% raw %}
```python
from fastapi import Depends, HTTPException, status

def get_token_header(token: str):
	if token != "secreto":
		raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Token inv√°lido")
	return token

@app.get("/protected/")
def protected_route(token: str = Depends(get_token_header)):
	return {"message": "Acceso permitido"}
```
{% endraw %}

## Versionado de API

* Organizar rutas por versi√≥n es crucial para mantener compatibilidad con clientes existentes.
* Ejemplo de estructura de rutas: `/v1/items/`, `/v2/items/`.

## Respuestas y manejo de errores avanzados

* FastAPI permite definir respuestas personalizadas con c√≥digos HTTP, headers y modelos de respuesta.
* Ejemplo:

{% raw %}
```python
from fastapi import Response

@app.get("/custom/")
def custom_response():
	content = {"message": "Respuesta personalizada"}
	return Response(content=str(content), media_type="application/json", status_code=202)
```
{% endraw %}

## Seguridad avanzada

* Autenticaci√≥n: OAuth2, JWT, API keys.
* Autorizaci√≥n: control de roles y permisos.
* Protecci√≥n CORS y HTTPS para producci√≥n.
* Ejemplo JWT: se puede combinar con dependencias para validar tokens.

## Integraci√≥n con ORMs y bases de datos

* SQLAlchemy, Tortoise ORM, SQLModel, MongoDB (con Motor).
* Soporta operaciones s√≠ncronas y as√≠ncronas.
* Uso de sessions y transacciones con context managers.

## Testing avanzado

* `TestClient` permite pruebas de endpoints sin necesidad de levantar un servidor.
* Compatible con `pytest` para pruebas unitarias e integraci√≥n.

{% raw %}
```python
from fastapi.testclient import TestClient

client = TestClient(app)

def test_read_root():
	response = client.get("/")
	assert response.status_code == 200
	assert response.json() == {"message": "Bienvenido a FastAPI"}
```
{% endraw %}

## Optimizaci√≥n y performance

* Middleware para caching, compresi√≥n y logging.
* Uso eficiente de async/await para operaciones I/O intensivas.
* Integraci√≥n con herramientas de profiling (PyInstrument, cProfile) para detectar cuellos de botella.

## Despliegue avanzado

* Docker: contenerizar la app para entornos de producci√≥n.
* Gunicorn + Uvicorn workers para manejo de m√∫ltiples procesos.
* Orquestaci√≥n con Kubernetes, despliegue en AWS, Azure, GCP.
* Monitoreo con Prometheus, Grafana y logs centralizados.

## Observabilidad y m√©tricas

* Middleware personalizado para medir tiempos de respuesta y errores.
* Integraci√≥n con OpenTelemetry para tracing distribuido.
* M√©tricas de endpoints expuestas para dashboards en tiempo real.

## Integraci√≥n con Machine Learning

* FastAPI permite exponer modelos ML como APIs.
* Serializaci√≥n de entrada/salida con Pydantic.
* Uso combinado con librer√≠as como TensorFlow, PyTorch o scikit-learn.

## Plantillas y ejemplos de proyectos

* APIs REST completas con autenticaci√≥n, roles y testing.
* Integraci√≥n con frontend React/Vue/Svelte para apps full-stack.
* Microservicios ligeros y modulares con comunicaci√≥n interna usando HTTP o WebSockets.


# FastAPI (temas avanzados adicionales)

## WebSockets y comunicaci√≥n en tiempo real
- FastAPI soporta WebSockets nativamente.
- √ötil para chat, notificaciones, dashboards en tiempo real o juegos online.
- Ejemplo b√°sico:

{% raw %}
```python
from fastapi import FastAPI, WebSocket

app = FastAPI()

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
	await websocket.accept()
	while True:
		data = await websocket.receive_text()
		await websocket.send_text(f"Recibido: {data}")
```
{% endraw %}`

## Background Tasks

* Permite ejecutar tareas en segundo plano sin bloquear la respuesta al cliente.
* Ideal para enviar correos, procesar archivos o actualizar registros en BD.

{% raw %}
```python
from fastapi import BackgroundTasks, FastAPI

app = FastAPI()

def write_log(message: str):
	with open("log.txt", "a") as f:
		f.write(message + "\n")

@app.post("/send/")
async def send_message(background_tasks: BackgroundTasks, message: str):
	background_tasks.add_task(write_log, message)
	return {"status": "Mensaje encolado"}
```
{% endraw %}

## Eventos de startup y shutdown

* Permite inicializar recursos al arrancar la app (DB, cache) y cerrarlos correctamente al detenerse.

{% raw %}
```python
@app.on_event("startup")
async def startup_event():
	print("Aplicaci√≥n iniciada, recursos cargados")

@app.on_event("shutdown")
async def shutdown_event():
	print("Aplicaci√≥n cerrada, recursos liberados")
```
{% endraw %}

## Dependencias avanzadas

* Las dependencias (`Depends`) pueden ser jer√°rquicas y reutilizables.
* Ejemplo: autenticaci√≥n con roles, conexi√≥n a BD o configuraci√≥n de servicios.

{% raw %}
```python
from fastapi import Depends, HTTPException, status

def get_token_header(token: str):
	if token != "secreto":
		raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Token inv√°lido")
	return token

@app.get("/protected/")
def protected_route(token: str = Depends(get_token_header)):
	return {"message": "Acceso permitido"}
```
{% endraw %}

## Versionado de API

* Organizar rutas por versi√≥n es crucial para mantener compatibilidad con clientes existentes.
* Ejemplo de estructura de rutas: `/v1/items/`, `/v2/items/`.

## Respuestas y manejo de errores avanzados

* FastAPI permite definir respuestas personalizadas con c√≥digos HTTP, headers y modelos de respuesta.
* Ejemplo:

{% raw %}
```python
from fastapi import Response

@app.get("/custom/")
def custom_response():
	content = {"message": "Respuesta personalizada"}
	return Response(content=str(content), media_type="application/json", status_code=202)
```
{% endraw %}

## Seguridad avanzada

* Autenticaci√≥n: OAuth2, JWT, API keys.
* Autorizaci√≥n: control de roles y permisos.
* Protecci√≥n CORS y HTTPS para producci√≥n.
* Ejemplo JWT: se puede combinar con dependencias para validar tokens.

## Integraci√≥n con ORMs y bases de datos

* SQLAlchemy, Tortoise ORM, SQLModel, MongoDB (con Motor).
* Soporta operaciones s√≠ncronas y as√≠ncronas.
* Uso de sessions y transacciones con context managers.

## Testing avanzado

* `TestClient` permite pruebas de endpoints sin necesidad de levantar un servidor.
* Compatible con `pytest` para pruebas unitarias e integraci√≥n.

{% raw %}
```python
from fastapi.testclient import TestClient

client = TestClient(app)

def test_read_root():
	response = client.get("/")
	assert response.status_code == 200
	assert response.json() == {"message": "Bienvenido a FastAPI"}
```
{% endraw %}

## Optimizaci√≥n y performance

* Middleware para caching, compresi√≥n y logging.
* Uso eficiente de async/await para operaciones I/O intensivas.
* Integraci√≥n con herramientas de profiling (PyInstrument, cProfile) para detectar cuellos de botella.

## Despliegue avanzado

* Docker: contenerizar la app para entornos de producci√≥n.
* Gunicorn + Uvicorn workers para manejo de m√∫ltiples procesos.
* Orquestaci√≥n con Kubernetes, despliegue en AWS, Azure, GCP.
* Monitoreo con Prometheus, Grafana y logs centralizados.

## Observabilidad y m√©tricas

* Middleware personalizado para medir tiempos de respuesta y errores.
* Integraci√≥n con OpenTelemetry para tracing distribuido.
* M√©tricas de endpoints expuestas para dashboards en tiempo real.

## Integraci√≥n con Machine Learning

* FastAPI permite exponer modelos ML como APIs.
* Serializaci√≥n de entrada/salida con Pydantic.
* Uso combinado con librer√≠as como TensorFlow, PyTorch o scikit-learn.

## Plantillas y ejemplos de proyectos

* APIs REST completas con autenticaci√≥n, roles y testing.
* Integraci√≥n con frontend React/Vue/Svelte para apps full-stack.
* Microservicios ligeros y modulares con comunicaci√≥n interna usando HTTP o WebSockets.


# FastAPI Cheatsheet
`$= dv.current().file.tags.join(" ")`

## Conceptos Clave
- Framework [Backend](/uncategorized/backend/) moderno, r√°pido y as√≠ncrono.
- Basado en Python 3.7+, Pydantic y ASGI.
- Genera documentaci√≥n autom√°tica: Swagger (`/docs`) y Redoc (`/redoc`).
- Compatible con async/await, WebSockets y BackgroundTasks.
- Ideal para APIs REST, microservicios y apps full-stack.

## Instalaci√≥n
{% raw %}
```bash
pip install fastapi uvicorn
```
{% endraw %}`

* Para desarrollo con autoreload:

{% raw %}
```bash
uvicorn main:app --reload
```
{% endraw %}

## Estructura b√°sica

{% raw %}
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class Item(BaseModel):
	name: str
	price: float
	in_stock: bool = True

@app.get("/")
def read_root():
	return {"message": "Bienvenido a FastAPI"}

@app.post("/items/")
def create_item(item: Item):
	return {"item": item}
```
{% endraw %}

## Rutas y m√©todos HTTP

* `@app.get("/ruta")` ‚Üí GET
* `@app.post("/ruta")` ‚Üí POST
* `@app.put("/ruta")` ‚Üí PUT
* `@app.delete("/ruta")` ‚Üí DELETE
* `@app.patch("/ruta")` ‚Üí PATCH

### Path parameters

{% raw %}
```python
@app.get("/items/{item_id}")
def read_item(item_id: int):
	return {"item_id": item_id}
```
{% endraw %}

### Query parameters

{% raw %}
```python
@app.get("/search/")
def search(q: str = None, limit: int = 10):
	return {"q": q, "limit": limit}
```
{% endraw %}

## Modelos y validaci√≥n (Pydantic)

{% raw %}
```python
from pydantic import BaseModel, Field

class User(BaseModel):
	name: str = Field(..., example="Alice")
	age: int = Field(..., gt=0)
	email: str
```
{% endraw %}

## Responses y status codes

{% raw %}
```python
from fastapi import Response, status

@app.get("/custom/")
def custom_response():
	return Response(content='{"msg":"OK"}', media_type="application/json", status_code=status.HTTP_202_ACCEPTED)
```
{% endraw %}

## Dependencias (DI)

{% raw %}
```python
from fastapi import Depends, HTTPException, status

def verify_token(token: str):
	if token != "secreto":
		raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Token inv√°lido")
	return token

@app.get("/secure/")
def secure_route(token: str = Depends(verify_token)):
	return {"message": "Acceso permitido"}
```
{% endraw %}

## Background tasks

{% raw %}
```python
from fastapi import BackgroundTasks

def write_log(msg: str):
	with open("log.txt", "a") as f:
		f.write(msg + "\n")

@app.post("/send/")
def send_message(background_tasks: BackgroundTasks, message: str):
	background_tasks.add_task(write_log, message)
	return {"status": "Mensaje encolado"}
```
{% endraw %}

## WebSockets

{% raw %}
```python
from fastapi import WebSocket

@app.websocket("/ws")
async def websocket_endpoint(ws: WebSocket):
	await ws.accept()
	while True:
		data = await ws.receive_text()
		await ws.send_text(f"Recibido: {data}")
```
{% endraw %}

## Eventos de la aplicaci√≥n

{% raw %}
```python
@app.on_event("startup")
async def startup_event():
	print("App iniciada")

@app.on_event("shutdown")
async def shutdown_event():
	print("App cerrada")
```
{% endraw %}

## Seguridad

* Autenticaci√≥n: OAuth2, JWT, API Keys.
* Autorizaci√≥n: roles y scopes.
* Protecci√≥n CORS y HTTPS en producci√≥n.

## Testing

{% raw %}
```python
from fastapi.testclient import TestClient

client = TestClient(app)

def test_root():
	response = client.get("/")
	assert response.status_code == 200
	assert response.json() == {"message": "Bienvenido a FastAPI"}
```
{% endraw %}

## ORMs y Bases de Datos

* SQLAlchemy, Tortoise ORM, SQLModel, MongoDB.
* Compatible con operaciones s√≠ncronas y as√≠ncronas.
* Uso de sessions y context managers recomendados.

## Buenas pr√°cticas

* Versionar API: `/v1/items/`, `/v2/items/`.
* Mantener l√≥gica fuera de endpoints.
* Usar `response_model` para validar salidas.
* Manejo centralizado de errores (`HTTPException`).
* Configuraci√≥n con variables de entorno y `pydantic-settings`.
* Logging, m√©tricas y monitoreo.

## Despliegue

* Docker + Uvicorn/Gunicorn para producci√≥n.
* Escalar con Kubernetes o servicios en la nube (AWS, Azure, GCP).
* Monitoreo con Prometheus, Grafana, logs centralizados.

## Plantillas y recursos

* [FastAPI Full Stack Template](https://github.com/fastapi/full-stack-fastapi-template)
* [Documentaci√≥n oficial FastAPI](https://fastapi.tiangolo.com/)
* [Tutorial FastAPI - Kinsta](https://kinsta.com/es/blog/fastapi/)
* [YouTube: Documentaci√≥n autom√°tica FastAPI](https://youtu.be/5gwCOje67Js)

## Notas r√°pidas

* Docs autom√°ticos: `/docs` ‚Üí Swagger, `/redoc` ‚Üí Redoc.
* Tipado y validaci√≥n autom√°tica gracias a Pydantic.
* Soporta async/await y tareas en background.
* WebSockets nativos y comunicaci√≥n en tiempo real.
* Escalable y listo para producci√≥n con ASGI (Uvicorn/Starlette).
