---
date: 2024-11-23 16:58
title: karma
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
public_note: "true"
category: Testing
tags:
  - karma
  - testing
  - test-runner
  - jasmine
---
# Karma
`$= dv.current().file.tags.join(" ")`

- [jasmine](/testing/jasmine/)
- [Testing](/testing/testing/)
- [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
- [Desarrollo web](/uncategorized/desarrollo-web/)
- test runner

---

## üß™ Introducci√≥n a Karma

**Karma** es un *test runner* para JavaScript que ejecuta pruebas en navegadores reales, permitiendo automatizar y validar el comportamiento del c√≥digo en distintos entornos. Fue dise√±ado originalmente para funcionar junto con [jasmine](/testing/jasmine/), pero puede integrarse tambi√©n con Mocha, [QUnit](/testing/qunit/) u otros frameworks.

Su principal objetivo es **proporcionar feedback r√°pido** a los desarrolladores mientras escriben c√≥digo, ejecutando los tests autom√°ticamente cada vez que los archivos cambian.

---

## ‚öôÔ∏è Configuraci√≥n b√°sica

Karma se controla mediante un archivo `karma.conf.js`, donde se definen:
- **Frameworks** de testing a usar (por ejemplo, `jasmine` o `mocha`).
- **Archivos** a incluir (scripts fuente y tests).
- **Navegadores** a lanzar (`Chrome`, `Firefox`, `Edge`, `Headless`).
- **Reporters** para mostrar resultados (por consola o en HTML).
- **Plugins** adicionales (coverage, webpack, typescript, etc.).
- **Preprocesadores** para transpilar o instrumentar c√≥digo antes de ejecutar tests.

üìÑ Referencia: [Karma - Configuration File](https://karma-runner.github.io/6.4/config/configuration-file.html)

---

## üíª Ejemplo de configuraci√≥n

### `karma.conf.js`
{% raw %}
```javascript
// Karma configuration file
module.exports = function(config) {
	config.set({
		frameworks: ['jasmine'],
		files: [
			'src/**/*.js',
			'test/**/*.spec.js'
		],
		reporters: ['progress'],
		browsers: ['ChromeHeadless'],
		singleRun: true,
		autoWatch: false,
		plugins: [
			'karma-jasmine',
			'karma-chrome-launcher',
			'karma-coverage'
		],
		preprocessors: {
			'src/**/*.js': ['coverage']
		},
		coverageReporter: {
			type: 'html',
			dir: 'coverage/'
		}
	})
}
```
{% endraw %}`

---

## üîÑ Integraci√≥n con herramientas de desarrollo

Karma se integra f√°cilmente en pipelines de **CI/CD** y herramientas de build:

* Gulp o Grunt para ejecutar tests como tareas automatizadas.
* Webpack o Rollup para preprocesar m√≥dulos ES6.
* Angular CLI usa Karma + Jasmine por defecto en su sistema de testing.
* [Docker](/software%20engineering/docker/) puede ejecutar Karma en entornos aislados para garantizar consistencia.

Tambi√©n puede vincularse con entornos de integraci√≥n continua como:

* GitHub Actions
* Jenkins
* GitLab CI
* CircleCI

---

## üß† Conceptos clave

* **Test Runner:** ejecuta y controla los tests, lanzando navegadores y mostrando resultados.
* **Browser Launchers:** adaptadores que permiten correr los tests en diferentes navegadores.
* **Reporters:** definen c√≥mo se muestran los resultados (`progress`, `dots`, `junit`, `coverage`).
* **Preprocessors:** transforman los archivos antes de testearlos (por ejemplo, TypeScript o Babel).
* **Coverage:** an√°lisis de cobertura de c√≥digo mediante `karma-coverage`.

---

## üß© Ejemplo de integraci√≥n con Jasmine

### `example.spec.js`

{% raw %}
```javascript
describe('Calculator', function() {
	it('should add two numbers', function() {
		expect(1 + 2).toBe(3)
	})
})
```
{% endraw %}

Para ejecutarlo:

{% raw %}
```bash
npx karma start
```
{% endraw %}

üìò Recurso: How to write unit tests with Jasmine & Karma-how-to-write-unit-tests-with-jasmine-karma-f1908bdeb617

---

## ‚ö° Caracter√≠sticas avanzadas

* **Watch Mode:** Karma puede vigilar archivos y ejecutar tests autom√°ticamente al detectar cambios (`autoWatch: true`).
* **Headless Testing:** ejecuci√≥n sin interfaz gr√°fica, ideal para CI (`ChromeHeadless`).
* **Custom Launchers:** configuraci√≥n de navegadores remotos o m√≥viles.
* **Code Coverage:** con `karma-coverage`, genera reportes visuales y m√©tricas.
* **Parallel Execution:** mejora la velocidad dividiendo los tests entre varios navegadores.

---

## üß± Buenas pr√°cticas

* Mant√©n los tests unitarios aislados y deterministas.
* Usa `singleRun: true` en entornos de integraci√≥n continua.
* Evita dependencias globales entre tests.
* Configura **coverage thresholds** para mantener calidad m√≠nima del c√≥digo.
* Usa `Headless` browsers en pipelines autom√°ticos.
* Asegura compatibilidad con m√∫ltiples navegadores antes de despliegues.

---

## üîó Recursos adicionales

* [Karma - Spectacular Test Runner for JavaScript](https://karma-runner.github.io/latest/index.html)
* [Karma - Configuration File](https://karma-runner.github.io/6.4/config/configuration-file.html)
* [jasmine](/testing/jasmine/)
* [Testing](/testing/testing/)
* [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
* [Desarrollo web](/uncategorized/desarrollo-web/)

# Karma - Fundamentos avanzados y ecosistema
`$= dv.current().file.tags.join(" ")`

- [jasmine](/testing/jasmine/)
- [Testing](/testing/testing/)
- [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
- [Desarrollo web](/uncategorized/desarrollo-web/)
- CI/CD
- Angular Testing
- Code Coverage
- Mocha
- Webpack

---

## üß© Ecosistema de Karma

Karma no funciona en solitario: su potencia radica en su integraci√≥n con frameworks y herramientas del ecosistema JavaScript moderno. A continuaci√≥n se detallan los componentes m√°s relevantes que ampl√≠an su alcance.

### Frameworks de Testing compatibles
- Jasmine ‚Üí API sencilla y legible (`describe`, `it`, `expect`).
- Mocha ‚Üí M√°s flexible y modular; requiere aserciones externas como Chai.
- [QUnit](/testing/qunit/) ‚Üí Popular en entornos jQuery o proyectos legacy.
- Angular Testing ‚Üí Angular CLI lo incluye por defecto junto con Jasmine y `karma.conf.js` autogenerado.

### Preprocesadores comunes
Permiten compilar o transformar c√≥digo antes de ejecutar los tests:
- `karma-webpack` ‚Üí Soporte para m√≥dulos ES6 y bundling.
- `karma-typescript` ‚Üí Transpilaci√≥n directa de TypeScript.
- `karma-babel-preprocessor` ‚Üí Integraci√≥n con Babel para compatibilidad con ESNext.
- `karma-sourcemap-loader` ‚Üí Mantiene trazabilidad de errores originales.

---

## ‚öôÔ∏è Cobertura de c√≥digo y an√°lisis de calidad

El plugin `karma-coverage` genera reportes que miden qu√© porcentaje del c√≥digo fuente es cubierto por las pruebas.

### Configuraci√≥n de cobertura
{% raw %}
```javascript
coverageReporter: {
	reporters: [
		{ type: 'html', dir: 'coverage/' },
		{ type: 'text-summary' }
	],
	check: {
		global: {
			statements: 80,
			branches: 70,
			functions: 80,
			lines: 80
		}
	}
}
```
{% endraw %}`

### Integraciones √∫tiles

* SonarQube ‚Üí lectura de reportes para control de calidad continua.
* Istanbul ‚Üí motor subyacente para instrumentaci√≥n del c√≥digo.
* Allure Reports ‚Üí reportes visuales avanzados.

---

## üöÄ Integraci√≥n continua (CI/CD)

Karma se integra perfectamente en pipelines automatizados. Ejemplo b√°sico para GitHub Actions:

{% raw %}
```yaml
name: Run Unit Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: npm ci
      - name: Run Karma Tests
        run: npx karma start --single-run --browsers ChromeHeadless
```
{% endraw %}

üîÅ En Jenkins o GitLab CI se usa de forma an√°loga, ajustando el entorno y navegador.

---

## ‚ö° Ejecuci√≥n distribuida y rendimiento

Karma puede ejecutar tests en paralelo o en m√∫ltiples navegadores a la vez:

* **karma-parallel** ‚Üí divide tests entre procesos paralelos.
* **karma-sauce-launcher** ‚Üí ejecuta tests en navegadores reales de Sauce Labs.
* **karma-browserstack-launcher** ‚Üí integraci√≥n con BrowserStack.

Esto permite validar compatibilidad multiplataforma sin necesidad de infraestructura propia.

---

## üß† Debugging y desarrollo local

### Herramientas y t√©cnicas

* `karma run` ‚Üí ejecuta tests sin reiniciar el servidor.
* `autoWatch: true` ‚Üí recompila y ejecuta autom√°ticamente.
* `browserConsoleLogOptions` ‚Üí redirige logs del navegador a la terminal.
* `karma-spec-reporter` ‚Üí muestra resultados detallados por test.

üí° Consejo: usar `Chrome` normal (no `Headless`) durante el desarrollo permite depurar directamente con las DevTools.

---

## üß± Patrones de arquitectura de tests

* **AAA (Arrange, Act, Assert):**

  1. *Arrange*: configurar entorno y dependencias.
  2. *Act*: ejecutar la funci√≥n o acci√≥n.
  3. *Assert*: verificar los resultados esperados.
* **Fakes y Mocks:** crear objetos simulados para aislar dependencias.
* **Test Pyramid:** prioriza los *unit tests* (r√°pidos) sobre los *E2E* (lentos).
* **Fixture data:** usar datos de prueba consistentes en distintos archivos.

---

## üß∞ Extensiones y plugins √∫tiles

| Plugin                          | Descripci√≥n                        |
| ------------------------------- | ---------------------------------- |
| `karma-html-reporter`           | Genera reportes navegables en HTML |
| `karma-junit-reporter`          | Exporta resultados en formato XML  |
| `karma-spec-reporter`           | Muestra test por test en consola   |
| `karma-chrome-launcher`         | Ejecuci√≥n en Chrome/Headless       |
| `karma-firefox-launcher`        | Ejecuci√≥n en Firefox               |
| `karma-phantomjs-launcher`      | Ejecuci√≥n legacy sin GUI           |
| `karma-ng-html2js-preprocessor` | Compila templates de AngularJS     |
| `karma-json-reporter`           | Exporta resultados como JSON       |

---

## üß† Casos de uso reales

* **Angular CLI:** ejecuta `ng test` ‚Üí Karma + Jasmine en ChromeHeadless.
* **Bibliotecas UI:** testeo visual r√°pido con Storybook y Karma.
* **Proyectos h√≠bridos:** combinar Karma (unit) con [Playwright](/testing/playwright/) o Cypress (E2E).
* **Microfrontends:** ejecutar tests por m√≥dulo o componente de forma aislada.

---

## üß© Alternativas modernas

Aunque Karma sigue siendo √∫til, existen herramientas m√°s modernas seg√∫n el contexto:

* Vitest ‚Üí reemplazo ligero, compatible con Vite y Jest.
* Jest ‚Üí entorno completo, sin necesidad de navegador.
* Playwright Test ‚Üí pruebas E2E y de componentes en browsers reales.
* Mocha + Chai ‚Üí setups m√°s flexibles para proyectos no basados en Angular.

üìò Aun as√≠, Karma sigue siendo ideal en entornos que requieran **compatibilidad multiplataforma y ejecuci√≥n real en navegadores.**

---

## üîó Recursos recomendados

* [Karma - Official Docs](https://karma-runner.github.io/latest/index.html)
* [Karma Plugins Directory](https://npmjs.com/search?q=karma)
* How to write unit tests with Jasmine & Karma-how-to-write-unit-tests-with-jasmine-karma-f1908bdeb617
* Angular Testing
* Testing en CI/CD
* [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
* [Desarrollo web](/uncategorized/desarrollo-web/)

# Karma - Temas avanzados y optimizaci√≥n
`$= dv.current().file.tags.join(" ")`

- [jasmine](/testing/jasmine/)
- [Testing](/testing/testing/)
- [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
- [Desarrollo web](/uncategorized/desarrollo-web/)
- CI/CD
- Code Coverage
- Mocha
- Webpack
- Performance Testing
- Debugging
- Headless Testing

---

## üß© Integraci√≥n con TypeScript

Aunque Karma fue creado originalmente para JavaScript, su ecosistema soporta TypeScript mediante el plugin `karma-typescript`.  
Esto permite compilar, ejecutar y generar cobertura sin necesidad de un bundler adicional.

### Ejemplo de configuraci√≥n
{% raw %}
```javascript
frameworks: ['jasmine', 'karma-typescript'],
files: [
	'src/**/*.ts',
	'tests/**/*.spec.ts'
],
preprocessors: {
	'**/*.ts': ['karma-typescript']
},
reporters: ['progress', 'karma-typescript'],
browsers: ['ChromeHeadless'],
singleRun: true
```
{% endraw %}`

Ventajas:

* Soporte completo para `tsconfig.json`.
* Mapas de fuente (source maps) autom√°ticos.
* Reportes de cobertura adaptados a TypeScript.
* Integraci√≥n con Angular y Webpack sin configuraci√≥n redundante.

---

## üîí Tests seguros y sandboxing

Karma ejecuta el c√≥digo en navegadores reales, lo cual introduce posibles riesgos de acceso a recursos locales o APIs.
Para mitigar esto:

* Usa navegadores *headless* con configuraciones limitadas (`--no-sandbox`, `--disable-gpu`).
* Configura `customLaunchers` con flags de seguridad.
* Evita cargar archivos externos o dependencias no controladas.
* Si se testean librer√≠as que manipulan el DOM, restringe accesos con *sandboxed iframes*.

Ejemplo:

{% raw %}
```javascript
customLaunchers: {
	ChromeSandboxed: {
		base: 'ChromeHeadless',
		flags: ['--no-sandbox', '--disable-setuid-sandbox']
	}
}
```
{% endraw %}

---

## üß† Optimizaci√≥n del rendimiento de los tests

Karma puede volverse lento con grandes bases de c√≥digo o m√∫ltiples navegadores.
Buenas pr√°cticas para acelerar:

* Ejecutar en **Headless Chrome** o **Firefox**.
* Desactivar `autoWatch` y `singleRun: true` en CI.
* Usar **`karma-parallel`** para dividir tests entre procesos.
* Reducir `files` y `preprocessors` a lo estrictamente necesario.
* Ejecutar los tests m√°s cr√≠ticos primero (`grep` o `fdescribe`).
* Combinar Karma con Vitest o Jest para aislar pruebas unitarias r√°pidas.

---

## üîç Depuraci√≥n avanzada

### Estrategias de debugging

* **`browser: Chrome`** ‚Üí abre ventana interactiva para inspeccionar errores.
* **`debug.html`** ‚Üí ejecuta los tests manualmente en `http://localhost:9876/debug.html`.
* **Breakpoints en DevTools** ‚Üí pausa en tests espec√≠ficos.
* **`console.log` + Reporters detallados** ‚Üí trazabilidad paso a paso.
* **`karma-mocha-reporter`** ‚Üí visualizaci√≥n jer√°rquica y legible.

### Configuraci√≥n √∫til

{% raw %}
```javascript
logLevel: config.LOG_DEBUG,
colors: true,
browserConsoleLogOptions: {
	level: 'debug',
	format: '%b %T: %m',
	terminal: true
}
```
{% endraw %}

---

## üß™ Testeo de componentes UI

Karma puede ejecutarse junto con librer√≠as de UI:

* Angular Testing Library ‚Üí renderizado de componentes con DOM real.
* React Testing Library ‚Üí pruebas visuales con Webpack + Babel.
* Vue Test Utils ‚Üí integraci√≥n con `karma-webpack` y `vue-loader`.

Ventajas:

* Renderizado real del DOM.
* Simulaci√≥n de eventos de usuario (`click`, `input`, etc.).
* Validaci√≥n de estilos o layouts.

Ejemplo:

{% raw %}
```javascript
it('deber√≠a renderizar el bot√≥n con el texto correcto', () => {
	const button = document.querySelector('button')
	expect(button.textContent).toBe('Enviar')
})
```
{% endraw %}

---

## üß∞ Configuraci√≥n modular y compartida

En proyectos grandes, es √∫til dividir la configuraci√≥n de Karma por entorno:

* `karma.base.conf.js` ‚Üí Configuraci√≥n com√∫n (frameworks, preprocessors).
* `karma.dev.conf.js` ‚Üí Para desarrollo (autoWatch, Chrome normal).
* `karma.ci.conf.js` ‚Üí Para integraci√≥n continua (headless, cobertura).
* `karma.e2e.conf.js` ‚Üí Para pruebas de integraci√≥n ligeras.

{% raw %}
```javascript
// karma.ci.conf.js
const baseConfig = require('./karma.base.conf')
module.exports = function(config) {
	config.set({
		...baseConfig,
		browsers: ['ChromeHeadless'],
		singleRun: true,
		reporters: [...baseConfig.reporters, 'coverage']
	})
}
```
{% endraw %}

---

## üßÆ M√©tricas y reporting avanzado

Karma permite generar m√∫ltiples tipos de reportes simult√°neamente:

* `text` ‚Üí salida en consola.
* `html` ‚Üí exploraci√≥n visual.
* `json` o `xml` ‚Üí integraci√≥n con herramientas de an√°lisis.
* `lcov` ‚Üí compatibilidad con Codecov y Coveralls.
* `junit` ‚Üí integraci√≥n con Jenkins.

Configuraci√≥n ejemplo:

{% raw %}
```javascript
reporters: ['progress', 'coverage', 'junit'],
junitReporter: {
	outputDir: 'test-results',
	outputFile: 'results.xml',
	useBrowserName: false
}
```
{% endraw %}

---

## üîÑ Testing multiplataforma

Karma puede integrarse con servicios en la nube para ejecutar pruebas en diferentes dispositivos y navegadores.

### Ejemplos

* BrowserStack ‚Üí ejecuci√≥n en navegadores m√≥viles y de escritorio reales.
* Sauce Labs ‚Üí grid distribuido con logs, v√≠deos y screenshots.
* LambdaTest ‚Üí integraci√≥n r√°pida con CI/CD para validaci√≥n visual.

### Configuraci√≥n

{% raw %}
```javascript
browsers: ['Chrome', 'Firefox', 'Safari'],
customLaunchers: {
	BS_Chrome_Desktop: {
		base: 'BrowserStack',
		browser: 'chrome',
		os: 'Windows',
		os_version: '11'
	}
}
```
{% endraw %}

---

## üß© Karma en proyectos monorepo

Karma puede ejecutarse de forma aislada por paquete:

* Integraci√≥n con Nx o Lerna.
* Configuraci√≥n individual por paquete (`packages/*/karma.conf.js`).
* Uso compartido de dependencias comunes (`karma-base.conf.js`).
* Reportes consolidados mediante `karma-merge-reports`.

Esto facilita pruebas paralelas y modulares en entornos grandes.

---

## üß† Evoluci√≥n y estado actual

Aunque Karma fue una herramienta central en la era de AngularJS, su rol ha evolucionado:

* En entornos modernos (Vite, Next.js, Nuxt) tiende a ser reemplazado por Vitest o Jest.
* Sigue siendo clave para entornos **browser-first**, como librer√≠as UI o frameworks cl√°sicos.
* Angular (v17+) lo mantiene compatible, aunque ofrece soporte opcional para Jest.

üí¨ Conclusi√≥n t√©cnica: Karma sigue siendo relevante cuando se requiere **testing real en navegadores**, **soporte multiplataforma** y **reportes detallados**, especialmente en entornos empresariales o CI robustos.

---

## üîó Enlaces complementarios

* [Karma GitHub Repository](https://github.com/karma-runner/karma)
* [Karma API Documentation](https://karma-runner.github.io/latest/config/configuration-file.html)
* Testing de componentes UI
* Vitest vs Karma
* Debugging en navegadores
* Headless Testing
* Performance Testing
* [Automatizacion y Build](/uncategorized/automatizacion-y-build/)
* CI/CD
* [Desarrollo web](/uncategorized/desarrollo-web/)

