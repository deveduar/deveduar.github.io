---
date: 2024-11-16 17:54
title: webhooks
keywords:
source:
status: üåü
Parent: "[[Area-Prog]]"
public_note: "true"
category: Backend
tags:
  - webhooks
  - backend
  - devops
---
# Webhooks

[Backend](/backend/backend/) ¬∑ [devops](/devops/devops/) ¬∑ [PHP](/backend/php/) ¬∑ [Computer Science](/computer%20science/computer-science/)  
Acerca de webhooks - Documentaci√≥n de GitHub 
Webhook- ¬øQu√© es y por qu√© lo necesitas- - Mailjet

---

## Qu√© es un Webhook
Un **webhook** es una devoluci√≥n de llamada HTTP: una **petici√≥n HTTP POST** enviada autom√°ticamente cuando ocurre un **evento** en un sistema origen.  
Es comunicaci√≥n **push**, dirigida por eventos, sin polling.

El servidor origen **inicia el env√≠o** de datos hacia un **endpoint** configurado por el cliente. Esto permite:
- Actualizaciones autom√°ticas y en tiempo real.  
- Notificaciones instant√°neas de eventos (pagos, cambios de stock, reembolsos, registros de usuarios‚Ä¶).  
- Integraciones ligeras sin necesidad de consultar constantemente una API.

---

## Webhooks vs API
- **Webhook**
	- Push, evento ‚Üí POST autom√°tico.
	- Notificaciones instant√°neas.
	- Ideal para: cambios de precio, stock, pedidos, reembolsos, alertas.
	- Cliente **escucha** en una URL p√∫blica.
- **API**
	- Pull, requiere realizar peticiones bajo demanda.
	- Mayor control, acceso directo a recursos y endpoints.
	- Se usa para operaciones CRUD o flujos que no dependen de eventos.

### Diferencias clave
- Origen de la comunicaci√≥n:  
	- API ‚Üí cliente inicia.  
	- Webhook ‚Üí servidor inicia.  
- Frecuencia:  
	- API ‚Üí consultas peri√≥dicas (polling).  
	- Webhook ‚Üí solo cuando hay evento.  
- Escenarios:  
	- Webhook ‚Üí notificaciones.  
	- API ‚Üí obtener/actualizar datos bajo control del cliente.

---

## Funcionamiento t√©cnico
- Protocolo: **HTTP POST**.
- Contenido: JSON o XML.
- Requisitos:
	- Endpoint accesible p√∫blicamente.
	- Validaci√≥n de firma o secreto (HMAC).
	- Gesti√≥n de reintentos y verificaci√≥n de idempotencia.
- Seguridad:
	- HTTPS.
	- Tokens, timestamps, firmas.
	- IP allowlists.

---

## Triggers y Eventos en Tiempo Real
Se activa un webhook cuando ocurre un evento predefinido, como:
- Nuevo pedido.
- Comentario creado.
- Pago completado.
- Actualizaci√≥n de stock.
- Env√≠o fallido de SMS.
- Entrada en CRM.

El sistema destino procesa la notificaci√≥n y realiza acciones autom√°ticas.

---

## Usos y Ejemplos Pr√°cticos
- Automatizaciones en CRM (actualizar contactos, crear leads).
- Realizar pedidos o generar documentos autom√°ticamente.
- Generar presentaciones o informes al producirse un evento.
- Notificaciones a Slack, paneles de control, email, WhatsApp.
- Automatizar env√≠os de email (ej. bot√≥n en Notion ‚Üí webhook ‚Üí proveedor de email).
- Registro hist√≥rico de eventos.
- En WordPress con [PHP](/backend/php/) para integraciones personalizadas.
- Webhooks de SMS o telecomunicaciones.

---

## Integraciones Populares
- [Mailjet](https://www.mailjet.com/es/)
- [ClickUp](https://clickup.com/lp?utm_source=google&utm_medium=cpc&utm_campaign=gs_cpc_emea-eea_nnc_brand_trial_all-devices_troas_lp_x_all-departments_x_brand&utm_content=all-countries_kw-target_text_all-industries_all-features_all-use-cases_clickup_broad&utm_term=b_clickup&utm_creative=651395804534_BrandChampion-03072023_rsa&utm_custom1=&utm_custom2=&gad_source=1&gclid=Cj0KCQjwmt24BhDPARIsAJFYKk2P-RYa9LfXR5gzzuDpqgN-df0YpIuHC5gRLZ_dzeTB5fIYEtUlHjcaAj-mEALw_wcB)
- [Make](https://www.make.com/en?utm_campaign=gg-dg-eur-demandgen-search-brand&utm_source=google&utm_medium=cpc&utm_content=make&utm_term=make%20integrations&gad_source=1&gclid=Cj0KCQjwmt24BhDPARIsAJFYKk2GjjZstPgMdhnD1gjBgF-X9pv8_hcfh4lfn15Sy14dk3sWhNDHjQUaAlFrEALw_wcB)

---

## Webhooks y System Design
Basado en:  
[How WebHook works | System Design - YouTube](https://youtu.be/oQaJn6RdA3g)

Aspectos clave:
- Polling vs **websockets** vs webhooks.
- Arquitectura dirigida por eventos (**event-driven programming**).
- Cliente ‚Üí escucha en URL.  
- Servidor ‚Üí env√≠a notificaciones.  
- Compatible con JSON, XML, formularios.
- Casos: comments, orders, reservas, notificaciones de SMS.

---

## Webhooks en WhatsApp API
Basado en:  
[TODO sobre los WEBHOOKS de la API WhatsApp - YouTube](https://youtu.be/41_4Q5NApTw)

- Configurar webhook mediante **ngrok** o proxy.
- Validar challenge de Meta.
- Eventos: mensajes, estados de entrega, interacciones de plantillas.
- Env√≠o de plantilla para iniciar mensajes.
- Integraciones comerciales:
	- [Wasapi | Gestiona, Vende y Automatiza en WhatsApp con IA](https://www.wasapi.io/)

---

## Open Source para Automatizaci√≥n
- [n8n](https://n8n.io/)
- [Repositorio en GitHub](https://github.com/n8n-io/n8n)

Funciones:
- Router de condiciones.
- Filtros.
- Construcci√≥n visual de flujos.
- Integraciones con m√°s de 400 servicios.

---

## Webhooks en .NET
Basado en:  
[What Exactly is a Webhook & How Do You Build One with .NET? üöÄ - YouTube](https://youtu.be/wtpAA-mkOlA)

Incluye:
- Controladores en ASP.NET Core.
- Validaci√≥n de firma.
- Manejo de reintentos.
- Serializaci√≥n JSON.
- Logging y auditor√≠a.

---

## C√≥digo de Ejemplo (Webhook B√°sico en .NET)

{% raw %}
```csharp
[ApiController]
[Route("webhooks")]
public class WebhookController : ControllerBase
{
	[HttpPost("receive")]
	public async Task<IActionResult> Receive([FromBody] object payload)
	{
		// Procesar evento
		Console.WriteLine(payload.ToString());

		// Respuesta requerida por algunos proveedores
		return Ok(new { status = "received" });
	}
}
```
{% endraw %}`

---

## Recursos en Video

- [C√≥mo Conectar Cualquier Aplicaci√≥n con Webhooks ü™ù - YouTube](https://youtu.be/oPX-rPa3DuY)
- [How WebHook works | System Design - YouTube](https://youtu.be/oQaJn6RdA3g)
- [TODO sobre los WEBHOOKS de la API WhatsApp - YouTube](https://youtu.be/41_4Q5NApTw)
- [What Exactly is a Webhook & How Do You Build One with .NET? üöÄ](https://youtu.be/wtpAA-mkOlA)

# Webhooks ‚Äî Conceptos Avanzados y Faltantes

---

## Entrega Fiable y Reintentos (Retry Strategy)
Los proveedores suelen implementar mecanismos autom√°ticos para asegurar la entrega del webhook:
- Backoff exponencial en los reintentos.
- L√≠mite m√°ximo de intentos.
- Registro de eventos fallidos en **dead-letter queues**.
- Reenv√≠o manual desde paneles de control.

Esto garantiza que una ca√≠da temporal del receptor no cause p√©rdida de eventos.

---

## Idempotencia
Evita procesar un evento dos veces si el proveedor reenv√≠a el webhook.

Estrategias:
- Guardar el `event_id` en base de datos.
- Ignorar eventos ya procesados.
- Responder siempre `200 OK` r√°pidamente, incluso si el procesamiento real contin√∫a as√≠ncronamente.

---

## Procesamiento As√≠ncrono y Colas
Buenas pr√°cticas para producci√≥n:
- Validar el webhook y responder r√°pido.
- Enviar el procesamiento a una cola como:
	- Redis Streams  
	- RabbitMQ  
	- Kafka  
	- AWS SQS  
	- Azure Service Bus

Esto evita timeouts y aumenta la fiabilidad del sistema.

---

## Firmas Criptogr√°ficas y Seguridad Avanzada
M√©todos habituales:
- **HMAC-SHA256 / SHA512** para firmar el payload.
- Validaci√≥n de timestamps para impedir **replay attacks**.
- Cabeceras comunes:  
	- `X-Signature`  
	- `X-Timestamp`  
	- `X-Event-Type`
- Aislar el endpoint con:
	- HTTPS obligatorio.  
	- Tokens de verificaci√≥n.  
	- IP allowlists.

---

## Testing y Simulaci√≥n de Webhooks
Herramientas √∫tiles para pruebas:
- **[ngrok](/backend/ngrok/)** ‚Üí expone servidor local con t√∫nel HTTPS.
- **Webhook.site** ‚Üí inspeccionar payloads en tiempo real.
- **RequestBin** y **Mockbin** ‚Üí endpoints temporales.
- Test A/B: simular eventos y estructuras distintas.

---

## Tipos de Webhooks
- **Sincr√≥nicos**: respuesta afecta el flujo del origen.  
- **Asincr√≥nicos**: no dependen de la respuesta del receptor.
- **Batch webhooks**: varios eventos dentro de un mismo payload.
- **Webhooks diferidos**: solo notifican que hay actualizaci√≥n disponible.
- **Suscripci√≥n din√°mica**: endpoints generados seg√∫n filtros o reglas.

---

## Versionado y Migraciones
Buenas pr√°cticas:
- Header `X-Webhook-Version`.
- Versionar esquema del JSON.
- Tolerancia a campos desconocidos (forward compatibility).
- Periodo de coexistencia entre versiones antiguas y nuevas.

---

## Endpoints de Dise√±o
Ejemplos comunes:
- `/webhooks/events`
- `/webhooks/payments`
- `/webhooks/github`
- `/webhooks/notifications`

Caracter√≠sticas recomendadas:
- Handshake inicial para validar endpoint.
- Respuestas r√°pidas (m√°ximo 3‚Äì5 segundos).
- Logging detallado de cada recepci√≥n.

---

## Observabilidad y Monitorizaci√≥n
Aspectos a cubrir:
- Logs estructurados con `request_id`.
- Dashboards de fallos y m√©tricas.
- Alertas cuando:
	- La tasa de errores sube.
	- Hay retrasos en reintentos.
	- Se reciben eventos duplicados.

---

## Patrones Avanzados
- **Outbox Pattern**: asegurar consistencia entre base de datos y eventos enviados.
- **Event Sourcing**: almacenar el estado como secuencia de eventos.
- **State Reconciliation**: reconciliar datos llamando a la API si falla un webhook.
- **Duplicate Suppression**: descartar eventos repetidos o inconsistentes.

